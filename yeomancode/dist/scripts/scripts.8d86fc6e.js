angular.module("redPandaApp",["ngRoute","ui.bootstrap","ngGrid","ngCookies","google-maps"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/HomePage.html"}).when("/Employee",{templateUrl:"views/Employee.html"}).when("/Customer",{templateUrl:"views/Customer.html"}).when("/Contract",{templateUrl:"views/Contract.html"}).when("/ContractDetail",{templateUrl:"views/ContractDetail.html"}).when("/EmployeeDetail",{templateUrl:"views/EmployeeDetail.html"}).when("/CustomerDetail",{templateUrl:"views/CustomerDetail.html"}).otherwise({redirectTo:"/"})}]),angular.module("redPandaApp").controller("maincontroller",["$scope","$location","$rootScope","$cookieStore","$window","$modal","$http",function(a,b,c,d,e,f,g){c.selectedMenu="home",c.localCache={},c.fromCustomer=!1,c.localCache.isEmpAPINeeded=!1,c.localCache.isCustomerAPINeeded=!1,c.localCache.isFindCustomerAPINeeded=!1,c.localCache.customerContactId="",c.calledFromEmployeeDetail=!1,c.calledFromCustomerDetail=!1,c.calledFromContractDetail=!1,a.navHome=function(){b.path("/")},angular.element(e).bind("resize",function(){var a=$(document.activeElement);a.is(".hasDatepicker")&&a.datepicker("hide").datepicker("show"),a.is("span.simplecolorpicker")&&$("span.picker").hide()});var h=function(a,b){a.ok=function(){b.close()},a.cancel=function(){b.dismiss("dismiss")}};c.showModal=function(a,b,d,e,i){var j=f.open({template:'<div><div class="modal-header"><h3 class="modal-title">'+b+'</h3><span class="modal-close" ng-click="cancel()">x</span></div> <div class="modal-body">'+d+'</div><div class="modal-footer"><button class="btn btn-important" ng-click="cancel()">'+e+'</button><button class="btn btn-primary" ng-click="ok();">'+i+"</button></div></div>",controller:h});j.result.then(function(){g.post(a).success(function(){c.isPostSuccess=!0}).error(function(){c.isPostSuccess=!1})},function(){console.log("Cancelled")})},c.addAlert=function(a,b,d){c.alerts=[],c.alerts.push({message:a,type:b,header:d}),e.scrollTo(0,0)},c.closeAlert=function(){c.alerts=[]},c.customerData={success:!0,total:8,dataType:"customerList",data:[{id:"53b54b2d406e304a0af096a1",customerId:"CUS002",customerName:"GeoHay",customerAddress:"Inman, SC",commentsExist:!1,attachmentsExist:!1},{id:"53b55c4eb583afd17f72170c",customerId:"CUS004",customerName:"Thompson PR",customerAddress:"New York, NY",commentsExist:!1,attachmentsExist:!1},{id:"53c6887b02c7571f485ad86a",customerName:"Avon Bakery",commentsExist:!1,attachmentsExist:!1},{id:"53c689d902c7571f485ad86b",customerId:"CUS088",customerName:"Avon Bakery",customerAddress:"Avon, CO",commentsExist:!1,attachmentsExist:!1},{id:"53b55a43b583afd17f72170b",customerId:"CUS003",customerName:"Red Panda",customerAddress:"Princeton, NJ",commentsExist:!1,attachmentsExist:!1},{id:"53b55c61b583afd17f72170d",customerId:"CUS005",customerName:"Traveller Inc.",customerAddress:"DC, 20017",commentsExist:!1,attachmentsExist:!1},{id:"53d7ffac13a2e63528ae5372",customerId:"CUS006",customerName:"Rockhead",customerAddress:"MD, 20850",commentsExist:!1,attachmentsExist:!1},{id:"53b41103353f736efcab467d",customerId:"CUS001",customerName:"Small World",customerAddress:"Princeton, NJ",commentsExist:!1,attachmentsExist:!1}]},c.customerDetail={success:!0,total:1,data:{id:"53fdf562a2c94628879aa174",customerId:"CUST004",color:"#00ff99",customerName:"Thompson PRs",addressStreet:"44 W 28th Street",addressCity:"New York",addressStateCode:"NY",addressStateName:"New York",addressPostZip:"10001",addressISOCountry:"US",addressCountryName:"United States of America",addressLat:40.7456572,addressLong:-73.99007039999998,contactIds:["53fe5abc03cd3d2d8df32473","53fe5abc03cd3d2d8df32473"],contactList:[{id:"53fe5abc03cd3d2d8df32473",type:"external",companyName:"ThompsonPR.",firstName:"Lisa",lastName:"Hamilton",name:"Lisa Hamilton",address:"AK, 99501",jobTitle:"Accountant.",departmentName:"Management",deleted:!1},{id:"53fe5abc03cd3d2d8df32473",type:"external",companyName:"ThompsonPR.",firstName:"Lisa",lastName:"Hamilton",name:"Lisa Hamilton",address:"AK, 99501",jobTitle:"Accountant.",departmentName:"Management",deleted:!1}],contractIds:["53fe62c303cd3d2d8df32476"],contractList:[{id:"53fe62c303cd3d2d8df32476",title:"Salmon Fishing",poNumber:"PO 998877",value:0,commentsExist:!1,attachmentsExist:!1,deleted:!1}]}},c.EmployeeID="545789000abc012345655",c.EmployeeDetailObject={"53ac275ee4b03340b6de4947":{success:!0,total:1,data:{id:"53ac275ee4b03340b6de4947",employeeId:"PER00003",photoUrl:"/data/resources/53b2fd2de4b0123558f41fe5.jpeg",thumbUrl:"/data/resources/thumbnail.53b2fd2de4b0123558f41fe5.jpeg",firstName:"Peter",hireDate:"2014-09-05",termDate:"2014-09-26",lastName:"Blake",fullName:"Peter Blake",nickname:"Peter Blake",isPartTime:!1,isContractor:!1,addressStreet:"23 Ridge Road",contactNumbers:[{seq:0,type:"email",details:"jennifer@xyz.com"},{seq:0,type:"phone",details:"4043456127"}],addressCity:"Princeton",addressStateCode:"NJ",addressPostZip:"08540",addressCountryISO:"US",departmentId:"53ac29159c1c37083b3d38ad",job:"Developer",stdCostAmt:88.5,stdCostCur:"USD",timeOff:[{type:"sick",allowance:5,taken:2.5},{type:"vacation",allowance:20,taken:5}]}},"53ac2791e4b03340b6de4948":{success:!0,total:1,data:{id:"53ac2791e4b03340b6de4948",employeeId:"PER00005",photoUrl:"/data/resources/53b2fd39e4b0123558f41fe6.jpeg",thumbUrl:"/data/resources/thumbnail.53b2fd39e4b0123558f41fe6.jpeg",firstName:"Jennifer",lastName:"Harvey",fullName:"Jennifer Harvey",nickname:"Jennifer Harvey",isPartTime:!1,isContractor:!1,contactNumbers:[{seq:0,type:"email",details:"jennifer@xyz.com"},{seq:0,type:"phone",details:"4043456127"}],departmentName:"Peter Edgar Blake",departmentId:"53ac291c9c1c37083b3d38ae",managerId:"53ac275ee4b03340b6de4947",job:"Accountant",stdCostAmt:88.5,stdCostCur:"USD",timeOff:[{type:"sick",allowance:5,taken:2.5},{type:"vacation",allowance:20,taken:5}]}},"53ac27b0e4b03340b6de4949":{success:!0,total:1,data:{id:"53ac27b0e4b03340b6de4949",employeeId:"PER00099",photoUrl:"/data/resources/53b2fc31e4b0123558f41fe2.jpeg",thumbUrl:"/data/resources/thumbnail.53b2fc31e4b0123558f41fe2.jpeg",firstName:"Richard",lastName:"Minney",fullName:"Richard Minney",nickname:"Richard Minney",isPartTime:!1,isContractor:!0,departmentName:"Peter Edgar Blake",departmentId:"53ac29229c1c37083b3d38af",managerId:"53ac275ee4b03340b6de4947",job:"Support",contactNumbers:[{seq:0,type:"email",details:"jennifer@xyz.com"},{seq:0,type:"phone",details:"4043456127"}],stdCostAmt:88.5,stdCostCur:"USD",timeOff:[{type:"sick",allowance:5,taken:2.5},{type:"vacation",allowance:20,taken:5}]}},"53b435aa3c01cbf76dd3d796":{success:!0,total:1,data:{id:"53b435aa3c01cbf76dd3d796",employeeId:"PER00035",firstName:"Ellie",lastName:"Clarke",fullName:"Elenor Amy Clarke",nickname:"Ellie clarke",isPartTime:!1,isContractor:!1,addressStreet:"23 Ridge Road",contactNumbers:[{seq:0,type:"email",details:"jennifer@xyz.com"},{seq:0,type:"phone",details:"4043456127"}],addressCity:"Princeton",addressStateCode:"NJ",addressPostZip:"08540",addressCountryISO:"US",departmentName:"Operations",departmentId:"53ac29159c1c37083b3d38ad",job:"Developer",stdCostAmt:88.5,stdCostCur:"USD",timeOff:[{type:"sick",allowance:5,taken:2.5},{type:"vacation",allowance:20,taken:5}]}}},c.customerContactDataNew={success:!0,total:1,data:{id:"54046343e4b0212332b4fdf3",type:"external",firstName:"Lynn",lastName:"Taylor",fullName:"Lynn Taylor",nickName:"Lynn Taylor George",addressStreet:"245 Nassau Street",addressCity:"Princeton",addressStateCode:"NJ",addressStateName:"New Jersey",addressPostZip:"08542",addressCountryISO:"US",addressCountryName:"United States of America",addressLat:40.351598,addressLong:-74.651275,contactNumbers:[{seq:0,type:"email",details:"lynn@traveller.com"},{seq:0,type:"LinkedIn",details:"lynn@traveller.com"},{seq:0,type:"Phone",details:"123456789"}],companyName:"Traveller, Inc..",jobTitle:"Analyst"}},c.newContactDetails={success:!0,total:1,data:{id:"5405560de4b0212332b4fdf9",poNumber:"TESTPO123",title:"TITLE DESCRIPT",customerId:"53fdf63ea2c94628879aa175",customerName:"ABC Inc.",value:0,budgetedHours:0,deleted:!1}},c.employeeData={success:!0,total:4,dataType:"employeeList",data:[{id:"53ac275ee4b03340b6de4947",employeeId:"PER00003",thumbUrl:"/data/resources/thumbnail.53b2fd2de4b0123558f41fe5.jpeg",firstName:"Peter",lastName:"Blake",job:"Developer",inactive:!1,commentsExist:!1,attachmentsExist:!1},{id:"53ac2791e4b03340b6de4948",employeeId:"PER00005",thumbUrl:"/data/resources/thumbnail.53b2fd39e4b0123558f41fe6.jpeg",firstName:"Jennifer",lastName:"Harvey",job:"Accountant",managerName:"Peter Edgar Blake",isPartTime:!1,isContractor:!1,inactive:!1,commentsExist:!1,attachmentsExist:!1},{id:"53ac27b0e4b03340b6de4949",employeeId:"PER00099",thumbUrl:"/data/resources/thumbnail.53b2fc31e4b0123558f41fe2.jpeg",firstName:"Richard",lastName:"Minney",job:"Support",managerName:"Peter Edgar Blake",isPartTime:!1,isContractor:!0,inactive:!0,commentsExist:!1,attachmentsExist:!1},{id:"53b435aa3c01cbf76dd3d796",employeeId:"PER00035",firstName:"Ellie",lastName:"Clarke",job:"Developer",inactive:!1,commentsExist:!1,attachmentsExist:!1}]},c.ContractData={success:!0,total:8,dataType:"contractList",data:[{id:"53d80c0713a2e63528ae5379",title:"Pad Line Repair update",poNumber:"PO 434575",startDate:"2014-08-01",endDate:"2014-09-03",value:882,currency:"USD",customerId:"5403d5d0e4b0212332b4fdd5",customerName:"The Mann Einstein Players",commentsExist:!1,attachmentsExist:!1,deleted:!1},{id:"53ff24e7e4b01a8bc7506b5c",title:"testing contracts",poNumber:"PO Wanted",startDate:"2014-09-11",endDate:"2014-09-13",value:3500,currency:"USD",managerId:"53ac1cac9c1c37083b3d38ab",managerName:"Ken Thompson",customerId:"53fdf562a2c94628879aa174",customerName:"Thompson PRs",commentsExist:!1,attachmentsExist:!1,deleted:!1},{id:"53fe62fa03cd3d2d8df32477",title:"African Safari Testing",poNumber:"PO8877",startDate:"2014-09-26",endDate:"2014-09-29",value:12501,currency:"USD",customerId:"53fdf562a2c94628879aa174",customerName:"Thompson PRs",commentsExist:!1,attachmentsExist:!1,deleted:!1},{id:"5400d0dce4b0212332b4fdcb",title:"Pile Driver",poNumber:"PO 098999 - NEW Testing",startDate:"2014-08-01",endDate:"2014-09-09",value:1500001,currency:"USD",customerId:"53fdf4aca2c94628879aa172",customerName:"GeoHay",commentsExist:!1,attachmentsExist:!1,deleted:!1},{id:"5403f405e4b0212332b4fddb",title:"Help Documents",value:0,customerId:"53fdf562a2c94628879aa174",customerName:"Thompson PRs",commentsExist:!1,attachmentsExist:!1,deleted:!1},{id:"5403f58ce4b0212332b4fddc",title:"Macbook Screen",poNumber:"PO2013",value:0,customerId:"53fdf29aa2c94628879aa170",customerName:"Apple Computers",commentsExist:!1,attachmentsExist:!1,deleted:!1},{id:"53ff0d93e4b01a8bc7506b4f",title:"Application",poNumber:"PO12345",startDate:"2014-09-25",endDate:"2014-09-27",value:2e5,currency:"USD",commentsExist:!1,attachmentsExist:!1,deleted:!1},{id:"54045120e4b0212332b4fdf1",title:"New Contract",poNumber:"PO1234",startDate:"2014-09-26",endDate:"2014-09-30",value:0,customerId:"5404080ce4b0212332b4fdde",customerName:"countryw/ostate",commentsExist:!1,attachmentsExist:!1,deleted:!0}]},c.ContractDetailData={success:!0,total:1,data:{id:"53d80b2313a2e63528ae5378",poNumber:"PO 887664",title:"Double Shot",customerId:"53b41103353f736efcab467d",startDate:"2014-09-05",endDate:"2014-09-06",customerName:"Small World",type:"fee",value:0,budgetedHours:67}}}]),angular.module("redPandaApp").directive("datepickers",function(){return{restrict:"A",link:function(a,b,c){b.datepicker({dateFormat:c.format?c.format:"yy-mm-dd"})}}}),angular.module("redPandaApp").directive("xeditable",["$timeout",function(a){return{restrict:"A",require:"ngModel",link:function(b,c,d,e){var f=function(){angular.element(c).editable({display:function(a){e.$setViewValue(a),b.$apply()}})};a(function(){f()},1)}}}]),angular.module("redPandaApp").directive("dropdownMultiselect",function(){return{restrict:"E",scope:{model:"=",options:"=",pre_selected:"=preSelected",tablemodel:"=tablemodel"},replace:!0,template:"<div class='btn-group department dropdown' data-ng-class='{open: open}'><button class='btn btn-small multiselect-btn'><div class='depaertment-select'><span ng-show='model.length == 0'>--Select--</span><span ng-repeat='mod in model'>{{mod}}<span ng-show='($index !=-1 && !$last)'>,</span></span></div></button><button class='btn btn-small dropdown-toggle' data-ng-click='open=!open;openDropdown()'><span class='caret'></span></button><ul class='dropdown-menu' aria-labelledby='dropdownMenu'><li data-ng-repeat='option in options'><a data-ng-click='setSelectedItem()'>{{option.name.nickName}}<span data-ng-class='isChecked(option.name.nickName)'></span></a></li></ul></div>",controller:["$scope","$rootScope",function(a,b){a.model=[],angular.forEach(b.ClonedSelectedManager,function(b){a.model.push(b.name)}),a.setSelectedItem=function(){if(null!=this.option.name&&null!=this.option.name.nickName){var b=this.option.name.nickName;if(_.contains(a.model,b))for(var c=0;c<a.model.length;c++)a.model[c]==b&&(a.tablemodel.splice(c,1),a.model.splice(c,1));else a.model.push(b),a.tablemodel.push({name:b});return!1}},a.isChecked=function(b){return _.contains(a.model,b)?"glyphicon glyphicon-ok pull-right":!1}}]}}),angular.module("redPandaApp").directive("isStdtimeTwodp",function(){return{require:"ngModel",link:function(a,b){a.$watch("EmployeeDetail.data.stdCostAmt",function(b,c){if(""!=b&&null!=b){var d=String(b).split("");if(0!==d.length&&(1!==d.length||"."!==d[0])){for(var e=0;e<d.length;e++)"."===d[e]&&d.length-1-e>2&&(a.EmployeeDetail.data.stdCostAmt=c);if(isNaN(b)){if(null==a.EmployeeDetail)return;a.EmployeeDetail.data.stdCostAmt=c}}}}),b.bind("blur",function(b){var c=b.target.value;if(""!=c){for(var d=!1,e=0;e<b.target.value.length;e++)"."===b.target.value[e]&&(d=!0,e+2!=b.target.value.length+1&&(a.EmployeeDetail.data.stdCostAmt=b.target.value+"0",a.$apply()));d||(a.EmployeeDetail.data.stdCostAmt=b.target.value+".00",a.$apply())}})}}}),angular.module("redPandaApp").directive("hourlyRate",function(){return{require:"ngModel",link:function(a,b,c,d){a.$watch(c.ngModel,function(a,b){if(""!=a&&null!=a){var c=String(a).split("");if(0!==c.length&&(1!==c.length||"."!==c[0])){for(var e=0;e<c.length;e++)"."===c[e]&&c.length-1-e>2&&(d.$setViewValue(b),d.$render());isNaN(a)&&(d.$setViewValue(b),d.$render())}}}),b.bind("blur",function(a){var b=a.target.value;if(""!=b){for(var c=!1,e=0;e<a.target.value.length;e++)"."===a.target.value[e]&&(c=!0,e+2!=a.target.value.length+1&&(d.$setViewValue(a.target.value+"0"),d.$render()));c||(d.$setViewValue(a.target.value+".00"),d.$render())}})}}}),angular.module("redPandaApp").directive("isValue",function(){return{require:"ngModel",link:function(a,b){a.$watch("contractDetail.data.value",function(b,c){if(""!=b&&null!=b){var d=String(b).split("");if(0!==d.length&&(1!==d.length||"."!==d[0])){for(var e=0;e<d.length;e++)"."===d[e]&&d.length-1-e>2&&(a.contractDetail.data.value=c);if(isNaN(b)){if(null==a.contractDetail)return;a.contractDetail.data.value=c}}}}),b.bind("blur",function(b){var c=b.target.value;if(""!=c){for(var d=!1,e=0;e<b.target.value.length;e++)"."===b.target.value[e]&&(d=!0,e+2!=b.target.value.length+1&&(a.contractDetail.data.value=b.target.value+"0",a.$apply()));d||(a.contractDetail.data.value=b.target.value+".00",a.$apply())}})}}}),angular.module("redPandaApp").directive("isOvertimeTwodp",function(){return{require:"ngModel",link:function(a,b){a.$watch("EmployeeDetail.data.otCostAmt",function(b,c){if(""!=b&&null!=b){var d=String(b).split("");if(0!==d.length&&(1!==d.length||"."!==d[0])){for(var e=0;e<d.length;e++)"."===d[e]&&d.length-1-e>2&&(a.EmployeeDetail.data.otCostAmt=c);if(isNaN(b)){if(null==a.EmployeeDetail)return;a.EmployeeDetail.data.otCostAmt=c}}}}),b.bind("blur",function(b){var c=b.target.value;if(""!=c){for(var d=!1,e=0;e<b.target.value.length;e++)"."===b.target.value[e]&&(d=!0,e+2!=b.target.value.length+1&&(a.EmployeeDetail.data.otCostAmt=b.target.value+"0",a.$apply()));d||(a.EmployeeDetail.data.otCostAmt=b.target.value+".00",a.$apply())}})}}}),angular.module("redPandaApp").directive("ngFileSelect",function(){return{link:function(a,b){b.bind("change",function(b){if(a.file=(b.srcElement||b.target).files[0],null!=a.file){if("image"!=a.file.type.split("/")[0])return a.addAlert("Upload valid Image file.","danger"),void a.$apply();a.closeAlert(),a.getFile(a.file)}})}}}),angular.module("redPandaApp").directive("numbersOnly",function(){return{require:"ngModel",link:function(a,b,c,d){d.$parsers.push(function(a){if(void 0==a)return"";var b=a.replace(/[^0-9]/g,"");return b!=a&&(d.$setViewValue(b),d.$render()),b})}}}),angular.module("redPandaApp").service("CurrentTimeStamp",function(){this.postTimeStamp=function(){var a=new Date,b=function(a){var b="00",c="00";return isNegative=!1,b=Math.floor(a/60),0>b&&(b=-b,isNegative=!0),9>b&&(b="0"+b),c=Math.floor(a%60),0>c&&(c=-c),9>c&&(c="0"+c),isNegative?"-"+(b+":"+c):"+"+b+":"+c},c=function(a){var b="";return b=1==a.toString().length?"0"+a:a.toString()},d=function(){var b="",c=a.getMilliseconds();return b=""==c||null==c?"000":2==c.toString().length?"0"+c:1==c.toString().length?"00"+c:c.toString()},e=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+"T"+c(a.getHours())+":"+c(a.getMinutes())+":"+c(a.getSeconds())+"."+d()+b(-a.getTimezoneOffset());return e}}),angular.module("redPandaApp").service("FilterDeleted",function(){this.filter=function(a){var b=[];if("undefined"!=typeof a&&a.length>0){for(var c=0;c<a.length;c++)a[c].deleted?a.splice([c],1):b.push(a[c]);return b}}}),angular.module("redPandaApp").service("IsoDateFormat",function(){this.convert=function(a){var b=new Date(a),c=b.getFullYear(),d=1==(b.getMonth()+1).toString().length?"0"+(b.getMonth()+1):b.getMonth()+1,e=1==b.getDate().toString().length?"0"+b.getDate():b.getDate(),f=c+"-"+d+"-"+e;return f}}),angular.module("redPandaApp").service("USDateFormat",function(){this.convert=function(a,b){var c=new Date(a),d=1==(c.getMonth()+1).toString().length?"0"+(c.getMonth()+1):c.getMonth()+1,e=1==c.getDate().toString().length?"0"+c.getDate():c.getDate(),f=c.getFullYear();if(null!=b)var g=d+"/"+e+"/"+f;else var g=d+"-"+e+"-"+f;return g}});var saveAs=saveAs||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(a){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var b=a.document,c=function(){return a.URL||a.webkitURL||a},d=b.createElementNS("http://www.w3.org/1999/xhtml","a"),e=!a.externalHost&&"download"in d,f=function(c){var d=b.createEvent("MouseEvents");d.initMouseEvent("click",!0,!1,a,0,0,0,0,0,!1,!1,!1,!1,0,null),c.dispatchEvent(d)},g=a.webkitRequestFileSystem,h=a.requestFileSystem||g||a.mozRequestFileSystem,i=function(b){(a.setImmediate||a.setTimeout)(function(){throw b},0)},j="application/octet-stream",k=0,l=[],m=function(){for(var a=l.length;a--;){var b=l[a];"string"==typeof b?c().revokeObjectURL(b):b.remove()}l.length=0},n=function(a,b,c){b=[].concat(b);for(var d=b.length;d--;){var e=a["on"+b[d]];if("function"==typeof e)try{e.call(a,c||a)}catch(f){i(f)}}},o=function(b,i){var m,o,p,q=this,r=b.type,s=!1,t=function(){var a=c().createObjectURL(b);return l.push(a),a},u=function(){n(q,"writestart progress write writeend".split(" "))},v=function(){(s||!m)&&(m=t(b)),o?o.location.href=m:window.open(m,"_blank"),q.readyState=q.DONE,u()},w=function(a){return function(){return q.readyState!==q.DONE?a.apply(this,arguments):void 0}},x={create:!0,exclusive:!1};return q.readyState=q.INIT,i||(i="download"),e?(m=t(b),d.href=m,d.download=i,f(d),q.readyState=q.DONE,void u()):(a.chrome&&r&&r!==j&&(p=b.slice||b.webkitSlice,b=p.call(b,0,b.size,j),s=!0),g&&"download"!==i&&(i+=".download"),(r===j||g)&&(o=a),h?(k+=b.size,void h(a.TEMPORARY,k,w(function(a){a.root.getDirectory("saved",x,w(function(a){var c=function(){a.getFile(i,x,w(function(a){a.createWriter(w(function(c){c.onwriteend=function(b){o.location.href=a.toURL(),l.push(a),q.readyState=q.DONE,n(q,"writeend",b)},c.onerror=function(){var a=c.error;a.code!==a.ABORT_ERR&&v()},"writestart progress write abort".split(" ").forEach(function(a){c["on"+a]=q["on"+a]}),c.write(b),q.abort=function(){c.abort(),q.readyState=q.DONE},q.readyState=q.WRITING}),v)}),v)};a.getFile(i,{create:!1},w(function(a){a.remove(),c()}),w(function(a){a.code===a.NOT_FOUND_ERR?c():v()}))}),v)}),v)):void v())},p=o.prototype,q=function(a,b){return new o(a,b)};return p.abort=function(){var a=this;a.readyState=a.DONE,n(a,"abort")},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,a.addEventListener("unload",m,!1),q.unload=function(){m(),a.removeEventListener("unload",m,!1)},q}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&null!==module?module.exports=saveAs:"undefined"!=typeof define&&null!==define&&null!=define.amd&&define([],function(){return saveAs}),function(a){var b=function(a){var b=function(a,b,c){return function(){c.$apply(function(){b.resolve(a.result)})}},c=function(a,b,c){return function(){c.$apply(function(){b.reject(a.result)})}},d=function(a,b){return function(a){b.$broadcast("fileProgress",{total:a.total,loaded:a.loaded})}},e=function(a,e){var f=new FileReader;return f.onload=b(f,a,e),f.onerror=c(f,a,e),f.onprogress=d(f,e),f},f=function(b,c){var d=a.defer(),f=e(d,c);return f.readAsDataURL(b),d.promise};return{readAsDataUrl:f}};a.factory("fileReader",["$q","$log",b])}(angular.module("redPandaApp")),angular.module("redPandaApp").directive("downloadReport",function(){return{restrict:"A",scope:{isDownloadCreator:"=",saveas:"="},link:function(a){a.$watch("isDownloadCreator",function(b){if(1==b)if(console.log(navigator.userAgent),console.log(navigator.userAgent.search("Safari")),console.log(navigator.userAgent.search("Chrome")),navigator.userAgent.search("Safari")>=0&&navigator.userAgent.search("Chrome")<0){var c=angular.element("#exportable").html().toString(),d="data:application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8,"+encodeURIComponent(c),e=document.createElement("a");e.setAttribute("href","data:text/plain;charset=utf-8,"+d),e.setAttribute("download",a.saveas),e.setAttribute("target","_blank"),e.click(),a.isDownloadCreator=!1}else{var f=new Blob([angular.element("#exportable").html()],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8"});saveAs(f,a.saveas),a.isDownloadCreator=!1}})}}}),function(a){"use strict";var b=function(a,b){this.init("simplecolorpicker",a,b)};b.prototype={constructor:b,init:function(b,c,d){var e=this;if(e.type=b,e.$select=a(c),e.$select.hide(),e.options=a.extend({},a.fn.simplecolorpicker.defaults,d),e.$colorList=null,e.options.picker===!0){var f=e.$select.find("> option:selected").text();e.$icon=a('<span class="simplecolorpicker icon" title="'+f+'" style="background-color: '+e.$select.val()+';" role="button" tabindex="0"></span>').insertAfter(e.$select),e.$icon.on("click."+e.type,a.proxy(e.showPicker,e)),e.$picker=a('<span class="simplecolorpicker picker '+e.options.theme+'"></span>').appendTo(document.body),e.$colorList=e.$picker,a(document).on("mousedown."+e.type,a.proxy(e.hidePicker,e)),e.$picker.on("mousedown."+e.type,a.proxy(e.mousedown,e))}else e.$inline=a('<span class="simplecolorpicker inline '+e.options.theme+'"></span>').insertAfter(e.$select),e.$colorList=e.$inline;e.$select.find("> option").each(function(){var b=a(this),c=b.val(),d=b.is(":selected"),f=b.is(":disabled"),g="";d===!0&&(g=" data-selected");var h="";f===!0&&(h=" data-disabled");var i="";f===!1&&(i=' title="'+b.text()+'"');var j="";f===!1&&(j=' role="button" tabindex="0"');var k=a('<span class="color"'+i+' style="background-color: '+c+';" data-color="'+c+'"'+g+h+j+"></span>");e.$colorList.append(k),k.on("click."+e.type,a.proxy(e.colorSpanClicked,e));var l=b.next();l.is("optgroup")===!0&&e.$colorList.append('<span class="vr"></span>')})},selectColor:function(b){var c=this,d=c.$colorList.find("> span.color").filter(function(){return a(this).data("color").toLowerCase()===b.toLowerCase()});d.length>0?c.selectColorSpan(d):console.error("The given color '"+b+"' could not be found")},showPicker:function(){var a=this.$icon.offset();this.$picker.css({left:a.left-15,top:a.top+this.$icon.outerHeight()}),this.$picker.show(this.options.pickerDelay)},hidePicker:function(){this.$picker.hide(this.options.pickerDelay)},selectColorSpan:function(a){var b=a.data("color"),c=a.prop("title");a.siblings().removeAttr("data-selected"),a.attr("data-selected",""),this.options.picker===!0&&(this.$icon.css("background-color",b),this.$icon.prop("title",c),this.hidePicker()),this.$select.val(b)},colorSpanClicked:function(b){a(b.target).is("[data-disabled]")===!1&&(this.selectColorSpan(a(b.target)),this.$select.trigger("change"))},mousedown:function(a){a.stopPropagation(),a.preventDefault()},destroy:function(){this.options.picker===!0&&(this.$icon.off("."+this.type),this.$icon.remove(),a(document).off("."+this.type)),this.$colorList.off("."+this.type),this.$colorList.remove(),this.$select.removeData(this.type),this.$select.show()}},a.fn.simplecolorpicker=function(c){var d=a.makeArray(arguments);return d.shift(),this.each(function(){var e=a(this),f=e.data("simplecolorpicker"),g="object"==typeof c&&c;void 0===f&&e.data("simplecolorpicker",f=new b(this,g)),"string"==typeof c&&f[c].apply(f,d)})},a.fn.simplecolorpicker.defaults={theme:"",picker:!1,pickerDelay:0}}(jQuery),angular.module("redPandaApp").controller("tableController",["$scope","$timeout","$window","$rootScope",function(a,b,c,d){a.empData=[],a.ngGridTableOptions=a.tableOptions,null==a.ngGridTableOptions.listData&&(a.ngGridTableOptions.listData=[]),a.$watch("ngGridTableOptions.listData",function(b){null!=b&&(d.searchData&&(a.ngGridTableOptions.filterOptions.filterText=d.searchData),a.getTableData(a.ngGridTableOptions.pageOptions.pageSize,a.ngGridTableOptions.pageOptions.currentPage,a.ngGridTableOptions.filterOptions.filterText))},!0),a.rebuildTable=function(){a.tableData.$gridServices.DomUtilityService.RebuildGrid(a.tableData.$gridScope,a.tableData.ngGrid)},a.tableSettings=function(b,c,d){var e=b.slice((c-1)*d,c*d);a.fromshowing=(c-1)*d+1,a.toshowing=c*d,a.empData=e,a.totalServerItems=b.length,a.$$phase||(a.$apply(),a.rebuildTable())},a.getTableData=function(b,c,d){setTimeout(function(){var e;if(d){largeLoad=a.ngGridTableOptions.listData;var f=d.toLowerCase();e=largeLoad.filter(function(a){return-1!=JSON.stringify(a).toLowerCase().indexOf(f)}),a.tableSettings(e,c,b)}else a.tableSettings(a.ngGridTableOptions.listData,c,b)},100)},a.$watch("ngGridTableOptions.pageOptions",function(b,d){b!==d&&(b.pageSize!=d.pageSize&&(a.ngGridTableOptions.pageOptions.currentPage=1),c.scrollTo(0,0),a.getTableData(a.ngGridTableOptions.pageOptions.pageSize,a.ngGridTableOptions.pageOptions.currentPage,a.ngGridTableOptions.filterOptions.filterText))},!0),a.$watch("shiftNav",function(b,c){b!=c&&a.rebuildTable()},!0),a.$watch("ngGridTableOptions.filterOptions",function(b,c){b!=c&&(a.ngGridTableOptions.pageOptions.currentPage=1,d.searchData=a.ngGridTableOptions.filterOptions.filterText,a.getTableData(a.ngGridTableOptions.pageOptions.pageSize,a.ngGridTableOptions.pageOptions.currentPage,a.ngGridTableOptions.filterOptions.filterText))},!0),a.tableData={data:"empData",rowHeight:a.ngGridTableOptions.rowHeight?a.ngGridTableOptions.rowHeight:57,multiSelect:!1,enableRowSelection:!0,enableSorting:!0,showFooter:!1,enableColumnResize:!0,filterOptions:a.ngGridTableOptions.filterOptions,enablePaging:!0,selectedItems:a.selectedData,totalServerItems:"totalServerItems",sortInfo:a.ngGridTableOptions.sortInfo,useExternalSorting:a.ngGridTableOptions.useExternalSorting,pagingOptions:a.ngGridTableOptions.pageOptions,rowTemplate:a.ngGridTableOptions.rowTemplate,columnDefs:a.ngGridTableOptions.columnDefs};var e=function(b,c){null!=a.ngGridTableOptions.listData&&a.ngGridTableOptions.listData.sort(function(a,d){var e,f;if("isContractor"==b&&null==a[b]&&(a[b]=!1),"boolean"!=typeof a[b]&&(null!=a[b]?e="number"!=typeof a[b]?a[b].toLowerCase():a[b]:(null==a[b]||"undefined"==typeof a[b])&&(e=""),null!=d[b]?f="number"!=typeof a[b]?d[b].toLowerCase():d[b]:(null==d[b]||"undefined"==typeof d[b])&&(f="")),"asc"==c){if("boolean"==typeof a[b])return a[b]?-1:1;if(e>f)return 1;if(f>e)return-1}else{if("boolean"==typeof a[b])return a[b]?1:-1;if(e>f)return-1;if(f>e)return 1}})};a.$watch("ngGridTableOptions.sortInfo",function(a,b){(""!=a.fields[0]||""!=b.fields[0])&&e(a.fields[0],a.directions[0])},!0),a.$on("ngGridEventSorted",function(){null!=a.isJsonFormattingNeeded&&a.isJsonFormattingNeeded&&a.formatJSONforDownload()})}]),angular.module("redPandaApp").controller("mapController",["$scope","$cookieStore",function(a,b){a.$watch("needMapCall.callMap",function(b){null!=b&&1==b&&(a.geocoding(),a.needMapCall.callMap=!1)},!0),a.geocoding=function(){var b=new google.maps.Geocoder;null!=a.mapOptions&&(a.street=null!=a.mapOptions.data[a.addressKeys[0]]?a.mapOptions.data[a.addressKeys[0]]:"",a.city=null!=a.mapOptions.data[a.addressKeys[1]]?a.mapOptions.data[a.addressKeys[1]]:"",a.zip=null!=a.mapOptions.data[a.addressKeys[3]]?a.mapOptions.data[a.addressKeys[2]]:"",a.state=null!=a.mapOptions.data[a.addressKeys[2]]?"object"==typeof a.mapOptions.data[a.addressKeys[2]]?a.mapOptions.data[a.addressKeys[2]].name:a.mapOptions.data[a.addressKeys[2]]:"",a.country=null!=a.mapOptions.data[a.addressKeys[4]]?"object"==typeof a.mapOptions.data[a.addressKeys[4]]?a.mapOptions.data[a.addressKeys[4]].name:a.mapOptions.data[a.addressKeys[4]]:"",b.geocode({address:a.street+","+a.city+","+a.state+","+a.zip+","+a.country},function(b,c){var d=[];if(c==google.maps.GeocoderStatus.OK){var e=b[0].geometry.location;for(k in e)e.hasOwnProperty(k)&&d.push(e[k]);a.map={center:{latitude:d[0],longitude:d[1]},zoom:12},a.marker={center:{latitude:d[0],longitude:d[1]}},a.$$phase||(a.$apply(),a.mapOptions.data.addressLat=d[0],a.mapOptions.data.addressLong=d[1])}}))},a.map={center:{latitude:40,longitude:-74.5},zoom:12},"create"!=b.get("detailId")?a.marker={center:{latitude:40,longitude:-74.5}}:(a.marker={center:{}},a.map.zoom=1)}]),angular.module("redPandaApp").controller("EmployeeController",["$scope","$rootScope","$location","$http","$filter","$cookieStore","$timeout","$window",function(a,b,c,d,e,f){b.manage=!0,b.selectedMenu="Employee",a.totalServerItems=0,a.maxSize=3,a.isDowloadClicked=!1,a.orderByField="",a.reverseSort=!0,a.previousSortIndex="",a.formattedEmpList=[],a.selectedData=[],b.calledFromEmployeeDetail?b.calledFromEmployeeDetail=!1:b.searchData=!1,a.isJsonFormattingNeeded=!0,b.closeAlert(),a.sortInfo={fields:["","","","","","","",""],directions:["asc"]},a.filterOptions={filterText:"",useExternalFilter:!1},a.pagingOptions={pageSizes:[1,10,25,50,100],pageSize:10,currentPage:1},a.tableOptions={listData:null,rowTemplate:'<div ng-dblclick="navigateToDetail(row)" ng-style="{ \'cursor\': row.cursor }" ng-repeat="col in renderedColumns" ng-class="col.colIndex()" class="ngCell {{col.cellClass}}"><div class="ngVerticalBar" ng-style="{height: rowHeight}" ng-class="{ ngVerticalBarVisible: !$last }">&nbsp;</div><div ng-cell></div></div>',columnDefs:[{field:"employeeId",displayName:"ID"},{field:"",displayName:"",sortable:!1,cellTemplate:'<span ng-if="row.entity.thumbUrl == null"><img ng-src="img/redPanda50.jpg" class="img-circle"/></span><span ng-if="row.entity.thumbUrl !=null"><img ng-src="{{row.entity.thumbUrl}}" class="img-circle"/></span>'},{field:"firstName",displayName:"First"},{field:"lastName",displayName:"Last"},{field:"job",displayName:"Job"},{field:"departmentName",displayName:"Department"},{field:"managerName",displayName:"Manager",width:"150px"},{field:"isContractor",displayName:"Type",cellTemplate:'<label class="label label-success" ng-show="!row.entity.isContractor">Employee</label><label ng-show="row.entity.isContractor" class="label label-info">Contractor</label>'},{field:"isInactive",displayName:"Status",cellTemplate:'<label ng-show="row.entity[col.field]" class="label label-important">Terminated</label><label ng-show="!row.entity[col.field]" class="label label-success">Active</label>'},{field:"",displayName:"",sortable:!1,cellTemplate:'<div class="emp-icons-container"><button class="btn" ng-class="{\'label-success\':row.entity.commentsExist,\'label-grey\':!row.entity.commentsExist}"><i class="fa fa-comment"></i></button><button class="btn" ng-class="{\'label-info\':row.entity.attachmentsExist,\'label-grey\':!row.entity.attachmentsExist}"> <i class="fa fa-folder-open"></i> </button></div>'}],useExternalSorting:!0,filterOptions:a.filterOptions,pageOptions:a.pagingOptions,sortInfo:a.sortInfo,selectedItems:a.selectedData},a.navigateToDetail=function(a){null!=a?f.put("detailId",a.entity.id):f.put("detailId","create"),b.closeAlert(),c.path("/EmployeeDetail")
},a.DeleteEmployee=function(){a.tableOptions.selectedItems.length>0?(b.closeAlert(),b.showModal("/api/delete/contact/"+a.tableOptions.selectedItems[0].id,"Confirm Delete","Are you sure you would like to delete "+a.tableOptions.selectedItems[0].firstName+" "+a.tableOptions.selectedItems[0].lastName+"<span></span> ? This action can not be undone.","Cancel","Confirm"),a.$watch("isPostSuccess",function(c,d){null!=c&&c!=d&&(b.isPostSuccess?(b.localCache.empList=null,g(),a.tableOptions.selectedItems.length=0):b.addAlert("Failed to delete. ","danger","Error"),b.isPostSuccess=null)})):b.addAlert("Please select an Employee.","warning","Warning")},a.formatJSONforDownload=function(){if(null!=a.employeeList){var b=a.employeeList.length;a.formattedEmpList=[];for(var c=0;b>c;c++)a.formattedEmpList[c]=angular.copy(a.employeeList[c]),a.formattedEmpList[c].isContractor?a.formattedEmpList[c].isContractor&&(emptype="Contractor"):emptype="Employee",inactive=a.formattedEmpList[c].inactive?"Terminated":"Active",a.formattedEmpList[c].type=emptype,a.formattedEmpList[c].inactive=inactive}},a.truncateurl=function(){for(var b=0;b<a.employeeList.length;b++)if(null!=a.employeeList[b].thumbUrl&&""!=a.employeeList[b].thumbUrl){var c=a.employeeList[b].thumbUrl.split("/");if(8==c.length){for(var d="/",e=5;e<c.length;e++)d+=c[e],e!=c.length-1&&(d+="/");a.employeeList[b].thumbUrl=d}}},a.storeManagerNames=function(){a.managers=[],angular.forEach(a.employeeList,function(b){if(!b.deleted&&!b.isInactive)if(null!=b.firstName&&null!=b.lastName){var c=b.firstName+" "+b.lastName;a.managers.push({name:c,id:b.id})}else if(null!=b.lastName){var c=b.lastName;a.managers.push({name:c,id:b.id})}}),b.managerList=a.managers},a.downloadTable=function(){a.isDowloadClicked=!0};var g=function(){null==b.localCache.empList||1==b.localCache.isEmpAPINeeded?d.get("/api/employeeList").success(function(c){a.employeeList=c.data,b.localCache.empList=a.employeeList,a.truncateurl(),a.storeManagerNames(),a.tableOptions.listData=a.employeeList}).error(function(c,d){a.employeeList=b.employeeData.data,b.localCache.empList=a.employeeList,a.truncateurl(),a.storeManagerNames(),a.tableOptions.listData=a.employeeList}):(a.employeeList=b.localCache.empList,a.tableOptions.listData=a.employeeList)};g()}]),angular.module("redPandaApp").controller("customerController",["$scope","$rootScope","$location","$http","$filter","$modal","$cookieStore","$timeout","CurrentTimeStamp",function(a,b,c,d,e,f,g,h,i){b.manage=!0,b.selectedMenu="Customer",a.totalServerItems=0,a.maxSize=3,a.isDowloadClicked=!1,a.orderByField="",a.reverseSort=!0,a.selectedData=[],a.displayWarning=!1,a.alerts=[],a.previousSortIndex="",a.sortInfo={fields:["","","","","","",""],directions:["asc"]},a.formattedCustomerList=[],a.isJsonFormattingNeeded=!0,b.closeAlert(),b.calledFromCustomerDetail?b.calledFromCustomerDetail=!1:b.searchData=!1,a.filterOptions={filterText:"",useExternalFilter:!1},a.pagingOptions={pageSizes:[1,10,25,50,100],pageSize:10,currentPage:1},a.navigateToDetail=function(a){b.fromCustomer=!1,null!=a?g.put("detailId",a.entity.id):g.put("detailId","create"),c.path("/CustomerDetail")},a.formatJSONforDownload=function(){null!=a.customerList&&(a.formattedCustomerList=angular.copy(a.customerList))},a.tableOptions={listData:null,selectedItems:a.selectedData,rowTemplate:'<div ng-dblclick="navigateToDetail(row)" ng-style="{ \'cursor\': row.cursor }" ng-repeat="col in renderedColumns" ng-class="col.colIndex()" class="ngCell {{col.cellClass}}"><div class="ngVerticalBar" ng-style="{height: rowHeight}" ng-class="{ ngVerticalBarVisible: !$last }">&nbsp;</div><div ng-cell></div></div>',useExternalSorting:!0,rowHeight:50,sortInfo:a.sortInfo,filterOptions:a.filterOptions,pageOptions:a.pagingOptions,columnDefs:[{field:"customerId",displayName:"ID",width:"19%"},{field:"customerName",displayName:"Name",width:"20%"},{field:"customerAddress",displayName:"Address",width:"47%"},{field:"",displayName:"",width:"14%",sortable:!1,cellTemplate:'<div class="emp-icons-container"><button class="btn" ng-class="{\'label-success\':row.entity.commentsExist,\'label-grey\':!row.entity.commentsExist}"><i class="fa fa-comment"></i></button><button class="btn" ng-class="{\'label-info\':row.entity.attachmentsExist,\'label-grey\':!row.entity.attachmentsExist}"> <i class="fa fa-folder-open"></i> </button></div>'}]};var j=function(){null==b.localCache.customerList||1==b.localCache.isCustomerAPINeeded?d.get("/api/customerList").success(function(c){a.customerList=c.data,b.localCache.customerList=a.customerList,a.tableOptions.listData=a.customerList}).error(function(c,d){a.customerList=b.customerData.data,a.tableOptions.listData=a.customerList,b.localCache.customerList=a.customerList}):(a.customerList=b.localCache.customerList,a.tableOptions.listData=a.customerList)};j(),a.generateReport=function(){a.isDowloadClicked=!0},a.confirmDelete=function(){if(a.selectedData.length>0){a.closeAlert(),a.displayWarning=!1;var c=(a.selectedData[0].customerId,a.selectedData[0].id),d=a.selectedData[0].customerName;b.showModal("/api/delete/customer/"+c+"?timestamp="+i.postTimeStamp(),"Confirm Delete","Are you sure you would like to delete "+d+"<span></span> ? This action can not be undone.","Cancel","Confirm"),a.$watch("isPostSuccess",function(c,d){null!=c&&c!=d&&(b.isPostSuccess?(b.localCache.customerList=null,j(),b.localCache.isFindCustomerAPINeeded=!0,a.selectedData.length=0):a.addAlert("Failed to delete. ","danger","Error"),b.isPostSuccess=null)})}else a.addAlert("Please select a customer.","warning","Warning")},a.addAlert=function(b,c,d){a.alerts=[],a.alerts.push({message:b,type:c,header:d})},a.closeAlert=function(){a.alerts=[]}}]),angular.module("redPandaApp").controller("ContractController",["$scope","$rootScope","$location","$http","$filter","$modal","$cookieStore","$timeout","CurrentTimeStamp","FilterDeleted","USDateFormat",function(a,b,c,d,e,f,g,h,i,j,k){b.manage=!0,b.selectedMenu="Contract",a.totalServerItems=0,a.maxSize=3,a.isDowloadClicked=!1,a.orderByField="",a.reverseSort=!0,a.selectedData=[],a.previousSortIndex="",a.formattedContractList=[],b.closeAlert(),g.remove("contractId");var l=[];b.calledFromContractDetail?b.calledFromContractDetail=!1:b.searchData=!1,a.isJsonFormattingNeeded=!0,a.sortInfo={fields:["","","","",""],directions:["asc"]},a.filterOptions={filterText:"",useExternalFilter:!1},a.pagingOptions={pageSizes:[1,10,25,50,100],pageSize:10,currentPage:1},a.navigateToDetail=function(a){b.fromCustomer=!1,null!=a?g.put("detailId",a.entity.id):g.put("detailId","create"),c.path("/ContractDetail")},a.formatJSONforDownload=function(){null!=a.ContractList&&(a.formattedContractList=angular.copy(a.ContractList))},a.tableOptions={listData:null,selectedItems:a.selectedData,rowTemplate:'<div ng-dblclick="navigateToDetail(row)" ng-style="{ \'cursor\': row.cursor }" ng-repeat="col in renderedColumns" ng-class="col.colIndex()" class="ngCell {{col.cellClass}}"><div class="ngVerticalBar" ng-style="{height: rowHeight}" ng-class="{ ngVerticalBarVisible: !$last }">&nbsp;</div><div ng-cell></div></div>',useExternalSorting:!0,rowHeight:50,sortInfo:a.sortInfo,filterOptions:a.filterOptions,pageOptions:a.pagingOptions,columnDefs:[{field:"customerName",displayName:"Customer",width:"15%"},{field:"poNumber",displayName:"PO",width:"12%"},{field:"title",displayName:"Description",width:"20%"},{field:"",displayName:"Duration",width:"18%",sortable:!1,cellTemplate:'<div class = "ngCellText"  style="height:50px"><span ng-bind = "row.entity.startDate"></span>-<span ng-bind = "row.entity.endDate"></span></div>'},{field:"value",displayName:"Value",cellTemplate:'<div class = "ngCellText" style="text-align:right;height:50px;"><span ng-if="(row.entity.currency == \'USD\' || row.entity.currency == null)" ng-bind="\'$\'"></span><span ng-bind = "row.entity.value"></span> </div>',sortable:!0,width:"10%"},{field:"managerName",displayName:"Manager",width:"10%"},{field:"",displayName:"",sortable:!1,width:"13%",cellTemplate:'<div class="ngCellText emp-icons-container"><button class="btn" ng-class="{\'label-success\':row.entity.commentsExist,\'label-grey\':!row.entity.commentsExist}"><i class="fa fa-comment"></i></button><button class="btn" ng-class="{\'label-info\':row.entity.attachmentsExist,\'label-grey\':!row.entity.attachmentsExist}"> <i class="fa fa-folder-open"></i> </button></div>'}]},a.convertDatetoUSFormat=function(){for(var b=0;b<a.ContractList.length;b++)null!=a.ContractList[b].startDate&&(a.ContractList[b].startDate=k.convert(a.ContractList[b].startDate,!0)),null!=a.ContractList[b].endDate&&(a.ContractList[b].endDate=k.convert(a.ContractList[b].endDate,!0))};var m=function(){null==b.localCache.ContractList||1==b.localCache.isContractAPINeeded?d.get("/api/contractList").success(function(c){a.ContractList=c.data,b.localCache.ContractList=a.ContractList,a.convertDatetoUSFormat(),l=j.filter(a.ContractList),angular.forEach(l,function(a){null!=a.value&&(a.value=a.value.toFixed(2))}),a.tableOptions.listData=l}).error(function(c,d){a.ContractList=b.ContractData.data,a.convertDatetoUSFormat(),l=j.filter(a.ContractList),angular.forEach(l,function(a){0!=a.value&&null!=a.value&&(a.value=a.value.toFixed(2))}),a.tableOptions.listData=l,b.localCache.ContractList=a.ContractList}):(a.ContractList=b.localCache.ContractList,a.convertDatetoUSFormat(),l=j.filter(a.ContractList),a.tableOptions.listData=l)};m(),a.downloadTable=function(){a.isDowloadClicked=!0},a.confirmDelete=function(){a.selectedData.length>0?(a.closeAlert(),b.showModal("/api/delete/contract/"+a.selectedData[0].id+"?timestamp="+i.postTimeStamp(),"Confirm Delete","Are you sure you would like to delete "+a.selectedData[0].title+"<span></span> ? This action can not be undone.","Cancel","Confirm"),a.$watch("isPostSuccess",function(c,d){null!=c&&c!=d&&(b.isPostSuccess?(b.localCache.ContractList=null,m(),a.selectedData.length=0):b.addAlert("Failed to delete. ","danger","Error"),b.isPostSuccess=null)})):b.addAlert("Please select a Contract.","warning","Warning")}}]),angular.module("redPandaApp").controller("contractDetailController",["$scope","$rootScope","$modal","$http","$location","$cookieStore","CurrentTimeStamp","IsoDateFormat","USDateFormat","$window","$timeout",function(a,b,c,d,e,f,g,h,i,j,k){j.scrollTo(0,0),b.manage=!0,b.selectedMenu="Contract",a.ClonedcontractDetail={},a.UploadDocumentsOptionVisible=!0,a.attachmentsContainerVisible=!1,a.displayUpload=!0,a.disableDelete=!1,a.isError=!1,b.calledFromContractDetail=!0,a.activitiesTableData=[{activity:"",duration:"",billable:"",hourlyRate:"",milestone:""}],a.invoicemethods=[{value:"TM",description:"Activity Hourly Rate"},{value:"Person",description:"Person Hourly Rate"},{value:"Fixed",description:"Fixed Fee"}],a.personHourlyRate=[],a.activeHourlyRate=[],a.mileStone=[],a.peopleMangers=[{name:"",manager:"",hourlyRate:""}],a.ActivitiesStartDate=[],a.ActivitiesEndDate=[],b.managerName=[],b.selectedManager=[],b.alerts=[],a.nickNameList=[],b.ClonedSelectedManager=[],a.peopleMangerscheckbox=[],a.customerContractObj={id:"",title:"",poNumber:"",startDate:"",endDate:"",value:"",currency:"",customerId:"",customerName:"",commentsExist:!1,attachmentsExist:!1,deleted:!1,managerName:""},a.cookContractId="",a.customerID=f.get("detailId");var l,m="";"create"==f.get("contractId")?(f.put("detailId","create"),a.cookContractId=f.get("contractId"),f.remove("contractId")):null!=f.get("contractId")?(l=f.get("detailId"),a.cookContractId=f.get("contractId"),f.put("detailId",a.cookContractId),f.remove("contractId")):a.cookContractId="",null==f.get("detailId")&&e.path("/Contract"),$("#startDate").datepicker({dateFormat:"mm-dd-yy",onSelect:function(){var a=$(this).datepicker("getDate");a&&a.setDate(a.getDate()+1),$("#endDate").datepicker("option","minDate",a)}}),$("#endDate").datepicker({dateFormat:"mm-dd-yy",onSelect:function(){var a=$(this).datepicker("getDate");a&&a.setDate(a.getDate()-1),$("#startDate").datepicker("option","maxDate",a||0)}}),a.getCurrentStartDate=function(b){var c=$(document.activeElement).attr("id");a.activityStartDate="#"+c,a.activityEndDate="#end_"+b,$("#"+c).datepicker({dateFormat:"mm-dd-yy",beforeShow:function(){$(this).datepicker("option","maxDate",$(a.activityEndDate).val())}}),$(a.activityStartDate).datepicker("show")},a.getCurrentEndDate=function(b){var c=$(document.activeElement).attr("id");a.activityEndDate="#"+c,a.activityStartDate="#start_"+b,$("#"+c).datepicker({dateFormat:"mm-dd-yy",beforeShow:function(){$(this).datepicker("option","minDate",$(a.activityStartDate).val())}}),$(a.activityEndDate).datepicker("show")};var n='<div class="ngHeaderSortColumn {{col.headerClass}}" ng-style="{\'cursor\': col.cursor}" ng-class="{ \'ngSorted\': !noSortVisible }"><div ng-click="col.sort($event)" ng-class="\'colt\' + col.index" class="ngHeaderText">{{col.displayName}} <button class="btn btn-default btn-sm" ng-click="addRow(peopleMangers);"><i class="fa fa-plus"></i></button></div><div class="ngSortButtonDown" ng-show="col.showSortButtonDown()"></div><div class="ngSortButtonUp" ng-show="col.showSortButtonUp()"></div><div class="ngSortPriority">{{col.sortPriority}}</div><div ng-class="{ ngPinnedIcon: col.pinned, ngUnPinnedIcon: !col.pinned }" ng-click="togglePin(col)" ng-show="col.pinnable"></div></div><div ng-show="col.resizable" class="ngHeaderGrip" ng-click="col.gripClick($event)" ng-mousedown="col.gripOnMouseDown($event)"></div>',o='<div class="ngHeaderSortColumn {{col.headerClass}}" ng-style="{\'cursor\': col.cursor}" ng-class="{ \'ngSorted\': !noSortVisible }"><div ng-click="col.sort($event)" ng-class="\'colt\' + col.index" class="ngHeaderText">{{col.displayName}} <button class="btn btn-default btn-sm" ng-click="addRow(activitiesTableData)"><i class="fa fa-plus"></i></button></div><div class="ngSortButtonDown" ng-show="col.showSortButtonDown()"></div><div class="ngSortButtonUp" ng-show="col.showSortButtonUp()"></div><div class="ngSortPriority">{{col.sortPriority}}</div><div ng-class="{ ngPinnedIcon: col.pinned, ngUnPinnedIcon: !col.pinned }" ng-click="togglePin(col)" ng-show="col.pinnable"></div></div><div ng-show="col.resizable" class="ngHeaderGrip" ng-click="col.gripClick($event)" ng-mousedown="col.gripOnMouseDown($event)"></div>';a.activitiesTableOptions={data:"activitiesTableData",multiSelect:!1,enableSorting:!1,rowHeight:40,headerRowHeight:40,columnDefs:[{field:"activity",displayName:"Activity",width:"20%",cellTemplate:'<div class="ngCellText calender-flex" style="width: 100%;"><input type="text" class="form-control"/></div>'},{field:"duration",displayName:"Duration",width:"35%",cellTemplate:'<div class="ngCellText calender-flex" style="width: 100%;"><p class="input-group from-date mini-input"><span class="input-group-addon"><i class="fa fa-calendar"></i></span><input type="text" class="form-control" ng-model="ActivitiesStartDate[row.rowIndex]" id ="start_{{row.rowIndex}}" ng-click="getCurrentStartDate(row.rowIndex)" /></p> <span class="text-gap">to</span> <p class="input-group from-date mini-input"><span class="input-group-addon"><i class="fa fa-calendar"></i></span><input type="text" format="mm-dd-yy" id ="end_{{row.rowIndex}}" ng-click ="getCurrentEndDate(row.rowIndex)" ng-model="ActivitiesEndDate[row.rowIndex]" ng-change="checkDate(ActivitiesStartDate[row.rowIndex],ActivitiesEndDate[row.rowIndex])" class="form-control"/></p></div>'},{field:"billable",displayName:"Billable",width:"10%",cellTemplate:'<div class="ngCellText" style="padding: 12px 0px 0px 20px !important;"><input type="checkbox"/></div>'},{field:"hourlyRate",displayName:"Hourly Rate",width:"14%",cellTemplate:'<div class="ngCellText"><input type="text" hourly-Rate  placeholder="Rate"  class="form-control medium-input right_justify" ng-model="activeHourlyRate[row.rowIndex]" ng-disabled="contractDetail.data.type != invoicemethods[0].value"/></div>'},{field:"milestone",displayName:"Fixed Fee",width:"13%",cellTemplate:'<div class="ngCellText"><input type="text" hourly-Rate placeholder="Fixed Fee" class="form-control medium-input right_justify" ng-model="mileStone[row.rowIndex]" ng-disabled="contractDetail.data.type != invoicemethods[2].value"/></div>'},{field:"",displayName:"",width:"5%",headerCellTemplate:o,cellTemplate:'<div class="ngCellText"><button class="btn btn-default btn-sm" ng-click="deleteSelectedRow(row.rowIndex,activitiesTableData)"><i class="fa fa-times"></i></button></div>'}]},a.peopleTableOptions={data:"peopleMangers",multiSelect:!1,enableSorting:!1,rowHeight:40,headerRowHeight:40,columnDefs:[{field:"name",displayName:"Name",width:"38%",cellTemplate:'<div class="ngCellText" style ="width:65%;"><select ng-options="value.name as value.name  for value in nickNames" ng-model ="managerName[row.rowIndex]" class ="form-control" > <option value="">-- Select --</option></select></div>'},{field:"manager",displayName:"Manager",width:"19%",cellTemplate:'<div class="ngCellText" style="padding: 12px 0px 0px 20px !important;"><input ng-click="deselectOthers(row.rowIndex)" ng-model="peopleMangerscheckbox[row.rowIndex]" type="checkbox"></div>'},{field:"hourlyRate",displayName:"Hourly Rate",width:"35%",cellTemplate:'<div class="ngCellText"><input type="text" class="form-control right_justify" hourly-Rate  placeholder="Rate" ng-model="personHourlyRate[row.rowIndex]" ng-disabled="contractDetail.data.type != invoicemethods[1].value"/></div>'},{field:"",displayName:"",width:"5%",headerCellTemplate:n,cellTemplate:'<div class="ngCellText"><button class="btn btn-default btn-sm" ng-click="deleteSelectedRow(row.rowIndex,peopleMangers)"><i class="fa fa-times"></i></button></div>'}]},a.deleteSelectedRow=function(a,b){b.splice(a,1)},a.addRow=function(a){a.push({})},a.deselectOthers=function(b){for(var c=0;c<a.peopleMangers.length;c++)a.peopleMangerscheckbox[c]=!1;a.peopleMangerscheckbox[b]=!0,a.contractDetail.data.managerName=a.managerName[b]},a.$watch("contractDetail.data.type",function(b,c){if(b!=c&&null!=b){if(b!=a.invoicemethods[1].value)for(var d=0;d<a.personHourlyRate.length;d++)a.personHourlyRate[d]="";if(b!=a.invoicemethods[0].value)for(var d=0;d<a.activeHourlyRate.length;d++)a.activeHourlyRate[d]="";if(b!=a.invoicemethods[2].value)for(var d=0;d<a.mileStone.length;d++)a.mileStone[d]=""}}),a.convertToUSDateFormat=function(){null!=a.contractDetail.data.endDate&&(a.contractDetail.data.endDate=i.convert(a.contractDetail.data.endDate)),null!=a.contractDetail.data.startDate&&(a.contractDetail.data.startDate=i.convert(a.contractDetail.data.startDate))},"create"==f.get("detailId")?(a.contractDetail={success:!0,total:1,data:{poNumber:null,title:null,customerId:null,customerName:null,type:"",value:null,budgetedHours:null}},a.isNew=!0):null!=f.get("detailId")&&d.get("/api/contractDetail/"+f.get("detailId")).success(function(c){a.contractDetail=c,a.isError=!1,a.disableDelete=!1,a.disabledSave=!1,null!=a.contractDetail.data.value&&(a.contractDetail.data.value=a.contractDetail.data.value.toFixed(2)),angular.copy(a.contractDetail,a.ClonedcontractDetail,!0),console.log(a.contractDetail),console.log(a.ClonedcontractDetail),a.convertToUSDateFormat(),null!=a.contractDetail.data.managerName&&(a.managerName[0]=a.contractDetail.data.managerName,a.peopleMangerscheckbox[0]=!0),null==a.contractDetail.data.type&&(a.contractDetail.data.type=a.invoicemethods[0].value),b.fromCustomer&&(a.contractDetail.data.customerName=b.customerName)}).error(function(){a.isError=!0,a.disabledSave=!0,"/ContractDetail"==e.path()&&b.addAlert("No contract details available.","danger"),a.contractDetail=b.ContractDetailData,a.convertToUSDateFormat(),null==a.contractDetail.data.type&&(a.contractDetail.data.type=a.invoicemethods[0].value),null!=a.contractDetail.data.value&&(a.contractDetail.data.value=a.contractDetail.data.value.toFixed(2)),angular.copy(a.contractDetail,a.ClonedcontractDetail,!0)}),null==b.localCache.customers||b.localCache.isFindCustomerAPINeeded?d.get("/api/customerList").success(function(c){a.customerList=c.data,b.localCache.customers=a.customerList,b.localCache.isFindCustomerAPINeeded=!1}).error(function(){b.addAlert("Customer List is not available","danger"),a.customerList=b.customerlist.data,b.localCache.customers=a.customerList}):a.customerList=b.localCache.customers,null==b.localCache.managers?d.get("/api/employeeList").success(function(c){a.employeeList=c.data,a.managers=[],angular.forEach(a.employeeList,function(b){if(!b.deleted&&!b.isInactive)if(null!=b.firstName&&null!=b.lastName){var c=b.firstName+" "+b.lastName;a.managers.push({name:c,id:b.id})}else if(null!=b.lastName){var c=b.lastName;a.managers.push({name:c,id:b.id})}}),a.managerList=a.managers,b.localCache.managers=a.managerList,b.peopleTableData=a.managerList,a.nickNames=a.managers}).error(function(){b.addAlert("Manager List is not available","danger"),a.employeeList=b.employeeData.data,a.managers=[],angular.forEach(a.employeeList,function(b){if(!b.deleted&&!b.isInactive)if(null!=b.firstName&&null!=b.lastName){var c=b.firstName+" "+b.lastName;a.managers.push({name:c,id:b.id})}else if(null!=b.lastName){var c=b.lastName;a.managers.push({name:c,id:b.id})}}),a.managerList=a.managers,b.localCache.managers=a.managerList,b.peopleTableData=a.managerList,a.nickNames=a.managers}):(a.managerList=b.localCache.managers,b.peopleTableData=a.managerList,a.nickNames=b.localCache.managers),a.checkDateisChanged=function(){a.contractDetail.data.startDate=""!=$("#startDate").val()?h.convert($("#startDate").val()):"",a.contractDetail.data.endDate=""!=$("#endDate").val()?h.convert($("#endDate").val()):""},a.setPeopleData=function(){if(1==a.peopleMangers.length)a.managerName[0]=a.contractDetail.data.managerName,a.peopleMangerscheckbox[0]=!0;else{for(var b=!1,c=0;c<a.peopleMangers.length;c++)a.peopleMangerscheckbox[c]=!1,a.managerName[c]==a.contractDetail.data.managerName&&(a.peopleMangerscheckbox[c]=!0,b=!0);b||(a.peopleMangers.push({name:"",manager:"",hourlyRate:""}),a.managerName[a.peopleMangers.length-1]=a.contractDetail.data.managerName,a.peopleMangerscheckbox[a.peopleMangers.length-1]=!0)}},a.formatPostData=function(){angular.forEach(a.customerList,function(b){b.customerName==a.contractDetail.data.customerName&&(a.contractDetail.data.customerId=b.id)}),angular.forEach(a.managerList,function(b){b.name==a.contractDetail.data.managerName&&(a.contractDetail.data.managerId=b.id)}),null!=a.contractDetail.data.value&&(a.contractDetail.data.currency="USD")},a.backtocontract=function(){if(a.isError)return e.path("/Contract"),void b.closeAlert();if("create"!=f.get("detailId"))if(angular.equals(a.ClonedcontractDetail,a.contractDetail))b.localCache.isContractAPINeeded=!1;else{if(""==a.contractDetail.data.title)return void b.addAlert("You must enter a description for the contract to be saved.","danger");b.closeAlert(),a.checkDateisChanged(),a.savecontractData()}else b.localCache.isContractAPINeeded=!1;b.closeAlert(),a.cookContractId?(f.put("detailId",a.customerID),e.path("/CustomerDetail")):e.path("/Contract")};var p=function(b){return a.customerContractObj.id=b.id,a.customerContractObj.title=b.title,a.customerContractObj.poNumber=b.poNumber,0!=b.value&&null!=b.value&&(b.value=Number(b.value).toFixed(2)),null!=b.startDate&&""!=b.startDate&&(a.customerContractObj.startDate=i.convert(b.startDate,!0)),null!=b.endDate&&""!=b.endDate&&(a.customerContractObj.endDate=i.convert(b.endDate,!0)),a.customerContractObj.value=b.value,a.customerContractObj.customerId=b.customerId,a.customerContractObj.customerName=b.customerName,a.customerContractObj.commentsExist=!1,a.customerContractObj.attachmentsExist=!1,a.customerContractObj.deleted=!1,a.customerContractObj.currency="USD",a.customerContractObj.managerName=b.managerName,a.customerContractObj};a.savecontractData=function(){if(""==a.contractDetail.data.title)return void b.addAlert("You must enter a description for the contract to be saved.","danger");if(a.inSave=!0,a.checkDateisChanged(),console.log(angular.equals(a.ClonedcontractDetail,a.contractDetail)),console.log("cloned",a.ClonedcontractDetail),console.log("contractDetail",a.contractDetail),!angular.equals(a.ClonedcontractDetail,a.contractDetail)){b.closeAlert(),a.formatPostData();var c=a.contractDetail.data,h=g.postTimeStamp();d({method:"post",url:"/api/contractDetail/update?timestamp="+h,data:c,headers:{"content-type":"application/json"}}).success(function(c){"/ContractDetail"==e.path()&&b.addAlert("Updated successfully","success"),a.contractDetail=c,b.localCache.isContractAPINeeded=!0,angular.copy(a.contractDetail,a.ClonedcontractDetail,!0),"create"==f.get("detailId")&&(void 0==c.data.id||f.put("detailId",c.data.id)),a.inSave=!1,m=k(function(){if(a.cookContractId){if(f.put("detailId",a.customerID),"create"==a.cookContractId){var c={};c=p(a.contractDetail.data),null==b.cutomerContractCopy.data.contractList&&(b.cutomerContractCopy.data.contractList=[]),null==b.cutomerContractCopy.data.contractIds&&(b.cutomerContractCopy.data.contractIds=[]),b.cutomerContractCopy.data.contractList.push(c),b.cutomerContractCopy.data.contractIds.push(c.id)}else{var c={};c=p(a.contractDetail.data),b.cutomerContractCopy.data.contractList[b.rowIndex]=c,b.cutomerContractCopy.data.contractIds[b.rowIndex]=c.id}e.path("/CustomerDetail")}else e.path("/Contract")},1e3)}).error(function(){if("/ContractDetail"==e.path()&&b.addAlert("Update failed","danger"),a.contractDetail=b.newContactDetails,a.inSave=!1,a.cookContractId){if(f.put("detailId",a.customerID),"create"==a.cookContractId){var c={};c=p(a.contractDetail.data),b.cutomerContractCopy.data.contractList.push(c),b.cutomerContractCopy.data.contractIds.push(c.id)}e.path("/CustomerDetail")}else e.path("/Contract")})}},a.confirmDelete=function(){b.showModal("/api/delete/contract/"+f.get("detailId")+"?timestamp="+g.postTimeStamp(),"Confirm Delete","Are you sure you would like to delete "+a.contractDetail.data.title+"<span></span> ? This action can not be undone.","Cancel","Confirm"),a.$watch("isPostSuccess",function(a,c){null!=a&&a!=c&&(b.isPostSuccess?(b.localCache.isContractAPINeeded=!0,e.path("/Contract")):b.addAlert("Delete Failed.","danger"),b.isPostSuccess=null)})},a.showUploadContainer=function(){a.UploadDocumentsOptionVisible=!1,a.attachmentsContainerVisible=!0},a.hideUploadContainer=function(){a.UploadDocumentsOptionVisible=!0,a.attachmentsContainerVisible=!1},a.inSave=!1,a.$watch("contractDetail",function(b,c){a.inSave||b!=c&&(angular.equals(a.ClonedcontractDetail,a.contractDetail)||(a.disabledSave=!1))},!0),a.stackedProgress=function(){a.stacked=[];var b=0,c=0,d=0;valArray=[b,c,d];for(var e=["success","warning","danger"],f=0;f<e.length;f++)a.stacked.push({value:valArray[f],type:e[f]})},a.stackedProgress(),a.$on("$destroy",function(){k.cancel(m)})}]),angular.module("redPandaApp").controller("employeeDetailController",["$scope","$rootScope","$modal","$http","$location","$cookieStore","$filter","$window","CurrentTimeStamp","$timeout","fileReader",function(a,b,c,d,e,f,g,h,i,j,k){b.manage=!0,b.selectedMenu="Employee",a.ClonedEmployeeDetail={},b.calledFromEmployeeDetail=!0,a.timeOff=[],a.UploadDocumentsOptionVisible=!0,a.attachmentsContainerVisible=!1,a.minDate=a.minDate?null:new Date,a.alerts=[],a.showEmptyContactDetail=!1,a.defaultContactType="",a.isError=!1,a.needFormat=!0,a.mapOptions={},a.needMapCall={callMap:!1},a.inCreateMode=!1,a.addressKeys=["addressStreet","addressCity","addressStateCode","addressPostZip","addressCountryISO"],a.contactTypeValue=[],a.contactTypeDetails=[];var l="";if(a.isHireDateSetinServer=!1,a.isTermDateSetinServer=!1,$("#hireDate").datepicker({dateFormat:"mm-dd-yy",onSelect:function(){var b=$(this).datepicker("getDate");b&&b.setDate(b.getDate()+1),a.disabledSave=!1,$("#endDate").datepicker("option","minDate",b)}}),$("#endDate").datepicker({dateFormat:"mm-dd-yy",onSelect:function(){var b=$(this).datepicker("getDate");b&&b.setDate(b.getDate()-1),a.disabledSave=!1,$("#hireDate").datepicker("option","maxDate",b||0)}}),null!=b.managerList?a.ManagerList=b.managerList:d.get("/api/employeeList").success(function(c){a.employeeList=c.data,a.managers=[],angular.forEach(a.employeeList,function(b){if(!b.deleted&&!b.isInactive)if(null!=b.firstName&&null!=b.lastName){var c=b.firstName+" "+b.lastName;a.managers.push({name:c,id:b.id})}else if(null!=b.lastName){var c=b.lastName;a.managers.push({name:c,id:b.id})}}),b.managerList=a.managers,a.ManagerList=b.managerList}).error(function(){console.log("Manager list not available")}),null==f.get("detailId")&&e.path("/Employee"),a.truncateurl=function(){if(null!=a.EmployeeDetail.data.photoUrl&&""!=a.EmployeeDetail.data.photoUrl){var b=a.EmployeeDetail.data.photoUrl.split("/");if(8==b.length){for(var c="/",d=5;d<b.length;d++)c+=b[d],d!=b.length-1&&(c+="/");a.EmployeeDetail.data.photoUrl=c}}},a.formatMapData=function(){null!=a.EmployeeDetail&&null!=a.EmployeeDetail.data.addressCountryISO&&null!=a.countries&&angular.forEach(a.countries,function(b){b.code==a.EmployeeDetail.data.addressCountryISO&&(a.EmployeeDetail.data.addressCountryISO=b)}),null!=a.EmployeeDetail&&null!=a.EmployeeDetail.data.addressStateCode&&null!=a.states&&angular.forEach(a.states,function(b){b.code==a.EmployeeDetail.data.addressStateCode&&(a.EmployeeDetail.data.addressStateCode=b)}),null!=a.EmployeeDetail&&(null!=a.EmployeeDetail.data.hireDate&&(a.isHireDateSetinServer=!0,a.EmployeeDetail.data.hireDate=USDateFormat.convert(a.EmployeeDetail.data.hireDate)),null!=a.EmployeeDetail.data.termDate&&(a.isTermDateSetinServer=!0,a.EmployeeDetail.data.termDate=USDateFormat.convert(a.EmployeeDetail.data.termDate)))},a.formatInputData=function(){if(null!=a.EmployeeDetail)for(var b=(a.EmployeeDetail.data.contactNumbers.length,0);b<a.EmployeeDetail.data.contactNumbers.length;b++)a.contactTypeDetails[b]=a.EmployeeDetail.data.contactNumbers[b].details,a.contactTypeValue[b]=a.EmployeeDetail.data.contactNumbers[b].type},a.formatCostamt=function(){""!=a.EmployeeDetail.data.otCostAmt&&null!=a.EmployeeDetail.data.otCostAmt&&(a.EmployeeDetail.data.otCostAmt=a.EmployeeDetail.data.otCostAmt.toFixed(2))},a.formatStdamt=function(){""!=a.EmployeeDetail.data.stdCostAmt&&null!=a.EmployeeDetail.data.stdCostAmt&&(a.EmployeeDetail.data.stdCostAmt=a.EmployeeDetail.data.stdCostAmt.toFixed(2))},"create"==f.get("detailId")){a.EmployeeDetail={success:!0,total:0,data:{employeeId:"",firstName:"",lastName:"",fullName:"",nickname:"",isPartTime:!1,isContractor:!1,departmentId:"",job:"",timeOff:[]}},a.showEmptyContactDetail=!0,(null==a.EmployeeDetail.data.contactNumbers||0===a.EmployeeDetail.data.contactNumbers.length)&&(a.EmployeeDetail.data.contactNumbers=[],a.EmployeeDetail.data.contactNumbers.push({}),a.contactTypeValue[0]="email",a.contactTypeDetails[0]=""),(null==a.EmployeeDetail.data.timeOff||0==a.EmployeeDetail.data.timeOff.length)&&(a.EmployeeDetail.data.timeOff=[{type:"Vacation",allowance:0,taken:0},{type:"Sick",allowance:0,taken:0}]);for(var m=0;m<a.EmployeeDetail.data.timeOff.length;m++)a.timeOff.push({type:a.EmployeeDetail.data.timeOff[m].type,allowance:a.EmployeeDetail.data.timeOff[m].allowance,taken:a.EmployeeDetail.data.timeOff[m].taken,balance:a.EmployeeDetail.data.timeOff[m].allowance-a.EmployeeDetail.data.timeOff[m].taken});a.mapOptions=a.EmployeeDetail,angular.copy(a.EmployeeDetail,a.ClonedEmployeeDetail,!0),a.inCreateMode=!0}else null!=f.get("detailId")&&d.get("/api/employeeDetail/"+f.get("detailId")).success(function(b){a.EmployeeDetail=b,a.truncateurl(),a.mapOptions=a.EmployeeDetail,a.needMapCall.callMap=!0,(null==a.EmployeeDetail.data.contactNumbers||0===a.EmployeeDetail.data.contactNumbers.length)&&(a.EmployeeDetail.data.contactNumbers=[],a.EmployeeDetail.data.contactNumbers.push({}),a.contactTypeValue[0]="email",a.contactTypeDetails[0]=""),(null==a.EmployeeDetail.data.timeOff||0==a.EmployeeDetail.data.timeOff.length)&&(a.EmployeeDetail.data.timeOff=[{type:"Vacation",allowance:0,taken:0},{type:"Sick",allowance:0,taken:0}]);for(var c=0;c<a.EmployeeDetail.data.timeOff.length;c++)a.timeOff.push({type:a.EmployeeDetail.data.timeOff[c].type,allowance:a.EmployeeDetail.data.timeOff[c].allowance,taken:a.EmployeeDetail.data.timeOff[c].taken,balance:a.EmployeeDetail.data.timeOff[c].allowance-a.EmployeeDetail.data.timeOff[c].taken});
a.formatCostamt(),a.formatStdamt(),a.formatInputData(),angular.copy(a.EmployeeDetail,a.ClonedEmployeeDetail,!0),a.formatMapData(),console.log(a.ClonedEmployeeDetail),console.log(a.EmployeeDetail),a.isError=!1}).error(function(){a.addAlert("Employee Detail not available.","danger"),a.isError=!0,a.EmployeeDetail=b.EmployeeDetailObject[f.get("detailId")],a.truncateurl(),a.mapOptions=a.EmployeeDetail,a.needMapCall.callMap=!0,(null==a.EmployeeDetail.data.contactNumbers||0===a.EmployeeDetail.data.contactNumbers.length)&&(a.EmployeeDetail.data.contactNumbers=[],a.EmployeeDetail.data.contactNumbers.push({}),a.contactTypeValue[0]="Phone",a.contactTypeDetails[0]=""),(null==a.EmployeeDetail.data.timeOff||0==a.EmployeeDetail.data.timeOff.length)&&(a.EmployeeDetail.data.timeOff=[{type:"Vacation",allowance:0,taken:0},{type:"Sick",allowance:0,taken:0}]);for(var c=0;c<a.EmployeeDetail.data.timeOff.length;c++)a.timeOff.push({type:a.EmployeeDetail.data.timeOff[c].type,allowance:a.EmployeeDetail.data.timeOff[c].allowance,taken:a.EmployeeDetail.data.timeOff[c].taken,balance:a.EmployeeDetail.data.timeOff[c].allowance-a.EmployeeDetail.data.timeOff[c].taken});a.formatCostamt(),a.formatStdamt(),a.formatInputData(),angular.copy(a.EmployeeDetail,a.ClonedEmployeeDetail,!0)});null==b.localCache.department?d.get("/api/find/department").success(function(c){a.departments=c.data,b.localCache.department=a.departments}).error(function(){}):a.departments=b.localCache.department,null==b.localCache.jobs?d.get("/api/listData/jobs").success(function(c){a.jobs=c.data,b.localCache.jobs=a.jobs}).error(function(){a.jobsJson={success:!0,total:1,data:["Manager","Consultant","Tea Boy"]},a.jobs=a.jobsJson.data,b.localCache.jobs=a.jobs}):a.jobs=b.localCache.jobs,null==b.localCache.states?d.get("/api/listData/states").success(function(c){a.states=c.data,b.localCache.states=a.states,a.formatInputData(),a.formatMapData()}).error(function(){a.state_namesJson={success:!0,total:1,data:[{name:"Alabama",code:"AL"},{name:"Alaska",code:"AK"},{name:"Arizona",code:"AZ"},{name:"Arkansas",code:"AR"},{name:"California",code:"CA"},{name:"Colorado",code:"CO"},{name:"Connecticut",code:"CT"},{name:"Delaware",code:"DE"},{name:"District of Columbia",code:"DC"},{name:"Florida",code:"FL"},{name:"Georgia",code:"GA"},{name:"Hawaii",code:"HI"},{name:"Idaho",code:"ID"},{name:"Illinois",code:"IL"},{name:"Indiana",code:"IN"},{name:"Iowa",code:"IA"},{name:"Kansa",code:"KS"},{name:"Kentucky",code:"KY"},{name:"Lousiana",code:"LA"},{name:"Maine",code:"ME"},{name:"Maryland",code:"MD"},{name:"Massachusetts",code:"MA"},{name:"Michigan",code:"MI"},{name:"Minnesota",code:"MN"},{name:"Mississippi",code:"MS"},{name:"Missouri",code:"MO"},{name:"Montana",code:"MT"},{name:"Nebraska",code:"NE"},{name:"Nevada",code:"NV"},{name:"New Hampshire",code:"NH"},{name:"New Jersey",code:"NJ"},{name:"New Mexico",code:"NM"},{name:"New York",code:"NY"},{name:"North Carolina",code:"NC"},{name:"North Dakota",code:"ND"},{name:"Ohio",code:"OH"},{name:"Oklahoma",code:"OK"},{name:"Oregon",code:"OR"},{name:"Pennsylvania",code:"PA"},{name:"Rhode Island",code:"RI"},{name:"South Carolina",code:"SC"},{name:"South Dakota",code:"SD"},{name:"Tennessee",code:"TN"},{name:"Texas",code:"TX"},{name:"Utah",code:"UT"},{name:"Vermont",code:"VT"},{name:"Virginia",code:"VA"},{name:"Washington",code:"WA"},{name:"West Virginia",code:"WV"},{name:"Wisconsin",code:"WI"},{name:"Wyoming",code:"WY"}]},a.states=a.state_namesJson.data,b.localCache.states=a.states,a.formatInputData()}):(a.states=b.localCache.states,a.formatInputData(),a.formatMapData()),null==b.localCache.countries?d.get("/api/listData/countries").success(function(c){a.countries=c.data,b.localCache.countries=a.countries,a.formatInputData(),a.formatMapData()}).error(function(){a.countriesJson={success:!0,total:1,data:[{name:"Ascension Island",code:"AC"},{name:"Andorra",code:"AD"},{name:"United Arab Emirates",code:"AE"},{name:"Afghanistan",code:"AF"},{name:"Antigua And Barbuda",code:"AG"},{name:"Anguilla",code:"AI"},{name:"Albania",code:"AL"},{name:"Armenia",code:"AM"},{name:"Angola",code:"AO"},{name:"Antarctica",code:"AQ"},{name:"Argentina",code:"AR"},{name:"American Samoa",code:"AS"},{name:"Austria",code:"AT"},{name:"Australia",code:"AU"},{name:"Aruba",code:"AW"},{name:"Azerbaijan",code:"AZ"},{name:"Bosnia & Herzegovina",code:"BA"},{name:"Barbados",code:"BB"},{name:"Bangladesh",code:"BD"},{name:"Belgium",code:"BE"},{name:"Burkina Faso",code:"BF"},{name:"Bulgaria",code:"BG"},{name:"Bahrain",code:"BH"},{name:"Burundi",code:"BI"},{name:"Benin",code:"BJ"},{name:"Bermuda",code:"BM"},{name:"Brunei Darussalam",code:"BN"},{name:"Bolivia, Plurinational State Of",code:"BO"},{name:"Afghanistan",code:"AF"},{name:"Antigua And Barbuda",code:"AG"},{name:"Anguilla",code:"AI"},{name:"Albania",code:"AL"},{name:"Armenia",code:"AM"},{name:"Angola",code:"AO"},{name:"Antarctica",code:"AQ"},{name:"Argentina",code:"AR"},{name:"American Samoa",code:"AS"},{name:"Austria",code:"AT"},{name:"Australia",code:"AU"},{name:"Aruba",code:"AW"},{name:"Azerbaijan",code:"AZ"},{name:"Bosnia & Herzegovina",code:"BA"},{name:"Barbados",code:"BB"},{name:"Bangladesh",code:"BD"},{name:"Belgium",code:"BE"},{name:"Burkina Faso",code:"BF"},{name:"Bulgaria",code:"BG"},{name:"Bahrain",code:"BH"},{name:"Burundi",code:"BI"},{name:"Benin",code:"BJ"},{name:"Bermuda",code:"BM"},{name:"Brunei Darussalam",code:"BN"},{name:"Bolivia, Plurinational State Of",code:"BO"},{name:"Bonaire, Saint Eustatius And Saba",code:"BQ"},{name:"Brazil",code:"BR"},{name:"Bahamas",code:"BS"},{name:"Bhutan",code:"BT"},{name:"Bouvet Island",code:"BV"},{name:"Botswana",code:"BW"},{name:"Belarus",code:"BY"},{name:"Belize",code:"BZ"},{name:"Canada",code:"CA"},{name:"Cocos (Keeling) Islands",code:"CC"},{name:"Democratic Republic Of Congo",code:"CD"},{name:"Central African Republic",code:"CF"},{name:"Republic Of Congo",code:"CG"},{name:"Switzerland",code:"CH"},{name:"Cote d'Ivoire",code:"CI"},{name:"Cook Islands",code:"CK"},{name:"Chile",code:"CL"},{name:"Cameroon",code:"CM"},{name:"China",code:"CN"},{name:"Colombia",code:"CO"},{name:"Clipperton Island",code:"CP"},{name:"Costa Rica",code:"CR"},{name:"Cuba",code:"CU"},{name:"Cape Verde",code:"CV"},{name:"Curacao",code:"CW"},{name:"Christmas Island",code:"CX"},{name:"Cyprus",code:"CY"},{name:"Czech Republic",code:"CZ"},{name:"Germany",code:"DE"},{name:"Diego Garcia",code:"DG"},{name:"Djibouti",code:"DJ"},{name:"Denmark",code:"DK"},{name:"Dominica",code:"DM"},{name:"Dominican Republic",code:"DO"},{name:"Algeria",code:"DZ"},{name:"Ceuta, Mulilla",code:"EA"},{name:"Ecuador",code:"EC"},{name:"Estonia",code:"EE"},{name:"Egypt",code:"EG"},{name:"Western Sahara",code:"EH"},{name:"Eritrea",code:"ER"},{name:"Spain",code:"ES"},{name:"Ethiopia",code:"ET"},{name:"European Union",code:"EU"},{name:"Finland",code:"FI"},{name:"Fiji",code:"FJ"},{name:"Falkland Islands",code:"FK"},{name:"Micronesia, Federated States Of",code:"FM"},{name:"Faroe Islands",code:"FO"},{name:"France",code:"FR"},{name:"France, Metropolitan",code:"FX"},{name:"Gabon",code:"GA"},{name:"United Kingdom",code:"GB"},{name:"Grenada",code:"GD"},{name:"Georgia",code:"GE"},{name:"French Guiana",code:"GF"},{name:"Guernsey",code:"GG"},{name:"Ghana",code:"GH"},{name:"Gibraltar",code:"GI"},{name:"Greenland",code:"GL"},{name:"Gambia",code:"GM"},{name:"Great Britain",code:"GB"},{name:"Guinea",code:"GN"},{name:"Guadeloupe",code:"GP"},{name:"Equatorial Guinea",code:"GQ"},{name:"Greece",code:"GR"},{name:"South Georgia And The South Sandwich Islands",code:"GS"},{name:"Guatemala",code:"GT"},{name:"Guam",code:"GU"},{name:"Guinea-bissau",code:"GW"},{name:"Guyana",code:"GY"},{name:"Hong Kong",code:"HK"},{name:"Heard Island And McDonald Islands",code:"HM"},{name:"Honduras",code:"HN"},{name:"Croatia",code:"HR"},{name:"Haiti",code:"HT"},{name:"Hungary",code:"HU"},{name:"Canary Islands",code:"IC"},{name:"Indonesia",code:"ID"},{name:"Ireland",code:"IE"},{name:"Israel",code:"IL"},{name:"Isle Of Man",code:"IM"},{name:"India",code:"IN"},{name:"British Indian Ocean Territory",code:"IO"},{name:"Iraq",code:"IQ"},{name:"Iran, Islamic Republic Of",code:"IR"},{name:"Iceland",code:"IS"},{name:"Italy",code:"IT"},{name:"Jersey",code:"JE"},{name:"Jamaica",code:"JM"},{name:"Jordan",code:"JO"},{name:"Japan",code:"JP"},{name:"Kenya",code:"KE"},{name:"Kyrgyzstan",code:"KG"},{name:"Cambodia",code:"KH"},{name:"Kiribati",code:"KI"},{name:"Comoros",code:"KM"},{name:"Saint Kitts And Nevis",code:"KN"},{name:"Korea, Democratic People's Republic Of",code:"KP"},{name:"Korea, Republic Of",code:"KR"},{name:"Kuwait",code:"KW"},{name:"Cayman Islands",code:"KY"},{name:"Kazakhstan",code:"KZ"},{name:"Lao People's Democratic Republic",code:"LA"},{name:"Lebanon",code:"LB"},{name:"Saint Lucia",code:"LC"},{name:"Liechtenstein",code:"LI"},{name:"Sri Lanka",code:"LK"},{name:"Liberia",code:"LR"},{name:"Lesotho",code:"LS"},{name:"Lithuania",code:"LT"},{name:"Luxembourg",code:"LU"},{name:"Latvia",code:"LV"},{name:"Libya",code:"LY"},{name:"Morocco",code:"MA"},{name:"Monaco",code:"MC"},{name:"Moldova",code:"MD"},{name:"Montenegro",code:"ME"},{name:"Saint Martin",code:"MF"},{name:"Madagascar",code:"MG"},{name:"Marshall Islands",code:"MH"},{name:"Macedonia, The Former Yugoslav Republic Of",code:"MK"},{name:"Mali",code:"ML"},{name:"Myanmar",code:"MM"},{name:"Mongolia",code:"MN"},{name:"Macao",code:"MO"},{name:"Northern Mariana Islands",code:"MP"},{name:"Martinique",code:"MQ"},{name:"Mauritania",code:"MR"},{name:"Montserrat",code:"MS"},{name:"Malta",code:"MT"},{name:"Mauritius",code:"MU"},{name:"Maldives",code:"MV"},{name:"Malawi",code:"MW"},{name:"Mexico",code:"MX"},{name:"Malaysia",code:"MY"},{name:"Mozambique",code:"MZ"},{name:"Namibia",code:"NA"},{name:"New Caledonia",code:"NC"},{name:"Niger",code:"NE"},{name:"Norfolk Island",code:"NF"},{name:"Nigeria",code:"NG"},{name:"Nicaragua",code:"NI"},{name:"Netherlands",code:"NL"},{name:"Norway",code:"NO"},{name:"Nepal",code:"NP"},{name:"Nauru",code:"NR"},{name:"Niue",code:"NU"},{name:"New Zealand",code:"NZ"},{name:"Oman",code:"OM"},{name:"Panama",code:"PA"},{name:"Peru",code:"PE"},{name:"French Polynesia",code:"PF"},{name:"Papua New Guinea",code:"PG"},{name:"Philippines",code:"PH"},{name:"Pakistan",code:"PK"},{name:"Poland",code:"PL"},{name:"Saint Pierre And Miquelon",code:"PM"},{name:"Pitcairn",code:"PN"},{name:"Puerto Rico",code:"PR"},{name:"Palestinian Territory, Occupied",code:"PS"},{name:"Portugal",code:"PT"},{name:"Palau",code:"PW"},{name:"Paraguay",code:"PY"},{name:"Qatar",code:"QA"},{name:"Reunion",code:"RE"},{name:"Romania",code:"RO"},{name:"Serbia",code:"RS"},{name:"Russian Federation",code:"RU"},{name:"Rwanda",code:"RW"},{name:"Saudi Arabia",code:"SA"},{name:"Solomon Islands",code:"SB"},{name:"Seychelles",code:"SC"},{name:"Sudan",code:"SD"},{name:"Sweden",code:"SE"},{name:"Singapore",code:"SG"},{name:"Saint Helena, Ascension And Tristan Da Cunha",code:"SH"},{name:"Slovenia",code:"SI"},{name:"Svalbard And Jan Mayen",code:"SJ"},{name:"Slovakia",code:"SK"},{name:"Sierra Leone",code:"SL"},{name:"San Marino",code:"SM"},{name:"Senegal",code:"SN"},{name:"Somalia",code:"SO"},{name:"Suriname",code:"SR"},{name:"South Sudan",code:"SS"},{name:"SÃŒÂ£o TomÃŒÂ© and PrÃŒ_ncipe",code:"ST"},{name:"USSR",code:"SU"},{name:"El Salvador",code:"SV"},{name:"Sint Maarten",code:"SX"},{name:"Syrian Arab Republic",code:"SY"},{name:"Swaziland",code:"SZ"},{name:"Tristan de Cunha",code:"TA"},{name:"Turks And Caicos Islands",code:"TC"},{name:"Chad",code:"TD"},{name:"French Southern Territories",code:"TF"},{name:"Togo",code:"TG"},{name:"Thailand",code:"TH"},{name:"Tajikistan",code:"TJ"},{name:"Tokelau",code:"TK"},{name:"East Timor",code:"TL"},{name:"Turkmenistan",code:"TM"},{name:"Tunisia",code:"TN"},{name:"Tonga",code:"TO"},{name:"Turkey",code:"TR"},{name:"Trinidad And Tobago",code:"TT"},{name:"Tuvalu",code:"TV"},{name:"Taiwan, Province Of China",code:"TW"},{name:"Tanzania, United Republic Of",code:"TZ"},{name:"Ukraine",code:"UA"},{name:"Uganda",code:"UG"},{name:"United Kingdom",code:"GB"},{name:"United States Minor Outlying Islands",code:"UM"},{name:"United States",code:"US"},{name:"Uruguay",code:"UY"},{name:"Uzbekistan",code:"UZ"},{name:"Vatican City State",code:"VA"},{name:"Saint Vincent And The Grenadines",code:"VC"},{name:"Venezuela, Bolivarian Republic Of",code:"VE"},{name:"Virgin Islands (British)",code:"VG"},{name:"Virgin Islands (US)",code:"VI"},{name:"Viet Nam",code:"VN"},{name:"Vanuatu",code:"VU"},{name:"Wallis And Futuna",code:"WF"},{name:"Samoa",code:"WS"},{name:"Yemen",code:"YE"},{name:"Mayotte",code:"YT"},{name:"South Africa",code:"ZA"},{name:"Zambia",code:"ZM"},{name:"Zimbabwe",code:"ZW"}]},a.countries=a.countriesJson.data,b.localCache.countries=a.countries,a.formatInputData()}):(a.countries=b.localCache.countries,a.formatInputData(),a.formatMapData()),null==b.localCache.contactNumTypes?d.get("/api/listData/contactNumberTypes").success(function(c){a.contactNumberTypes=c.data,b.localCache.contactNumTypes=a.contactNumberTypes}).error(function(){a.contactNumberTypesJson={success:!0,total:1,data:["Phone","email","Skype","LinkedIn"]},a.contactNumberTypes=a.contactNumberTypesJson.data,b.localCache.contactNumTypes=a.contactNumberTypes}):a.contactNumberTypes=b.localCache.contactNumTypes,a.empTimeOffGridOptions={data:"timeOff",enableColumnResize:!0,columnDefs:[{field:"type",displayName:"",width:"20%"},{field:"",displayName:"Allowance",cellTemplate:'<label class="allowance-text right-justify" ng-bind="row.entity.allowance"></label>',width:"20%"},{field:"taken",displayName:"Taken",cellTemplate:'<label class="taken-text right-justify" ng-bind="row.entity.taken"></label>',width:"20%"},{field:"balance",displayName:"Balance",cellTemplate:'<label class="balance-text right-justify" ng-bind="row.entity.balance"></label>',width:"20%"},{dispalyName:"",cellTemplate:'<a href= "javascript:void(0);">details</a>',width:"20%"}]},a.saveContactNumbers=function(){for(var b=!1,c=0;c<a.contactTypeDetails.length;c++)if(""!=a.contactTypeValue[c]&&null!=a.contactTypeValue[c]&&"email"==a.contactTypeValue[c].toLowerCase()){var d=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(!d.test(a.contactTypeDetails[c])){b=!0;break}}if(!b){a.EmployeeDetail.data.contactNumbers=[];for(var e=-1,f=-1,g=-1,h=-1,c=0;c<a.contactTypeDetails.length;c++)""!=a.contactTypeDetails[c]&&""!=a.contactTypeValue[c]&&null!=a.contactTypeValue[c]&&null!=a.contactTypeDetails[c]&&("email"==a.contactTypeValue[c].toLowerCase()&&(e++,a.EmployeeDetail.data.contactNumbers.push({details:a.contactTypeDetails[c],seq:e,type:a.contactTypeValue[c]})),"phone"==a.contactTypeValue[c].toLowerCase()&&(f++,a.EmployeeDetail.data.contactNumbers.push({details:a.contactTypeDetails[c],seq:f,type:a.contactTypeValue[c]})),"skype"==a.contactTypeValue[c].toLowerCase()&&(h++,a.EmployeeDetail.data.contactNumbers.push({details:a.contactTypeDetails[c],seq:h,type:a.contactTypeValue[c]})),"linkedin"==a.contactTypeValue[c].toLowerCase()&&(g++,a.EmployeeDetail.data.contactNumbers.push({details:a.contactTypeDetails[c],seq:g,type:a.contactTypeValue[c]})))}return b},a.deleteEmployeeContactInfo=function(b){a.contactTypeDetails.splice(b,1),a.contactTypeValue.splice(b,1),a.EmployeeDetail.data.contactNumbers.splice(b,1),0==a.EmployeeDetail.data.contactNumbers.length&&(a.EmployeeDetail.data.contactNumbers.push({}),a.contactTypeDetails[0]="",a.contactTypeValue[0]="Phone")},a.addEmployeeContactInfo=function(){var b=a.EmployeeDetail.data.contactNumbers.length;a.EmployeeDetail.data.contactNumbers.push({}),a.contactTypeDetails[b]="",a.contactTypeValue[b]=a.contactNumberTypes[0]},a.addAlert=function(b,c){a.alerts=[],a.alerts.push({message:b,type:c}),h.scrollTo(0,0)},a.closeAlert=function(){a.alerts=[]},a.Validatetypeahead=function(b,c,d,e,f){if(null==d)return-1==b.indexOf(c)?(a.addAlert(e,f),!1):(a.closeAlert(),!0);var g=!1;return angular.forEach(b,function(a){a[d]==c&&(g=!0)}),g?(a.closeAlert(),!0):(a.addAlert(e,f),!1)},a.assignNames=function(){var b=[];switch(b=a.EmployeeDetail.data.nickname.split(" "),b.length){case 1:a.EmployeeDetail.data.lastName=a.EmployeeDetail.data.nickname;break;case 2:a.EmployeeDetail.data.lastName=b[1],a.EmployeeDetail.data.firstName=b[0];break;case 3:a.EmployeeDetail.data.lastName=b[2],a.EmployeeDetail.data.firstName=b[0];break;default:a.EmployeeDetail.data.lastName=b[b.length-1],a.EmployeeDetail.data.firstName=b[0]}},a.isImageuploaded=!1,a.getFile=function(){k.readAsDataUrl(a.file,a).then(function(b){a.imageSrc=b,$(".PersonImage").width()>120&&(a.containImg=!0),a.disabledSave=!1,a.isImageuploaded=!0})},a.backtoEmp=function(){if("create"!=f.get("detailId")){if(a.isError)return b.localCache.isEmpAPINeeded=!1,void e.path("/Employee");if(a.checkDateisChanged(),angular.equals(a.ClonedEmployeeDetail,a.EmployeeDetail))b.localCache.isEmpAPINeeded||(b.localCache.isEmpAPINeeded=!1);else{if(""==a.EmployeeDetail.data.nickname)return void a.addAlert("Enter Employee Name.","danger");a.closeAlert(),a.saveEmpdata()}}else b.localCache.isEmpAPINeeded=!1;e.path("/Employee")},a.formatPostData=function(){null!=a.EmployeeDetail.data.otCostAmt&&(a.EmployeeDetail.data.otCostAmt=parseFloat(a.EmployeeDetail.data.otCostAmt)),null!=a.EmployeeDetail.data.stdCostAmt&&(a.EmployeeDetail.data.stdCostAmt=parseFloat(a.EmployeeDetail.data.stdCostAmt)),a.EmployeeDetail.data.fullName=a.EmployeeDetail.data.nickname,null!=a.EmployeeDetail.data.addressStateCode&&(a.EmployeeDetail.data.addressStateCode=a.EmployeeDetail.data.addressStateCode.code),null!=a.EmployeeDetail.data.addressCountryISO&&(a.EmployeeDetail.data.addressCountryISO=a.EmployeeDetail.data.addressCountryISO.code),""!=a.EmployeeDetail.data.hireDate||a.isHireDateSetinServer||delete a.EmployeeDetail.data.hireDate,""!=a.EmployeeDetail.data.termDate||a.isTermDateSetinServer||delete a.EmployeeDetail.data.termDate},a.imageUpload=function(){var c=new FormData;c.append("file",a.file),c.append("contactId",f.get("detailId")),d.post("/api/upload/photo",c,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(){console.log("Image Updated Successfully"),a.addAlert("Image Updated Successfully","success"),a.isImageuploaded=!1,b.localCache.isEmpAPINeeded=!0}).error(function(c,d){console.log("Imaged Update Failed"),a.addAlert("Image update failed","danger"),a.isImageuploaded=!1,a.inSave=!1,413==d&&(null!=a.addAlert&&a.addAlert("Image update failed:Image file exceeds maximum area.Please choose a file under 1MB.","danger"),b.addAlert("Image update failed:Image file exceeds maximum area.Please choose a file under 1MB.","danger"))})},a.checkDateisChanged=function(){a.EmployeeDetail.data.hireDate=""!=$("#hireDate").val()?IsoDateFormat.convert($("#hireDate").val()):$("#hireDate").val(),a.EmployeeDetail.data.termDate=""!=$("#endDate").val()?IsoDateFormat.convert($("#endDate").val()):$("#endDate").val()},a.isChangeinContactNumbers=!1,a.$watch("EmployeeDetail.data.contactNumbers",function(b,c){null!=b&&b!=c&&(a.isChangeinContactNumbers=!0)}),a.saveEmpdata=function(){a.inSave=!0;if(a.isImageuploaded&&"create"!=f.get("detailId")&&a.imageUpload(),a.checkDateisChanged(),null!=a.ClonedEmployeeDetail.data.contactNumbers&&(a.contactNumbersClonedArray=a.ClonedEmployeeDetail.data.contactNumbers,delete a.ClonedEmployeeDetail.data.contactNumbers),null!=a.EmployeeDetail.data.contactNumbers&&(a.contactNumbersArray=a.EmployeeDetail.data.contactNumbers,delete a.ClonedEmployeeDetail.data.contactNumbers),!angular.equals(a.ClonedEmployeeDetail,a.EmployeeDetail)||isChangeinContactNumbers){if(""==a.EmployeeDetail.data.nickname)return a.addAlert("Enter Employee Name.","danger"),a.inSave=!1,void(a.needFormat=!1);if(a.assignNames(),a.saveContactNumbers())return a.addAlert("Enter valid email address.","danger"),a.inSave=!1,void(a.needFormat=!1);if(a.closeAlert(),a.EmployeeDetail.data.contactNumbers=a.contactNumbersArray,angular.forEach(a.departments,function(b){b.id==a.EmployeeDetail.data.departmentId&&(a.EmployeeDetail.data.departmentName=b.name)}),""!=a.EmployeeDetail.data.addressCountryISO&&null!=a.EmployeeDetail.data.addressCountryISO&&0==a.Validatetypeahead(a.countries,a.EmployeeDetail.data.addressCountryISO.name,"name","Enter a valid Country Code","danger"))return void(a.inSave=!1);if(""!=a.EmployeeDetail.data.addressStateCode&&null!=a.EmployeeDetail.data.addressStateCode&&0==a.Validatetypeahead(a.states,a.EmployeeDetail.data.addressStateCode.name,"name","Enter a valid State Code","danger"))return void(a.inSave=!1);a.needMapCall.callMap=!0,a.formatPostData();var c=a.EmployeeDetail.data,g=i.postTimeStamp();d({method:"post",url:"/api/employeeDetail/update?timestamp="+g,data:c,headers:{"content-type":"application/json"}}).success(function(c){a.addAlert("Updated successfully","success"),a.EmployeeDetail=c,"create"==f.get("detailId")&&(f.put("detailId",c.data.id),a.isImageuploaded&&a.imageUpload()),a.formatCostamt(),a.formatStdamt(),a.formatInputData(),a.formatMapData(),a.isImageuploaded=!1,a.inSave=!1,b.localCache.isEmpAPINeeded=!0,angular.copy(a.EmployeeDetail,a.ClonedEmployeeDetail,!0),a.inCreateMode=!1,a.disabledSave=!0,l=j(function(){e.path("/Employee")},1e3)}).error(function(){a.addAlert("Update failed","danger"),a.isImageuploaded=!1,a.inSave=!1,b.localCache.isEmpAPINeeded=!1})}},a.confirmDelete=function(){b.showModal("/api/delete/contact/"+f.get("detailId"),"Confirm Delete","Are you sure you would like to delete "+a.EmployeeDetail.data.nickname+"<span></span> ? This action can not be undone.","Cancel","Confirm"),a.$watch("isPostSuccess",function(c,d){null!=c&&c!=d&&(b.isPostSuccess?(b.localCache.isEmpAPINeeded=!0,e.path("/Employee")):a.addAlert("Delete Failed.","danger"),b.isPostSuccess=null)})},a.showUploadContainer=function(){a.UploadDocumentsOptionVisible=!1,a.attachmentsContainerVisible=!0},a.hideUploadContainer=function(){a.UploadDocumentsOptionVisible=!0,a.attachmentsContainerVisible=!1},a.inSave=!1,a.$watch("EmployeeDetail",function(b,c){a.inSave||b!=c&&(angular.equals(a.ClonedEmployeeDetail,a.EmployeeDetail)||(a.disabledSave=!1))},!0),a.$watch("employeeNewContact.info",function(b,c){if(!a.inSave&&b!=c){if(""==b||null==b)return;a.disabledSave=!1}},!0),a.$on("$destroy",function(){j.cancel(l)})}]),angular.module("redPandaApp").controller("customerDetailController",["$scope","$rootScope","$modal","$http","$location","$cookieStore","$filter","$anchorScroll","CurrentTimeStamp","$timeout",function(a,b,c,d,e,f,g,h,i,j,k){b.manage=!0,b.selectedMenu="Customer",a.companycollapseTable=!1,a.ClonedCustomerDetail={},b.copyCustomerDetails={},a.alerts=[],a.mapOptions={},a.lastUpdated=g("date")((new Date).getTime(),"yyyy-MM-dd"),a.UploadDocumentsOptionVisible=!0,a.attachmentsContainerVisible=!1,a.displayUpload=!0,a.customerHeading="",a.disableDelete=!1,a.newCustomer=!0,a.noDataAvailable=!1,a.needMapCall={callMap:!1},a.addressKeys=["addressStreet","addressCity","addressStateCode","addressPostZip","addressISOCountry"],a.isError=!1,a.contractTableData=[],a.contactTableData=[],a.currentPath=e.path();var l=[],m=[],n="";b.calledFromCustomerDetail=!0,$('select[name="colorpicker"]').simplecolorpicker({picker:!0}),null==f.get("detailId")&&e.path("/Customer");var o='<div class="ngHeaderSortColumn {{col.headerClass}}" ng-style="{\'cursor\': col.cursor}" ng-class="{ \'ngSorted\': !noSortVisible }"><div ng-click="col.sort($event)" ng-class="\'colt\' + col.index" class="ngHeaderText">{{col.displayName}} <button ng-click="navigateToContractDetail()" class="btn btn-default btn-sm"><i class="fa fa-plus"></i></button></div><div class="ngSortButtonDown" ng-show="col.showSortButtonDown()"></div><div class="ngSortButtonUp" ng-show="col.showSortButtonUp()"></div><div class="ngSortPriority">{{col.sortPriority}}</div><div ng-class="{ ngPinnedIcon: col.pinned, ngUnPinnedIcon: !col.pinned }" ng-click="togglePin(col)" ng-show="col.pinnable"></div></div><div ng-show="col.resizable" class="ngHeaderGrip" ng-click="col.gripClick($event)" ng-mousedown="col.gripOnMouseDown($event)"></div>',p='<div class="ngHeaderSortColumn {{col.headerClass}}" ng-style="{\'cursor\': col.cursor}" ng-class="{ \'ngSorted\': !noSortVisible }"><div ng-click="col.sort($event)" ng-class="\'colt\' + col.index" class="ngHeaderText">{{col.displayName}} <button ng-click="openContactInfo()" class="btn btn-default btn-sm"><i class="fa fa-plus"></i></button></div><div class="ngSortButtonDown" ng-show="col.showSortButtonDown()"></div><div class="ngSortButtonUp" ng-show="col.showSortButtonUp()"></div><div class="ngSortPriority">{{col.sortPriority}}</div><div ng-class="{ ngPinnedIcon: col.pinned, ngUnPinnedIcon: !col.pinned }" ng-click="togglePin(col)" ng-show="col.pinnable"></div></div><div ng-show="col.resizable" class="ngHeaderGrip" ng-click="col.gripClick($event)" ng-mousedown="col.gripOnMouseDown($event)"></div>';a.contactTableoptions={data:"contactTableData",multiSelect:!1,headerRowHeight:40,rowHeight:40,rowTemplate:'<div ng-dblclick="openContactInfo(row,row.rowIndex)" ng-style="{ \'cursor\': row.cursor }" ng-repeat="col in renderedColumns" ng-class="col.colIndex()" class="ngCell {{col.cellClass}}"><div class="ngVerticalBar" ng-style="{height: rowHeight}" ng-class="{ ngVerticalBarVisible: !$last }">&nbsp;</div><div ng-cell></div></div>',columnDefs:[{field:"name",width:"89%",displayName:"Contacts"},{field:"",displayName:"",sortable:!1,width:"11%",cellTemplate:'<div class="ngCellText"  style="text-align: center;"><button class="btn btn-default btn-sm" ng-click="deleteContactList(row,row.rowIndex)" ><i class="fa fa-times"></i></button></div>',headerCellTemplate:p}]},a.contractTableoptions={data:"contractTableData",multiSelect:!1,enableSorting:!1,rowHeight:45,headerRowHeight:40,rowTemplate:'<div ng-dblclick="navigateToContractDetail(row,row.rowIndex)" ng-style="{ \'cursor\': row.cursor }" ng-repeat="col in renderedColumns" ng-class="col.colIndex()" class="ngCell {{col.cellClass}}"><div class="ngVerticalBar" ng-style="{height: rowHeight}" ng-class="{ ngVerticalBarVisible: !$last }">&nbsp;</div><div ng-cell></div></div>',columnDefs:[{field:"poNumber",displayName:"PO",width:"10%"},{field:"title",displayName:"Description",width:"20%"},{field:"",displayName:"Dates",width:"20%",cellTemplate:'<div class = "ngCellText" style ="height:44px;"><span ng-bind = "row.entity.startDate"></span>-<span ng-bind = "row.entity.endDate"></span></div>'},{field:"value",displayName:"Value",cellTemplate:'<div class = "ngCellText" style ="height:44px; line-height:33px; text-align:right;width:100%;display:inline-block; padding-right: 69px;text-overflow:clip !important;"><span ng-if="(row.entity.currency == \'USD\' || row.entity.currency == null)" ng-bind="\'$\'"></span><span  ng-bind = "row.entity.value"></span> </div>',sortable:!0,width:"10%"},{field:"managerName",displayName:"Contract Manager",width:"20%"},{field:"",displayName:"",sortable:!1,width:"15%",cellTemplate:'<div class="ngCellText emp-icons-container commentsButton"><button class="btn" style="margin-right:5px" ng-class="{\'label-success\':row.entity.commentsExist,\'label-grey\':!row.entity.commentsExist}"><i class="fa fa-comment"></i></button><button class="btn" ng-class="{\'label-info\':row.entity.attachmentsExist,\'label-grey\':!row.entity.attachmentsExist}"> <i class="fa fa-folder-open"></i> </button></div>'},{field:"",displayName:"",sortable:!1,width:"5%",cellTemplate:'<div class="ngCellText emp-icons-container deleteButton" style="text-align: center;"><button class="btn btn-default btn-sm" ng-click="deleteContractList(row, row.rowIndex)" ><i class="fa fa-times"></i></button></div>',headerCellTemplate:o}]},a.deleteContractList=function(c,d){b.indexvalue=d;var e=c.entity;a.closeAlert(),b.showModal("/api/delete/contract/"+e.id+"?timestamp="+i.postTimeStamp(),"Confirm Delete","Are you sure you would like to delete "+e.title+"<span></span> ? This action can not be undone.","Cancel","Confirm"),a.$watch("isPostSuccess",function(c,d){if(null!=c&&c!=d){if(b.isPostSuccess){a.CustomerDetail.data.contractList.splice(b.indexvalue,1),a.CustomerDetail.data.contractIds.splice(b.indexvalue,1);var e=k.filter(a.CustomerDetail.data.contractList);a.contractTableData=e}else b.addAlert("Failed to delete. ","danger","Error");b.isPostSuccess=null}})},a.deleteContactList=function(c,d){var e=c.entity;b.indexValue=d,b.showModal("/api/delete/contact/"+e.id+"?timestamp="+i.postTimeStamp(),"Confirm Delete","Are you sure you would like to delete "+e.name+"<span></span> ? This action can not be undone.","Cancel","Confirm"),a.$watch("isPostSuccess",function(c,d){null!=c&&c!=d&&(b.isPostSuccess?(a.CustomerDetail.data.contactIds.splice(b.indexValue,1),a.CustomerDetail.data.contactList.splice(b.indexValue,1),a.contactTableData=a.CustomerDetail.data.contactList):console.log("Failed to delete"),b.isPostSuccess=null)})},a.navigateToContractDetail=function(c,d){b.cutomerContractCopy={},angular.copy(a.CustomerDetail,b.cutomerContractCopy,!0),b.fromCustomer=!0,null!=c?(f.put("contractId",c.entity.id),b.rowIndex=d):(b.customerName=a.CustomerDetail.data.customerName,f.put("contractId","create")),e.path("/ContractDetail")},a.formatInputData=function(){null!=a.CustomerDetail&&null!=a.CustomerDetail.data.addressISOCountry&&null!=a.countries&&angular.forEach(a.countries,function(b){b.code==a.CustomerDetail.data.addressISOCountry&&(a.CustomerDetail.data.addressISOCountry=b)}),null!=a.CustomerDetail&&null!=a.CustomerDetail.data.addressStateCode&&null!=a.states&&angular.forEach(a.states,function(b){b.code==a.CustomerDetail.data.addressStateCode&&(a.CustomerDetail.data.addressStateCode=b)})},"create"==f.get("detailId")?(a.newCustomer=!0,a.CustomerDetail={success:!0,total:1,data:{customerId:null,customerName:"",contactList:[],contactIds:[],contractList:[],contractIds:[],color:"#009999"}},b.fromCustomer&&(angular.copy(b.cutomerContractCopy,a.CustomerDetail,!0),b.fromCustomer=!1,m=k.filter(a.CustomerDetail.data.contractList),a.contractTableData=m,l=k.filter(a.CustomerDetail.data.contactList),a.contactTableData=l),a.disableDelete=!0,a.showEmptyContactDetail=!0,a.mapOptions=a.CustomerDetail):(a.newCustomer=!1,a.showEmptyContactDetail=!0,null!=f.get("detailId")&&(b.fromCustomer?(a.CustomerDetail={},angular.copy(a.CustomerDetail,a.ClonedCustomerDetail,!0),a.CustomerDetail=b.cutomerContractCopy,a.mapOptions=a.CustomerDetail,a.needMapCall.callMap=!0,a.customerHeading=a.CustomerDetail.data.customerName,a.isError=!1,a.formatInputData(),angular.copy(a.CustomerDetail,a.ClonedCustomerDetail,!0),a.newCustomer=!1,b.customerName=a.CustomerDetail.data.customerName,$('select[name="colorpicker"]').simplecolorpicker("selectColor",a.CustomerDetail.data.color),l=k.filter(a.CustomerDetail.data.contactList),a.contactTableData=l,m=k.filter(a.CustomerDetail.data.contractList),a.contractTableData=m,b.fromCustomer=!1):d.get("/api/customerDetail/"+f.get("detailId")).success(function(c){a.CustomerDetail=c,a.mapOptions=a.CustomerDetail,a.needMapCall.callMap=!0,a.customerHeading=c.data.customerName,a.isError=!1,m=k.filter(a.CustomerDetail.data.contractList),$('select[name="colorpicker"]').simplecolorpicker("selectColor",a.CustomerDetail.data.color),angular.forEach(m,function(a){null!=a.value&&(a.value=Number(a.value).toFixed(2)),null!=a.endDate&&(a.endDate=USDateFormat.convert(a.endDate,!0)),null!=a.startDate&&(a.startDate=USDateFormat.convert(a.startDate,!0))}),l=k.filter(a.CustomerDetail.data.contactList),a.contactTableData=l,a.contractTableData=m,a.formatInputData(),angular.copy(a.CustomerDetail,a.ClonedCustomerDetail,!0),console.log(a.CustomerDetail),console.log(a.ClonedCustomerDetail),a.newCustomer=!1,b.customerName=a.CustomerDetail.data.customerName,b.fromCustomer=!1}).error(function(){a.isError=!0,a.addAlert("No customer details available.","danger")})),b.fromCustomer&&(a.disabledSave=!1),a.disableDelete=!1,a.disabledSave=!0),null==b.localCache.states?d.get("/api/listData/states").success(function(c){a.states=c.data,b.localCache.states=a.states,a.formatInputData()
}).error(function(){}):(a.states=b.localCache.states,a.formatInputData()),null==b.localCache.countries?d.get("/api/listData/countries").success(function(c){a.countries=c.data,b.localCache.countries=a.countries,a.formatInputData()}).error(function(){}):(a.countries=b.localCache.countries,a.formatInputData()),a.addAlert=function(b,c){a.alerts=[],a.alerts.push({message:b,type:c}),h()},a.closeAlert=function(){a.alerts=[]},a.Validatetypeahead=function(b,c,d,e,f){if(null==d)return-1==b.indexOf(c)?(a.addAlert(e,f),!1):(a.closeAlert(),!0);var g=!1;return angular.forEach(b,function(a){a[d]==c&&(g=!0)}),g?(a.closeAlert(),!0):(a.addAlert(e,f),!1)},a.backtoCustomer=function(){if(a.isError)return b.localCache.isCustomerAPINeeded=!1,void e.path("/Customer");if("create"!=f.get("detailId"))if(angular.equals(a.ClonedCustomerDetail,a.CustomerDetail))b.localCache.isCustomerAPINeeded||(b.localCache.isCustomerAPINeeded=!1);else{if(""==a.CustomerDetail.data.customerName)return void a.addAlert("Enter Customer Name.","danger");a.closeAlert(),a.saveCustomerData()}else b.localCache.isCustomerAPINeeded=!1;e.path("/Customer")},a.saveCustomerData=function(){if(""==a.CustomerDetail.data.customerName)return void a.addAlert("Enter Customer Name.","danger");if(a.disabledSave=!0,a.inSave=!0,console.log(angular.equals(a.ClonedCustomerDetail,a.CustomerDetail)),console.log("Customer cloned data",a.ClonedCustomerDetail),console.log("Customer data",a.CustomerDetail),!angular.equals(a.ClonedCustomerDetail,a.CustomerDetail)){if(a.closeAlert(),b.localCache.isCustomerAPINeeded=!0,""!=a.CustomerDetail.data.addressISOCountry&&null!=a.CustomerDetail.data.addressISOCountry&&0==a.Validatetypeahead(a.countries,a.CustomerDetail.data.addressISOCountry.name,"name","Enter a valid Country Code","danger"))return void(a.inSave=!1);if(""!=a.CustomerDetail.data.addressStateCode&&null!=a.CustomerDetail.data.addressStateCode&&0==a.Validatetypeahead(a.states,a.CustomerDetail.data.addressStateCode.name,"name","Enter a valid State Code","danger"))return void(a.inSave=!1);a.needMapCall.callMap=!0,null!=a.CustomerDetail.data.addressStateCode&&(a.CustomerDetail.data.addressStateCode=a.CustomerDetail.data.addressStateCode.code),null!=a.CustomerDetail.data.addressISOCountry&&(a.CustomerDetail.data.addressISOCountry=a.CustomerDetail.data.addressISOCountry.code);var c=a.CustomerDetail.data,g=i.postTimeStamp();d({method:"post",url:"/api/customerDetail/update?timestamp="+g,data:c,headers:{"content-type":"application/json"}}).success(function(c){a.addAlert("Updated successfully","success"),a.CustomerDetail=c,b.localCache.isCustomerAPINeeded=!0,b.localCache.isFindCustomerAPINeeded=!0,a.formatInputData(),angular.copy(a.CustomerDetail,a.ClonedCustomerDetail,!0),"create"==f.get("detailId")&&(f.put("detailId",c.data.id),a.newCustomer=!1),a.inSave=!1,n=j(function(){e.path("/Customer")},1e3)}).error(function(){a.addAlert("Update failed","danger"),b.localCache.isCustomerAPINeeded=!1,b.localCache.isFindCustomerAPINeeded=!1,a.inSave=!1})}},a.confirmDelete=function(){var c=a.CustomerDetail.data.customerName;b.showModal("/api/delete/customer/"+f.get("detailId")+"?timestamp="+i.postTimeStamp(),"Confirm Delete","Are you sure you would like to delete "+c+"<span></span> ? This action can not be undone.","Cancel","Confirm"),a.$watch("isPostSuccess",function(c,d){null!=c&&c!=d&&(b.isPostSuccess?(b.localCache.isCustomerAPINeeded=!0,b.localCache.isFindCustomerAPINeeded=!0,e.path("/Customer")):a.addAlert("Delete Failed.","danger"),b.isPostSuccess=null)})},a.showUploadContainer=function(){a.UploadDocumentsOptionVisible=!1,a.attachmentsContainerVisible=!0},a.hideUploadContainer=function(){a.UploadDocumentsOptionVisible=!0,a.attachmentsContainerVisible=!1},a.inSave=!1,a.$watch("CustomerDetail",function(b,c){a.inSave||b!=c&&(angular.equals(a.ClonedCustomerDetail,a.CustomerDetail)||(a.disabledSave=!1))},!0),a.changeColor=function(){var b=angular.element(document.querySelector("#colorBox"));b.css({"background-color":a.pickedColor,color:a.pickedColor})},a.openContactInfo=function(d,e){b.contactRowIndex=e,angular.copy(a.CustomerDetail,b.copyCustomerDetails,!0),null!=d?f.put("contactID",d.entity.id):f.put("contactID","create"),a.modalInstance=c.open({templateUrl:"views/ContactPopUp.html"}),a.modalInstance.result.then(function(c){"create"==f.get("contactID")?(null==a.CustomerDetail.data.contactIds&&(a.CustomerDetail.data.contactIds=[]),null==a.CustomerDetail.data.contactList&&(a.CustomerDetail.data.contactList=[]),a.CustomerDetail.data.contactList.push(c),a.CustomerDetail.data.contactIds.push(c.id),a.contactTableData=a.CustomerDetail.data.contactList):(a.CustomerDetail.data.contactList[b.contactRowIndex]=c,a.CustomerDetail.data.contactIds[b.contactRowIndex]=c.id,a.contactTableData=a.CustomerDetail.data.contactList),a.modalInstance=null},function(){a.modalInstance=null})},a.$on("$destroy",function(){null!=a.modalInstance&&a.modalInstance.close(),j.cancel(n)})}]),angular.module("redPandaApp").controller("ContactModalController",["$scope","$rootScope","$route","$http","CurrentTimeStamp","$cookieStore",function(a,b,c,d,e,f){a.noContactSelected=!1,a.invalidEmail=!1,a.debugMode=!0,a.invalidEmail=!1,a.isImageuploaded=!1,a.isRequired=!1,a.mapOptions={},a.needMapCall={callMap:!1},a.addressKeys=["addressStreet","addressCity","addressStateCode","addressPostZip","addressCountryISO"],a.contactNumbers=[{contactInfo:"",info:""}],a.custContactList={},b.customerContacts=[],a.contactTypeValue=[],a.contactTypeDetails=[],a.isInfoRequired=[],a.contactObj={id:"",type:"",companyName:"",firstName:"",lastName:"",name:"",address:"",jobTitle:"",deleted:""};var g=function(){(null==a.contactDetail.data.contactNumbers||0===a.contactDetail.data.contactNumbers.length)&&(a.contactDetail.data.contactNumbers=[],a.contactDetail.data.contactNumbers.push({}),a.contactTypeValue[0]="email",a.contactTypeDetails[0]="");for(var b=0;b<a.contactDetail.data.contactNumbers.length;b++)a.contactTypeDetails[b]=a.contactDetail.data.contactNumbers[b].details,a.contactTypeValue[b]=a.contactDetail.data.contactNumbers[b].type};a.formatInputData=function(){null!=a.contactDetail&&null!=a.contactDetail.data.addressISOCountry&&null!=a.countries&&angular.forEach(a.countries,function(b){b.code==a.contactDetail.data.addressISOCountry&&(a.contactDetail.data.addressISOCountry=b)}),null!=a.contactDetail&&null!=a.contactDetail.data.addressStateCode&&null!=a.states&&angular.forEach(a.states,function(b){b.code==a.contactDetail.data.addressStateCode&&(a.contactDetail.data.addressStateCode=b)})},"create"==f.get("contactID")?(a.contactDetail={success:!0,total:1,data:{}},a.contactNumbers=null,a.mapOptions=a.contactDetail,a.newContact=!0,(null==a.contactDetail.data.contactNumbers||0===a.contactDetail.data.contactNumbers.length)&&(a.contactDetail.data.contactNumbers=[],a.contactDetail.data.contactNumbers.push({}),a.contactTypeValue[0]="email",a.contactTypeDetails[0]="")):d.get("/api/contactDetail/"+f.get("contactID")).success(function(b){a.contactDetail=b,a.needMapCall.callMap=!0,a.mapOptions=a.contactDetail,g()}).error(function(){}),null==b.localCache.states?d.get("/api/listData/states").success(function(c){a.states=c.data,b.localCache.states=a.states,a.formatInputData()}).error(function(){a.state_namesJson={success:!0,total:1,data:[{name:"Alabama",code:"AL"},{name:"Alaska",code:"AK"},{name:"Arizona",code:"AZ"},{name:"Arkansas",code:"AR"},{name:"California",code:"CA"},{name:"Colorado",code:"CO"},{name:"Connecticut",code:"CT"},{name:"Delaware",code:"DE"},{name:"District of Columbia",code:"DC"},{name:"Florida",code:"FL"},{name:"Georgia",code:"GA"},{name:"Hawaii",code:"HI"},{name:"Idaho",code:"ID"},{name:"Illinois",code:"IL"},{name:"Indiana",code:"IN"},{name:"Iowa",code:"IA"},{name:"Kansa",code:"KS"},{name:"Kentucky",code:"KY"},{name:"Lousiana",code:"LA"},{name:"Maine",code:"ME"},{name:"Maryland",code:"MD"},{name:"Massachusetts",code:"MA"},{name:"Michigan",code:"MI"},{name:"Minnesota",code:"MN"},{name:"Mississippi",code:"MS"},{name:"Missouri",code:"MO"},{name:"Montana",code:"MT"},{name:"Nebraska",code:"NE"},{name:"Nevada",code:"NV"},{name:"New Hampshire",code:"NH"},{name:"New Jersey",code:"NJ"},{name:"New Mexico",code:"NM"},{name:"New York",code:"NY"},{name:"North Carolina",code:"NC"},{name:"North Dakota",code:"ND"},{name:"Ohio",code:"OH"},{name:"Oklahoma",code:"OK"},{name:"Oregon",code:"OR"},{name:"Pennsylvania",code:"PA"},{name:"Rhode Island",code:"RI"},{name:"South Carolina",code:"SC"},{name:"South Dakota",code:"SD"},{name:"Tennessee",code:"TN"},{name:"Texas",code:"TX"},{name:"Utah",code:"UT"},{name:"Vermont",code:"VT"},{name:"Virginia",code:"VA"},{name:"Washington",code:"WA"},{name:"West Virginia",code:"WV"},{name:"Wisconsin",code:"WI"},{name:"Wyoming",code:"WY"}]},a.states=a.state_namesJson.data,b.localCache.states=a.states,a.formatInputData()}):(a.states=b.localCache.states,a.formatInputData()),null==b.localCache.countries?d.get("/api/listData/countries").success(function(c){a.countries=c.data,b.localCache.countries=a.countries,a.formatInputData()}).error(function(){a.countriesJson={success:!0,total:1,data:[{name:"Ascension Island",code:"AC"},{name:"Andorra",code:"AD"},{name:"United Arab Emirates",code:"AE"},{name:"Afghanistan",code:"AF"},{name:"Antigua And Barbuda",code:"AG"},{name:"Anguilla",code:"AI"},{name:"Albania",code:"AL"},{name:"Armenia",code:"AM"},{name:"Angola",code:"AO"},{name:"Antarctica",code:"AQ"},{name:"Argentina",code:"AR"},{name:"American Samoa",code:"AS"},{name:"Austria",code:"AT"},{name:"Australia",code:"AU"},{name:"Aruba",code:"AW"},{name:"Azerbaijan",code:"AZ"},{name:"Bosnia & Herzegovina",code:"BA"},{name:"Barbados",code:"BB"},{name:"Bangladesh",code:"BD"},{name:"Belgium",code:"BE"},{name:"Burkina Faso",code:"BF"},{name:"Bulgaria",code:"BG"},{name:"Bahrain",code:"BH"},{name:"Burundi",code:"BI"},{name:"Benin",code:"BJ"},{name:"Bermuda",code:"BM"},{name:"Brunei Darussalam",code:"BN"},{name:"Bolivia, Plurinational State Of",code:"BO"},{name:"Afghanistan",code:"AF"},{name:"Antigua And Barbuda",code:"AG"},{name:"Anguilla",code:"AI"},{name:"Albania",code:"AL"},{name:"Armenia",code:"AM"},{name:"Angola",code:"AO"},{name:"Antarctica",code:"AQ"},{name:"Argentina",code:"AR"},{name:"American Samoa",code:"AS"},{name:"Austria",code:"AT"},{name:"Australia",code:"AU"},{name:"Aruba",code:"AW"},{name:"Azerbaijan",code:"AZ"},{name:"Bosnia & Herzegovina",code:"BA"},{name:"Barbados",code:"BB"},{name:"Bangladesh",code:"BD"},{name:"Belgium",code:"BE"},{name:"Burkina Faso",code:"BF"},{name:"Bulgaria",code:"BG"},{name:"Bahrain",code:"BH"},{name:"Burundi",code:"BI"},{name:"Benin",code:"BJ"},{name:"Bermuda",code:"BM"},{name:"Brunei Darussalam",code:"BN"},{name:"Bolivia, Plurinational State Of",code:"BO"},{name:"Bonaire, Saint Eustatius And Saba",code:"BQ"},{name:"Brazil",code:"BR"},{name:"Bahamas",code:"BS"},{name:"Bhutan",code:"BT"},{name:"Bouvet Island",code:"BV"},{name:"Botswana",code:"BW"},{name:"Belarus",code:"BY"},{name:"Belize",code:"BZ"},{name:"Canada",code:"CA"},{name:"Cocos (Keeling) Islands",code:"CC"},{name:"Democratic Republic Of Congo",code:"CD"},{name:"Central African Republic",code:"CF"},{name:"Republic Of Congo",code:"CG"},{name:"Switzerland",code:"CH"},{name:"Cote d'Ivoire",code:"CI"},{name:"Cook Islands",code:"CK"},{name:"Chile",code:"CL"},{name:"Cameroon",code:"CM"},{name:"China",code:"CN"},{name:"Colombia",code:"CO"},{name:"Clipperton Island",code:"CP"},{name:"Costa Rica",code:"CR"},{name:"Cuba",code:"CU"},{name:"Cape Verde",code:"CV"},{name:"Curacao",code:"CW"},{name:"Christmas Island",code:"CX"},{name:"Cyprus",code:"CY"},{name:"Czech Republic",code:"CZ"},{name:"Germany",code:"DE"},{name:"Diego Garcia",code:"DG"},{name:"Djibouti",code:"DJ"},{name:"Denmark",code:"DK"},{name:"Dominica",code:"DM"},{name:"Dominican Republic",code:"DO"},{name:"Algeria",code:"DZ"},{name:"Ceuta, Mulilla",code:"EA"},{name:"Ecuador",code:"EC"},{name:"Estonia",code:"EE"},{name:"Egypt",code:"EG"},{name:"Western Sahara",code:"EH"},{name:"Eritrea",code:"ER"},{name:"Spain",code:"ES"},{name:"Ethiopia",code:"ET"},{name:"European Union",code:"EU"},{name:"Finland",code:"FI"},{name:"Fiji",code:"FJ"},{name:"Falkland Islands",code:"FK"},{name:"Micronesia, Federated States Of",code:"FM"},{name:"Faroe Islands",code:"FO"},{name:"France",code:"FR"},{name:"France, Metropolitan",code:"FX"},{name:"Gabon",code:"GA"},{name:"United Kingdom",code:"GB"},{name:"Grenada",code:"GD"},{name:"Georgia",code:"GE"},{name:"French Guiana",code:"GF"},{name:"Guernsey",code:"GG"},{name:"Ghana",code:"GH"},{name:"Gibraltar",code:"GI"},{name:"Greenland",code:"GL"},{name:"Gambia",code:"GM"},{name:"Great Britain",code:"GB"},{name:"Guinea",code:"GN"},{name:"Guadeloupe",code:"GP"},{name:"Equatorial Guinea",code:"GQ"},{name:"Greece",code:"GR"},{name:"South Georgia And The South Sandwich Islands",code:"GS"},{name:"Guatemala",code:"GT"},{name:"Guam",code:"GU"},{name:"Guinea-bissau",code:"GW"},{name:"Guyana",code:"GY"},{name:"Hong Kong",code:"HK"},{name:"Heard Island And McDonald Islands",code:"HM"},{name:"Honduras",code:"HN"},{name:"Croatia",code:"HR"},{name:"Haiti",code:"HT"},{name:"Hungary",code:"HU"},{name:"Canary Islands",code:"IC"},{name:"Indonesia",code:"ID"},{name:"Ireland",code:"IE"},{name:"Israel",code:"IL"},{name:"Isle Of Man",code:"IM"},{name:"India",code:"IN"},{name:"British Indian Ocean Territory",code:"IO"},{name:"Iraq",code:"IQ"},{name:"Iran, Islamic Republic Of",code:"IR"},{name:"Iceland",code:"IS"},{name:"Italy",code:"IT"},{name:"Jersey",code:"JE"},{name:"Jamaica",code:"JM"},{name:"Jordan",code:"JO"},{name:"Japan",code:"JP"},{name:"Kenya",code:"KE"},{name:"Kyrgyzstan",code:"KG"},{name:"Cambodia",code:"KH"},{name:"Kiribati",code:"KI"},{name:"Comoros",code:"KM"},{name:"Saint Kitts And Nevis",code:"KN"},{name:"Korea, Democratic People's Republic Of",code:"KP"},{name:"Korea, Republic Of",code:"KR"},{name:"Kuwait",code:"KW"},{name:"Cayman Islands",code:"KY"},{name:"Kazakhstan",code:"KZ"},{name:"Lao People's Democratic Republic",code:"LA"},{name:"Lebanon",code:"LB"},{name:"Saint Lucia",code:"LC"},{name:"Liechtenstein",code:"LI"},{name:"Sri Lanka",code:"LK"},{name:"Liberia",code:"LR"},{name:"Lesotho",code:"LS"},{name:"Lithuania",code:"LT"},{name:"Luxembourg",code:"LU"},{name:"Latvia",code:"LV"},{name:"Libya",code:"LY"},{name:"Morocco",code:"MA"},{name:"Monaco",code:"MC"},{name:"Moldova",code:"MD"},{name:"Montenegro",code:"ME"},{name:"Saint Martin",code:"MF"},{name:"Madagascar",code:"MG"},{name:"Marshall Islands",code:"MH"},{name:"Macedonia, The Former Yugoslav Republic Of",code:"MK"},{name:"Mali",code:"ML"},{name:"Myanmar",code:"MM"},{name:"Mongolia",code:"MN"},{name:"Macao",code:"MO"},{name:"Northern Mariana Islands",code:"MP"},{name:"Martinique",code:"MQ"},{name:"Mauritania",code:"MR"},{name:"Montserrat",code:"MS"},{name:"Malta",code:"MT"},{name:"Mauritius",code:"MU"},{name:"Maldives",code:"MV"},{name:"Malawi",code:"MW"},{name:"Mexico",code:"MX"},{name:"Malaysia",code:"MY"},{name:"Mozambique",code:"MZ"},{name:"Namibia",code:"NA"},{name:"New Caledonia",code:"NC"},{name:"Niger",code:"NE"},{name:"Norfolk Island",code:"NF"},{name:"Nigeria",code:"NG"},{name:"Nicaragua",code:"NI"},{name:"Netherlands",code:"NL"},{name:"Norway",code:"NO"},{name:"Nepal",code:"NP"},{name:"Nauru",code:"NR"},{name:"Niue",code:"NU"},{name:"New Zealand",code:"NZ"},{name:"Oman",code:"OM"},{name:"Panama",code:"PA"},{name:"Peru",code:"PE"},{name:"French Polynesia",code:"PF"},{name:"Papua New Guinea",code:"PG"},{name:"Philippines",code:"PH"},{name:"Pakistan",code:"PK"},{name:"Poland",code:"PL"},{name:"Saint Pierre And Miquelon",code:"PM"},{name:"Pitcairn",code:"PN"},{name:"Puerto Rico",code:"PR"},{name:"Palestinian Territory, Occupied",code:"PS"},{name:"Portugal",code:"PT"},{name:"Palau",code:"PW"},{name:"Paraguay",code:"PY"},{name:"Qatar",code:"QA"},{name:"Reunion",code:"RE"},{name:"Romania",code:"RO"},{name:"Serbia",code:"RS"},{name:"Russian Federation",code:"RU"},{name:"Rwanda",code:"RW"},{name:"Saudi Arabia",code:"SA"},{name:"Solomon Islands",code:"SB"},{name:"Seychelles",code:"SC"},{name:"Sudan",code:"SD"},{name:"Sweden",code:"SE"},{name:"Singapore",code:"SG"},{name:"Saint Helena, Ascension And Tristan Da Cunha",code:"SH"},{name:"Slovenia",code:"SI"},{name:"Svalbard And Jan Mayen",code:"SJ"},{name:"Slovakia",code:"SK"},{name:"Sierra Leone",code:"SL"},{name:"San Marino",code:"SM"},{name:"Senegal",code:"SN"},{name:"Somalia",code:"SO"},{name:"Suriname",code:"SR"},{name:"South Sudan",code:"SS"},{name:"SÃŒÂ£o TomÃŒÂ© and PrÃŒ_ncipe",code:"ST"},{name:"USSR",code:"SU"},{name:"El Salvador",code:"SV"},{name:"Sint Maarten",code:"SX"},{name:"Syrian Arab Republic",code:"SY"},{name:"Swaziland",code:"SZ"},{name:"Tristan de Cunha",code:"TA"},{name:"Turks And Caicos Islands",code:"TC"},{name:"Chad",code:"TD"},{name:"French Southern Territories",code:"TF"},{name:"Togo",code:"TG"},{name:"Thailand",code:"TH"},{name:"Tajikistan",code:"TJ"},{name:"Tokelau",code:"TK"},{name:"East Timor",code:"TL"},{name:"Turkmenistan",code:"TM"},{name:"Tunisia",code:"TN"},{name:"Tonga",code:"TO"},{name:"Turkey",code:"TR"},{name:"Trinidad And Tobago",code:"TT"},{name:"Tuvalu",code:"TV"},{name:"Taiwan, Province Of China",code:"TW"},{name:"Tanzania, United Republic Of",code:"TZ"},{name:"Ukraine",code:"UA"},{name:"Uganda",code:"UG"},{name:"United Kingdom",code:"GB"},{name:"United States Minor Outlying Islands",code:"UM"},{name:"United States",code:"US"},{name:"Uruguay",code:"UY"},{name:"Uzbekistan",code:"UZ"},{name:"Vatican City State",code:"VA"},{name:"Saint Vincent And The Grenadines",code:"VC"},{name:"Venezuela, Bolivarian Republic Of",code:"VE"},{name:"Virgin Islands (British)",code:"VG"},{name:"Virgin Islands (US)",code:"VI"},{name:"Viet Nam",code:"VN"},{name:"Vanuatu",code:"VU"},{name:"Wallis And Futuna",code:"WF"},{name:"Samoa",code:"WS"},{name:"Yemen",code:"YE"},{name:"Mayotte",code:"YT"},{name:"South Africa",code:"ZA"},{name:"Zambia",code:"ZM"},{name:"Zimbabwe",code:"ZW"}]},a.countries=a.countriesJson.data,b.localCache.countries=a.countries,a.formatInputData()}):(a.countries=b.localCache.countries,a.formatInputData());var h='<div class="ngHeaderSortColumn {{col.headerClass}}" ng-style="{\'cursor\': col.cursor}" ng-class="{ \'ngSorted\': !noSortVisible }"><div ng-click="col.sort($event)" ng-class="\'colt\' + col.index" class="ngHeaderText">{{col.displayName}} <button class="btn btn-default btn-sm" ng-click="addRow(contactNumbers)"><i class="fa fa-plus"></i></button></div><div class="ngSortButtonDown" ng-show="col.showSortButtonDown()"></div><div class="ngSortButtonUp" ng-show="col.showSortButtonUp()"></div><div class="ngSortPriority">{{col.sortPriority}}</div><div ng-class="{ ngPinnedIcon: col.pinned, ngUnPinnedIcon: !col.pinned }" ng-click="togglePin(col)" ng-show="col.pinnable"></div></div><div ng-show="col.resizable" class="ngHeaderGrip" ng-click="col.gripClick($event)" ng-mousedown="col.gripOnMouseDown($event)"></div>';a.customerContactTableOption={data:"contactNumbers",multiSelect:!1,enableSorting:!1,rowHeight:40,headerRowHeight:40,columnDefs:[{field:"contactType",displayName:"Type",width:"38%",cellTemplate:'<div class="ngCellText" style="display: inline-flex;width: 100%;"><select  ng-options="contact as contact for contact in contactNumberTypes" ng-model ="defaultContactType.type" class="form-control"></select></div>'},{field:"info",displayName:"Info",width:"50%",cellTemplate:'<div class="ngCellText" style="display: inline-flex;width: 100%;"><input type="text" ng-model="contractDetail.data.startDate" class="form-control"/><p ng-show ="invalidEmail" class="text-danger">Invalid email.</p> </div>'},{field:"",displayName:"",width:"10%",headerCellTemplate:h,cellTemplate:'<div class="ngCellText"><button class="btn btn-default btn-sm" ng-click="deleteSelectedRow(row.rowIndex,contactNumbers)"><i class="fa fa-times"></i></button></div>'}]},a.isValidContactInfo=!1,a.contactNewContact={info:""},a.defaultContactType={},a.deleteEmployeeContactInfo=function(b){a.contactDetail.data.contactNumbers.splice(b,1),0==a.contactDetail.data.contactNumbers.length&&(a.contactDetail.data.contactNumbers.push({}),a.contactTypeDetails[0]="",a.contactTypeValue[0]="Phone")},a.addEmployeeContactInfo=function(){var b=a.contactDetail.data.contactNumbers.length;a.contactDetail.data.contactNumbers.push({}),a.contactTypeDetails[b]="",a.contactTypeValue[b]=a.contactNumberTypes[0]};a.getClass=function(b){return a.red.checked&&-1!=b.func.indexOf("red")},null==b.localCache.contactNumTypes?d.get("/api/listData/contactNumberTypes").success(function(c){a.contactNumberTypes=c.data,b.localCache.contactNumTypes=a.contactNumberTypes,a.defaultContactType.type=a.contactNumberTypes[0]}).error(function(){a.contactNumberTypesJson={success:!0,total:1,data:["Phone","email","Skype","LinkedIn"]},a.contactNumberTypes=a.contactNumberTypesJson.data,b.localCache.contactNumTypes=a.contactNumberTypes,a.defaultContactType.type=a.contactNumberTypes[0]}):(a.contactNumberTypes=b.localCache.contactNumTypes,a.defaultContactType.type=a.contactNumberTypes[0]),a.validateName=function(){return""==a.contactDetail.data.nickname||null==a.contactDetail.data.nickname?void(a.isRequired=!0):void(a.isRequired=!1)},a.isImageuploaded=!1,a.getFile=function(b){a.file=b,fileReader.readAsDataUrl(a.file,a).then(function(b){a.imageSrc=b,$(".PersonImage").width()>120&&(a.containImg=!0),a.disabledSave=!1,a.isImageuploaded=!0})};var i=function(b){return a.contactObj.id=b.id,a.contactObj.type=b.type,a.contactObj.companyName=b.companyName,a.contactObj.firstName=b.firstName,a.contactObj.lastName=b.lastName,a.contactObj.name=b.nickname,a.contactObj.address=b.addressCity,a.contactObj.jobTitle=a.custContactList.jobTitle,a.contactObj.deleted=!1,a.contactObj};a.isInfoRequired=[],a.saveContactNumbers=function(){for(var b=!1,c=0;c<a.contactTypeDetails.length;c++)a.isInfoRequired[c]=!1;for(var c=0;c<a.contactTypeDetails.length;c++)if(""!=a.contactTypeValue[c]&&null!=a.contactTypeValue[c]&&""!=a.contactTypeDetails[c]&&null!=a.contactTypeDetails[c]&&"email"==a.contactTypeValue[c].toLowerCase()){var d=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(!d.test(a.contactTypeDetails[c])){b=!0,a.isInfoRequired[c]=!0;break}a.isInfoRequired[c]=!1}if(!b){a.contactDetail.data.contactNumbers=[];for(var e=-1,f=-1,g=-1,h=-1,c=0;c<a.contactTypeDetails.length;c++)""!=a.contactTypeDetails[c]&&""!=a.contactTypeValue[c]&&null!=a.contactTypeValue[c]&&null!=a.contactTypeDetails[c]&&("email"==a.contactTypeValue[c].toLowerCase()&&(e++,a.contactDetail.data.contactNumbers.push({details:a.contactTypeDetails[c],seq:e,type:a.contactTypeValue[c]})),"phone"==a.contactTypeValue[c].toLowerCase()&&(f++,a.contactDetail.data.contactNumbers.push({details:a.contactTypeDetails[c],seq:f,type:a.contactTypeValue[c]})),"skype"==a.contactTypeValue[c].toLowerCase()&&(h++,a.contactDetail.data.contactNumbers.push({details:a.contactTypeDetails[c],seq:h,type:a.contactTypeValue[c]})),"linkedin"==a.contactTypeValue[c].toLowerCase()&&(g++,a.contactDetail.data.contactNumbers.push({details:a.contactTypeDetails[c],seq:g,type:a.contactTypeValue[c]})))}return b},a.UploadImage=function(b){var c="";c=null!=b?b:f.get("contactID");var e=new FormData;e.append("file",a.file),e.append("contactId",c),d.post("/api/upload/photo",e,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(){a.addAlert("Image Updated Successfully","success"),a.isImageuploaded=!1}).error(function(b,c){a.isImageuploaded=!1,413==c&&console.log("Image update failed:Image file exceeds maximum area.Please choose a file under 1MB.","danger")})},a.ok=function(){if(a.isImageuploaded&&"create"!=f.get("contactID")&&a.UploadImage(),""==a.contactDetail.data.nickname||null==a.contactDetail.data.nickname)return void(a.isRequired=!0);if(!a.saveContactNumbers()){if(null!=a.contactDetail.data.addressStateCode){var b=a.contactDetail.data.addressStateCode;"object"==typeof b&&(a.contactDetail.data.addressStateCode=b.code)}if(null!=a.contactDetail.data.addressCountryISO){var c=a.contactDetail.data.addressCountryISO;"object"==typeof c&&(a.contactDetail.data.addressCountryISO=c.code,a.contactDetail.data.addressCountryName=c.name)}void 0==a.contactDetail||d({method:"post",url:"/api/contactDetail/update?timestamp="+e.postTimeStamp(),data:a.contactDetail.data,headers:{"content-type":"application/json"}}).success(function(b){a.custContactList=b.data,a.newContact=!1,a.isImageuploaded&&"create"==f.get("contactID")&&a.UploadImage(a.custContactList.id),$modalInstance.close("create"==f.get("contactID")?i(a.custContactList):i(a.custContactList))}).error(function(){console.log("Failed")})}},a.cancel=function(){$modalInstance.dismiss("cancel")}}]);