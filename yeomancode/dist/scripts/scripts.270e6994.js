angular.module("redPandaApp",["ngRoute","ui.bootstrap","ngGrid","ngCookies","google-maps"]).config(["$routeProvider","$locationProvider","$httpProvider",function(a,b,c){a.when("/login",{templateUrl:"views/Login.html"}).when("/Registration",{templateUrl:"views/Registration.html"}).when("/ResetPassword",{templateUrl:"views/ResetPassword.html"}).when("/Employee",{templateUrl:"views/Employee.html"}).when("/Home",{templateUrl:"views/HomePage.html"}).when("/Customer",{templateUrl:"views/Customer.html"}).when("/Contract",{templateUrl:"views/Contract.html"}).when("/ContractDetail",{templateUrl:"views/ContractDetail.html"}).when("/EmployeeDetail",{templateUrl:"views/EmployeeDetail.html"}).when("/CustomerDetail",{templateUrl:"views/CustomerDetail.html"}).otherwise({redirectTo:"/login"}),b.html5Mode(!0),console.log("HTTPHEADERS"),console.log(c),c.defaults.headers.get||(c.defaults.headers.get={}),c.defaults.headers.get["If-Modified-Since"]="0"}]),angular.module("redPandaApp").controller("maincontroller",["$scope","$location","$rootScope","$cookieStore","$window","$modal","$http",function(a,b,c,d,e,f,g){console.log("Current Path"),console.log(b.path()),c.selectedMenu="home",c.localCache={},c.fromCustomer=!1,c.localCache.isEmpAPINeeded=!1,c.localCache.isCustomerAPINeeded=!1,c.localCache.isFindCustomerAPINeeded=!1,c.localCache.customerContactId="",c.calledFromEmployeeDetail=!1,c.calledFromCustomerDetail=!1,c.calledFromContractDetail=!1,c.empDetailCache={},loginSucccess=!1,c.deleteCustomerContract=!1,c.defaultUserImage="",c.currentUserName="",c.currentUserId="",""==c.defaultUserImage&&null!=d.get("defaultUserImage")&&(c.defaultUserImage=d.get("defaultUserImage")),""==c.currentUserId&&null!=d.get("currentUserId")&&(c.currentUserId=d.get("currentUserId")),""==c.currentUserName&&null!=d.get("currentUserName")&&(c.currentUserName=d.get("currentUserName")),null==d.get("enableApplication")?(d.put("enableApplication",!1),c.showApplication=d.get("enableApplication")):c.showApplication=d.get("enableApplication"),a.navHome=function(){b.path("/Home")},angular.element(e).bind("resize",function(){var a=$(document.activeElement);a.is(".hasDatepicker")&&a.datepicker("hide").datepicker("show"),a.is("span.simplecolorpicker")&&$("span.picker").hide(),(a[0].id="daterange")&&$(".daterangepicker").hide()});c.showModal=function(a,b,d,e,h){c.dialogHeader=b,c.dialogContent=d,c.cancelBtn=e,c.confirmbtn=h,c.dialogModal=f.open({templateUrl:"views/ConfirmDialog.html"}),c.dialogModal.result.then(function(){g.post(a).success(function(){c.isPostSuccess=!0}).error(function(){c.isPostSuccess=!1})},function(){console.log("Cancelled")})},c.addAlert=function(a,b,d){c.alerts=[],c.alerts.push({message:a,type:b,header:d}),e.scrollTo(0,0)},c.closeAlert=function(){c.alerts=[]},c.customerData={success:!0,total:8,dataType:"customerList",data:[{id:"53b54b2d406e304a0af096a1",customerId:"CUS002",customerName:"GeoHay",customerAddress:"Inman, SC",commentsExist:!1,attachmentsExist:!1},{id:"53b55c4eb583afd17f72170c",customerId:"CUS004",customerName:"Thompson PR",customerAddress:"New York, NY",commentsExist:!1,attachmentsExist:!1},{id:"53c6887b02c7571f485ad86a",customerName:"Avon Bakery",commentsExist:!1,attachmentsExist:!1},{id:"53c689d902c7571f485ad86b",customerId:"CUS088",customerName:"Avon Bakery",customerAddress:"Avon, CO",commentsExist:!1,attachmentsExist:!1},{id:"53b55a43b583afd17f72170b",customerId:"CUS003",customerName:"Red Panda",customerAddress:"Princeton, NJ",commentsExist:!1,attachmentsExist:!1},{id:"53b55c61b583afd17f72170d",customerId:"CUS005",customerName:"Traveller Inc.",customerAddress:"DC, 20017",commentsExist:!1,attachmentsExist:!1},{id:"53d7ffac13a2e63528ae5372",customerId:"CUS006",customerName:"Rockhead",customerAddress:"MD, 20850",commentsExist:!1,attachmentsExist:!1},{id:"53b41103353f736efcab467d",customerId:"CUS001",customerName:"Small World",customerAddress:"Princeton, NJ",commentsExist:!1,attachmentsExist:!1}]},c.customerDetail={success:!0,total:1,data:{id:"53fdf562a2c94628879aa174",customerId:"CUST004",color:"#00ff99",customerName:"Thompson PRs",addressStreet:"44 W 28th Street",addressCity:"New York",addressStateCode:"NY",addressStateName:"New York",addressPostZip:"10001",addressISOCountry:"US",addressCountryName:"United States of America",addressLat:40.7456572,addressLong:-73.99007039999998,contactIds:["53fe5abc03cd3d2d8df32473","53fe5abc03cd3d2d8df32473"],contactList:[{id:"53fe5abc03cd3d2d8df32473",type:"external",companyName:"ThompsonPR.",firstName:"Lisa",lastName:"Hamilton",name:"Lisa Hamilton",address:"AK, 99501",jobTitle:"Accountant.",departmentName:"Management",deleted:!1},{id:"53fe5abc03cd3d2d8df32473",type:"external",companyName:"ThompsonPR.",firstName:"Lisa",lastName:"Hamilton",name:"Lisa Hamilton",address:"AK, 99501",jobTitle:"Accountant.",departmentName:"Management",deleted:!1}],contractIds:["53fe62c303cd3d2d8df32476"],contractList:[{id:"53fe62c303cd3d2d8df32476",title:"Salmon Fishing",poNumber:"PO 998877",value:0,commentsExist:!1,attachmentsExist:!1,deleted:!1}],comments:[{seqNo:0,postedBy:{thumbUrl:"img/sh_photo50.png",name:"ggggg title"},postedOn:"2014-09-11T22:33:39.212Z",replyTo:0,docRef:0,text:"This is another comment"},{seqNo:1,postedBy:{thumbUrl:"img/sh_photo50.png",name:"ggggg title"},postedOn:"2014-09-11T21:33:39.212Z",replyTo:0,docRef:0,text:"This is a comment"},{seqNo:1,postedBy:{thumbUrl:"img/sh_photo50.png",name:"Nisha Navlakha"},postedOn:"2014-09-25T03:33:39.212Z",replyTo:0,docRef:0,text:"And This is a third comment with lots and lots of text going on over several lines just to test that we are flexing the box sizes correctly. The test here should appear and the date should be at the end. A comment for teh people by the people and with teh people is the very best way to test this functionality - thank you"}]}},c.EmployeeID="545789000abc012345655",c.EmployeeDetailObject={"53ac275ee4b03340b6de4947":{success:!0,total:1,data:{id:"53ac275ee4b03340b6de4947",employeeNumber:"PER00003",photoUrl:"/data/resources/53b2fd2de4b0123558f41fe5.jpeg",thumbUrl:"/data/resources/thumbnail.53b2fd2de4b0123558f41fe5.jpeg",firstName:"Peter",hireDate:"2014-09-05",termDate:"2014-09-26",lastName:"Blake",fullName:"Peter Blake",nickName:"Peter Blake",isPartTime:!1,isContractor:!1,addressStreet:"23 Ridge Road",contactNumbers:[{seq:0,type:"email",details:"jennifer@xyz.com"},{seq:0,type:"phone",details:"4043456127"}],addressCity:"Princeton",addressStateCode:"NJ",addressPostZip:"08540",addressCountryISO:"US",departmentId:"53ac29159c1c37083b3d38ad",job:"Developer",stdCostAmt:88.5,stdCostCur:"USD",timeOff:[{type:"sick",allowance:5,taken:2.5},{type:"vacation",allowance:20,taken:5}],comments:[{seqNo:0,postedBy:{thumbUrl:"/data/resources/thumbnail.53b2fd2de4b0123558f41fe5.jpeg",name:"ggggg title"},postedOn:"2014-09-29T14:36:16Z",replyTo:0,docRef:0,text:"This is another comment"},{seqNo:1,postedBy:{thumbUrl:"/data/resources/thumbnail.53b2fd2de4b0123558f41fe5.jpeg",name:"ggggg title"},postedOn:"2014-09-11T21:33:39.212Z",replyTo:0,docRef:0,text:"This is a comment"},{seqNo:1,postedBy:{thumbUrl:"/data/resources/thumbnail.53b2fd2de4b0123558f41fe5.jpeg",name:"Nisha Navlakha"},postedOn:"2014-09-28T03:33:39.212Z",replyTo:0,docRef:0,text:"And This is a third comment with lots and lots of text going on over several lines just to test that we are flexing the box sizes correctly. The test here should appear and the date should be at the end. A comment for teh people by the people and with teh people is the very best way to test this functionality - thank you"}]}},"53ac2791e4b03340b6de4948":{success:!0,total:1,data:{id:"53ac2791e4b03340b6de4948",employeeNumber:"PER00005",photoUrl:"/data/resources/53b2fd39e4b0123558f41fe6.jpeg",thumbUrl:"/data/resources/thumbnail.53b2fd39e4b0123558f41fe6.jpeg",firstName:"Jennifer",lastName:"Harvey",fullName:"Jennifer Harvey",nickName:"Jennifer Harvey",isPartTime:!1,isContractor:!1,contactNumbers:[{seq:0,type:"email",details:"jennifer@xyz.com"},{seq:0,type:"phone",details:"4043456127"}],departmentName:"Peter Edgar Blake",departmentId:"53ac291c9c1c37083b3d38ae",managerId:"53ac275ee4b03340b6de4947",job:"Accountant",stdCostAmt:88.5,stdCostCur:"USD",timeOff:[{type:"sick",allowance:5,taken:2.5},{type:"vacation",allowance:20,taken:5}],comments:[{seqNo:0,postedBy:{thumbUrl:"/data/resources/thumbnail.53b2fd2de4b0123558f41fe5.jpeg",name:"ggggg title"},postedOn:"2014-09-29T14:36:16Z",replyTo:0,docRef:0,text:"This is another comment"},{seqNo:1,postedBy:{thumbUrl:"/data/resources/thumbnail.53b2fd2de4b0123558f41fe5.jpeg",name:"ggggg title"},postedOn:"2014-09-11T21:33:39.212Z",replyTo:0,docRef:0,text:"This is a comment"},{seqNo:1,postedBy:{thumbUrl:"/data/resources/thumbnail.53b2fd2de4b0123558f41fe5.jpeg",name:"Nisha Navlakha"},postedOn:"2014-09-28T03:33:39.212Z",replyTo:0,docRef:0,text:"And This is a third comment with lots and lots of text going on over several lines just to test that we are flexing the box sizes correctly. The test here should appear and the date should be at the end. A comment for teh people by the people and with teh people is the very best way to test this functionality - thank you"}]}},"53ac27b0e4b03340b6de4949":{success:!0,total:1,data:{id:"53ac27b0e4b03340b6de4949",employeeId:"PER00099",photoUrl:"/data/resources/53b2fc31e4b0123558f41fe2.jpeg",thumbUrl:"/data/resources/thumbnail.53b2fc31e4b0123558f41fe2.jpeg",firstName:"Richard",lastName:"Minney",fullName:"Richard Minney",nickname:"Richard Minney",isPartTime:!1,isContractor:!0,departmentName:"Peter Edgar Blake",departmentId:"53ac29229c1c37083b3d38af",managerId:"53ac275ee4b03340b6de4947",job:"Support",contactNumbers:[{seq:0,type:"email",details:"jennifer@xyz.com"},{seq:0,type:"phone",details:"4043456127"}],stdCostAmt:88.5,stdCostCur:"USD",timeOff:[{type:"sick",allowance:5,taken:2.5},{type:"vacation",allowance:20,taken:5}],comments:[{seqNo:0,postedBy:{thumbUrl:"/data/resources/thumbnail.53b2fd2de4b0123558f41fe5.jpeg",name:"ggggg title"},postedOn:"2014-09-29T14:36:16Z",replyTo:0,docRef:0,text:"This is another comment"},{seqNo:1,postedBy:{thumbUrl:"/data/resources/thumbnail.53b2fd2de4b0123558f41fe5.jpeg",name:"ggggg title"},postedOn:"2014-09-11T21:33:39.212Z",replyTo:0,docRef:0,text:"This is a comment"},{seqNo:1,postedBy:{thumbUrl:"/data/resources/thumbnail.53b2fd2de4b0123558f41fe5.jpeg",name:"Nisha Navlakha"},postedOn:"2014-09-28T03:33:39.212Z",replyTo:0,docRef:0,text:"And This is a third comment with lots and lots of text going on over several lines just to test that we are flexing the box sizes correctly. The test here should appear and the date should be at the end. A comment for teh people by the people and with teh people is the very best way to test this functionality - thank you"}]}},"53b435aa3c01cbf76dd3d796":{success:!0,total:1,data:{id:"53b435aa3c01cbf76dd3d796",employeeNumber:"PER00035",firstName:"Ellie",lastName:"Clarke",fullName:"Elenor Amy Clarke",nickName:"Ellie clarke",isPartTime:!1,isContractor:!1,addressStreet:"23 Ridge Road",contactNumbers:[{seq:0,type:"email",details:"jennifer@xyz.com"},{seq:0,type:"phone",details:"4043456127"}],addressCity:"Princeton",addressStateCode:"NJ",addressPostZip:"08540",addressCountryISO:"US",departmentName:"Operations",departmentId:"53ac29159c1c37083b3d38ad",job:"Developer",stdCostAmt:88.5,stdCostCur:"USD",timeOff:[{type:"sick",allowance:5,taken:2.5},{type:"vacation",allowance:20,taken:5}],comments:[{seqNo:0,postedBy:{thumbUrl:"/data/resources/thumbnail.53b2fd2de4b0123558f41fe5.jpeg",name:"ggggg title"},postedOn:"2014-09-29T14:36:16Z",replyTo:0,docRef:0,text:"This is another comment"},{seqNo:1,postedBy:{thumbUrl:"/data/resources/thumbnail.53b2fd2de4b0123558f41fe5.jpeg",name:"ggggg title"},postedOn:"2014-09-11T21:33:39.212Z",replyTo:0,docRef:0,text:"This is a comment"},{seqNo:1,postedBy:{thumbUrl:"/data/resources/thumbnail.53b2fd2de4b0123558f41fe5.jpeg",name:"Nisha Navlakha"},postedOn:"2014-09-28T03:33:39.212Z",replyTo:0,docRef:0,text:"And This is a third comment with lots and lots of text going on over several lines just to test that we are flexing the box sizes correctly. The test here should appear and the date should be at the end. A comment for teh people by the people and with teh people is the very best way to test this functionality - thank you"}]}}},c.customerContactDataNew={success:!0,total:1,data:{id:"54046343e4b0212332b4fdf3",type:"external",firstName:"Lynn",lastName:"Taylor",fullName:"Lynn Taylor",nickName:"Lynn Taylor George",addressStreet:"245 Nassau Street",addressCity:"Princeton",addressStateCode:"NJ",addressStateName:"New Jersey",addressPostZip:"08542",addressCountryISO:"US",addressCountryName:"United States of America",addressLat:40.351598,addressLong:-74.651275,contactNumbers:[{seq:0,type:"email",details:"lynn@traveller.com"},{seq:0,type:"LinkedIn",details:"lynn@traveller.com"},{seq:0,type:"Phone",details:"123456789"}],companyName:"Traveller, Inc..",jobTitle:"Analyst"}},c.newContactDetails={success:!0,total:1,data:{id:"5405560de4b0212332b4fdf9",poNumber:"TESTPO123",title:"TITLE DESCRIPT",customerId:"53fdf63ea2c94628879aa175",customerName:"ABC Inc.",value:0,budgetedHours:0,deleted:!1}},c.employeeData={success:!0,total:4,dataType:"employeeList",data:[{id:"53ac275ee4b03340b6de4947",employeeNumber:"PER00003PER00003PER00003PER00003PER00003PER00003",thumbUrl:"/data/resources/thumbnail.53b2fd2de4b0123558f41fe5.jpeg",firstName:"Peter",lastName:"Blake",job:"Developer",inactive:!1,commentsExist:!1,attachmentsExist:!1},{id:"53ac2791e4b03340b6de4948",employeeNumber:"PER00005",thumbUrl:"/data/resources/thumbnail.53b2fd39e4b0123558f41fe6.jpeg",firstName:"Jennifer",lastName:"Harvey",job:"Accountant",managerName:"Peter Edgar Blake",isPartTime:!1,isContractor:!1,inactive:!1,commentsExist:!1,attachmentsExist:!1},{id:"53ac27b0e4b03340b6de4949",employeeNumber:"PER00099",thumbUrl:"/data/resources/thumbnail.53b2fc31e4b0123558f41fe2.jpeg",firstName:"Richard",lastName:"Minney",job:"Support",managerName:"Peter Edgar Blake",isPartTime:!1,isContractor:!0,inactive:!0,commentsExist:!1,attachmentsExist:!1},{id:"53b435aa3c01cbf76dd3d796",employeeId:"PER00035",firstName:"Ellie",lastName:"Clarke",job:"Developer",inactive:!1,commentsExist:!1,attachmentsExist:!1}]},c.ContractData={success:!0,total:8,dataType:"contractList",data:[{id:"53d80c0713a2e63528ae5379",title:"Pad Line Repair update",poNumber:"PO 434575",startDate:"2014-08-01",endDate:"2014-09-03",value:882,currency:"USD",customerId:"5403d5d0e4b0212332b4fdd5",customerName:"The Mann Einstein Players",commentsExist:!1,attachmentsExist:!1,deleted:!1},{id:"53ff24e7e4b01a8bc7506b5c",title:"testing contracts",poNumber:"PO Wanted",startDate:"2014-09-11",endDate:"2014-09-13",value:3500,currency:"USD",managerId:"53ac1cac9c1c37083b3d38ab",managerName:"Ken Thompson",customerId:"53fdf562a2c94628879aa174",customerName:"Thompson PRs",commentsExist:!1,attachmentsExist:!1,deleted:!1},{id:"53fe62fa03cd3d2d8df32477",title:"African Safari Testing",poNumber:"PO8877",startDate:"2014-09-26",endDate:"2014-09-29",value:12501,currency:"USD",customerId:"53fdf562a2c94628879aa174",customerName:"Thompson PRs",commentsExist:!1,attachmentsExist:!1,deleted:!1},{id:"5400d0dce4b0212332b4fdcb",title:"Pile Driver",poNumber:"PO 098999 - NEW Testing",startDate:"2014-08-01",endDate:"2014-09-09",value:1500001,currency:"USD",customerId:"53fdf4aca2c94628879aa172",customerName:"GeoHay",commentsExist:!1,attachmentsExist:!1,deleted:!1},{id:"5403f405e4b0212332b4fddb",title:"Help Documents",value:0,customerId:"53fdf562a2c94628879aa174",customerName:"Thompson PRs",commentsExist:!1,attachmentsExist:!1,deleted:!1},{id:"5403f58ce4b0212332b4fddc",title:"Macbook Screen",poNumber:"PO2013",value:0,customerId:"53fdf29aa2c94628879aa170",customerName:"Apple Computers",commentsExist:!1,attachmentsExist:!1,deleted:!1},{id:"53ff0d93e4b01a8bc7506b4f",title:"Application",poNumber:"PO12345",startDate:"2014-09-25",endDate:"2014-09-27",value:2e5,currency:"USD",commentsExist:!1,attachmentsExist:!1,deleted:!1},{id:"54045120e4b0212332b4fdf1",title:"New Contract",poNumber:"PO1234",startDate:"2014-09-26",endDate:"2014-09-30",value:0,customerId:"5404080ce4b0212332b4fdde",customerName:"countryw/ostate",commentsExist:!1,attachmentsExist:!1,deleted:!0}]},c.login={success:!0,total:1,data:{clientUrl:"aswinkumars",userId:"aswinkumar.s@npcompete.net",userName:"Aswinkumar S",companyId:"542f9e62e4b092153ee0970e",companyName:"aswinkumars",language:"en",stdHours:40,themeColor:"#a91e22",themeTextColor:"#ffffff",themeIconUrl:"http://redpandaalpha.com/resources/rpLogoW120.png"}},c.ContractDetailData={success:!0,total:1,data:{id:"53d80b2313a2e63528ae5378",poNumber:"PO 887664",title:"Double Shot",customerId:"53b41103353f736efcab467d",startDate:"2014-09-05",endDate:"2014-09-06",customerName:"Small World",type:"fee",value:0,managerName:"Peter Blake",budgetedHours:67,assignedData:[],activityData:[],comments:[{seqNo:0,postedBy:{name:"ggggg title"},postedOn:"2014-09-29T14:36:16Z",replyTo:0,docRef:0,text:"This is another comment"},{seqNo:1,postedBy:{name:"ggggg title"},postedOn:"2014-09-11T21:33:39.212Z",replyTo:0,docRef:0,text:"This is a comment"},{seqNo:1,postedBy:{name:"Nisha Navlakha"},postedOn:"2014-09-28T03:33:39.212Z",replyTo:0,docRef:0,text:"And This is a third comment with lots and lots of text going on over several lines just to test that we are flexing the box sizes correctly. The test here should appear and the date should be at the end. A comment for teh people by the people and with teh people is the very best way to test this functionality - thank you"}]}},c.newContractActivityData={success:!0,total:1,data:{id:"54197b2ce4b084e5935f2f72",isStandard:!1,isInternal:!1,title:"Test to show correct creation of an activity",status:0,start:"2014-07-23",end:"2014-09-30",isBillable:!1,isFixedFee:!1,rateAmt:0,feeAmt:0,customerId:"5406ed16e4b0544656725bdc",customerName:"TestName",customerColor:"#fbd75b",contractId:"5406ecf5e4b0544656725bdb",contractName:"Example T&M with activity pricing",deleted:!1}},c.temporaryNavigation=function(){e.scrollTo(0,0),b.path("/Home")}}]),angular.module("redPandaApp").directive("datepickers",function(){return{restrict:"A",link:function(a,b,c){b.datepicker({dateFormat:c.format?c.format:"yy-mm-dd"})}}}),angular.module("redPandaApp").directive("xeditable",["$timeout",function(a){return{restrict:"A",require:"ngModel",link:function(b,c,d,e){var f=function(){angular.element(c).editable({display:function(a){e.$setViewValue(a),b.$apply()}})};a(function(){f()},1)}}}]),angular.module("redPandaApp").directive("dropdownMultiselect",function(){return{restrict:"E",scope:{model:"=",options:"=",pre_selected:"=preSelected",tablemodel:"=tablemodel"},replace:!0,template:"<div class='btn-group department dropdown' data-ng-class='{open: open}'><button class='btn btn-small multiselect-btn'><div class='depaertment-select'><span ng-show='model.length == 0'>--Select--</span><span ng-repeat='mod in model'>{{mod}}<span ng-show='($index !=-1 && !$last)'>,</span></span></div></button><button class='btn btn-small dropdown-toggle' data-ng-click='open=!open;openDropdown()'><span class='caret'></span></button><ul class='dropdown-menu' aria-labelledby='dropdownMenu'><li data-ng-repeat='option in options'><a data-ng-click='setSelectedItem()'>{{option.name.nickName}}<span data-ng-class='isChecked(option.name.nickName)'></span></a></li></ul></div>",controller:["$scope","$rootScope",function(a,b){a.model=[],angular.forEach(b.ClonedSelectedManager,function(b){a.model.push(b.name)}),a.setSelectedItem=function(){if(null!=this.option.name&&null!=this.option.name.nickName){var b=this.option.name.nickName;if(_.contains(a.model,b))for(var c=0;c<a.model.length;c++)a.model[c]==b&&(a.tablemodel.splice(c,1),a.model.splice(c,1));else a.model.push(b),a.tablemodel.push({name:b});return!1}},a.isChecked=function(b){return _.contains(a.model,b)?"glyphicon glyphicon-ok pull-right":!1}}]}}),angular.module("redPandaApp").directive("isStdtimeTwodp",function(){return{require:"ngModel",link:function(a,b){a.$watch("EmployeeDetail.data.stdCostAmt",function(b,c){if(""!=b&&null!=b){var d=String(b).split("");if(0!==d.length&&(1!==d.length||"."!==d[0])){for(var e=0;e<d.length;e++)"."===d[e]&&d.length-1-e>2&&(a.EmployeeDetail.data.stdCostAmt=c);if(isNaN(b)){if(null==a.EmployeeDetail)return;a.EmployeeDetail.data.stdCostAmt=c}}}}),b.bind("blur",function(b){var c=b.target.value;""!=c&&(a.EmployeeDetail.data.stdCostAmt=Number(b.target.value).toFixed(2),a.$apply())})}}}),angular.module("redPandaApp").directive("hourlyRate",function(){return{require:"ngModel",link:function(a,b,c,d){a.$watch(c.ngModel,function(a,b){if(""!=a&&null!=a){var c=String(a).split("");if(0!==c.length&&(1!==c.length||"."!==c[0])){for(var e=0;e<c.length;e++)"."===c[e]&&c.length-1-e>2&&(d.$setViewValue(b),d.$render());isNaN(a)&&(d.$setViewValue(b),d.$render())}}}),b.bind("blur",function(a){var b=a.target.value;""!=b&&(d.$setViewValue(Number(a.target.value).toFixed(2)),d.$render())})}}}),angular.module("redPandaApp").directive("isValue",function(){return{require:"ngModel",link:function(a,b){a.$watch("contractDetail.data.value",function(b,c){if(""!=b&&null!=b){var d=String(b).split("");if(0!==d.length&&(1!==d.length||"."!==d[0])){for(var e=0;e<d.length;e++)"."===d[e]&&d.length-1-e>2&&(a.contractDetail.data.value=c);if(isNaN(b)){if(null==a.contractDetail)return;a.contractDetail.data.value=c}}}}),b.bind("blur",function(b){var c=b.target.value;""!=c&&(a.contractDetail.data.value=Number(b.target.value).toFixed(2),a.$apply())})}}}),angular.module("redPandaApp").directive("twoDecimalPoints",function(){return{require:"ngModel",link:function(a,b){a.$watch("contractDetail.data.budgetedHours",function(b,c){if(""!=b&&null!=b){var d=String(b).split("");if(0!==d.length&&(1!==d.length||"."!==d[0])){for(var e=0;e<d.length;e++)"."===d[e]&&d.length-1-e>2&&(a.contractDetail.data.budgetedHours=c);if(isNaN(b)){if(null==a.contractDetail)return;a.contractDetail.data.budgetedHours=c}}}}),b.bind("blur",function(b){var c=b.target.value;""!=c&&(a.contractDetail.data.budgetedHours=Number(b.target.value).toFixed(2),a.$apply())})}}}),angular.module("redPandaApp").directive("isOvertimeTwodp",function(){return{require:"ngModel",link:function(a,b){a.$watch("EmployeeDetail.data.otCostAmt",function(b,c){if(""!=b&&null!=b){var d=String(b).split("");if(0!==d.length&&(1!==d.length||"."!==d[0])){for(var e=0;e<d.length;e++)"."===d[e]&&d.length-1-e>2&&(a.EmployeeDetail.data.otCostAmt=c);if(isNaN(b)){if(null==a.EmployeeDetail)return;a.EmployeeDetail.data.otCostAmt=c}}}}),b.bind("blur",function(b){var c=b.target.value;""!=c&&(a.EmployeeDetail.data.otCostAmt=Number(b.target.value).toFixed(2),a.$apply())})}}}),angular.module("redPandaApp").directive("ngFileSelect",function(){return{link:function(a,b){b.bind("change",function(b){if(a.file=(b.srcElement||b.target).files[0],null!=a.file){if("image"!=a.file.type.split("/")[0])return a.addAlert("Upload valid Image file.","danger"),void a.$apply();if(a.file.size/1024>1e3)return a.addAlert("Image file exceeds maximum area.Please choose a file under 1MB.","danger"),void a.$apply();a.closeAlert(),a.getFile(a.file)}})}}}),angular.module("redPandaApp").directive("numbersOnly",function(){return{require:"ngModel",link:function(a,b,c,d){d.$parsers.push(function(a){if(void 0==a)return"";var b=a.replace(/[^0-9]/g,"");return b!=a&&(d.$setViewValue(b),d.$render()),b})}}}),angular.module("redPandaApp").service("CurrentTimeStamp",function(){this.postTimeStamp=function(){var a=new Date,b=function(a){var b="00",c="00";return isNegative=!1,b=Math.floor(a/60),0>b&&(b=-b,isNegative=!0),9>b&&(b="0"+b),c=Math.floor(a%60),0>c&&(c=-c),9>c&&(c="0"+c),isNegative?"-"+(b+":"+c):"+"+b+":"+c},c=function(a){var b="";return b=1==a.toString().length?"0"+a:a.toString()},d=function(){var b="",c=a.getMilliseconds();return b=""==c||null==c?"000":2==c.toString().length?"0"+c:1==c.toString().length?"00"+c:c.toString()},e=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+"T"+c(a.getHours())+":"+c(a.getMinutes())+":"+c(a.getSeconds())+"."+d()+b(-a.getTimezoneOffset());return e}}),angular.module("redPandaApp").service("FilterDeleted",function(){this.filter=function(a){var b=[];if("undefined"!=typeof a&&a.length>0){for(var c=0;c<a.length;c++)a[c].deleted?a.splice([c],1):b.push(a[c]);return b}}}),angular.module("redPandaApp").service("IsoDateFormat",function(){this.convert=function(a){console.log(a);var b=moment(a,"MM-DD-YY");console.log(b);var c=b.year(),d=1==(b.month()+1).toString().length?"0"+(b.month()+1):b.month()+1,e=1==b.date().toString().length?"0"+b.date():b.date(),f=c+"-"+d+"-"+e;return f}}),angular.module("redPandaApp").service("USDateFormat",function(){this.convert=function(a,b){var c=moment(a),d=1==(c.month()+1).toString().length?"0"+(c.month()+1):c.month()+1,e=1==c.date().toString().length?"0"+c.date():c.date(),f=c.year().toString().substring(2,4);if(null!=b)var g=d+"/"+e+"/"+f;else var g=d+"-"+e+"-"+f;return g}}),angular.module("redPandaApp").service("UserComments",function(){var a=function(a){var b=a%10,c=a%100;return 1==b&&11!=c?a+"st":2==b&&12!=c?a+"nd":3==b&&13!=c?a+"rd":a+"th"};this.convertCommentDate=function(b){if(""!=b){var c=60,d=60,e=d*c,f=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],g=["January","February","March","April","May","June","July","August","September","October","November","December"],h=new Date(b),i=h.getHours(),j=h.getMinutes(),k=i>=12?"pm":"am";i%=12,i=i?i:12,i=10>i?"0"+i:i,j=10>j?"0"+j:j;var l=h.getDate();l=a(l);var m=h.getTime(),n=new Date,o=n.getTime(),p=Math.floor((o-m)/1e3);return 1*d>p?1>=p?"one second ago":p+" seconds ago":2*d>p?"a minute ago":45*d>p?Math.floor(p/60)+" minutes ago":90*d>p?"an hour ago":24*e>p?Math.floor(p/3600)+" hours ago":48*e>p?"yesterday":f[h.getDay()]+" "+g[h.getMonth()]+" "+l+" at "+i+":"+j+k}},this.formatInputData=function(a){var b=this.convertCommentDate;return null==a||0===a.length?a=[]:angular.forEach(a,function(a){null!=a.postedOn&&(a.tempTime=b(a.postedOn)),null!=a.postedBy&&(null==a.postedBy.thumbUrl||""==a.postedBy.thumbUrl)&&(a.postedBy.thumbUrl=$rootScope.defaultUserImage)}),a},this.filterPostData=function(a){return a.length>0&&angular.forEach(a,function(a){null!=a.tempTime&&delete a.tempTime,null!=a.postedBy&&(a.postedBy.thumbUrl&&delete a.postedBy.thumbUrl,a.postedBy.name&&delete a.postedBy.name)}),a}}),function(a){function b(a,b,e){var f=a[0],g=/er/.test(e)?_indeterminate:/bl/.test(e)?n:l,h=e==_update?{checked:f[l],disabled:f[n],indeterminate:"true"==a.attr(_indeterminate)||"false"==a.attr(_determinate)}:f[g];if(/^(ch|di|in)/.test(e)&&!h)c(a,g);else if(/^(un|en|de)/.test(e)&&h)d(a,g);else if(e==_update)for(var i in h)h[i]?c(a,i,!0):d(a,i,!0);else b&&"toggle"!=e||(b||a[_callback]("ifClicked"),h?f[_type]!==k&&d(a,g):c(a,g))}function c(b,c,e){var o=b[0],p=b.parent(),q=c==l,r=c==_indeterminate,s=c==n,t=r?_determinate:q?m:"enabled",u=f(b,t+g(o[_type])),v=f(b,c+g(o[_type]));if(!0!==o[c]){if(!e&&c==l&&o[_type]==k&&o.name){var w=b.closest("form"),x='input[name="'+o.name+'"]',x=w.length?w.find(x):a(x);x.each(function(){this!==o&&a(this).data(i)&&d(a(this),c)})}r?(o[c]=!0,o[l]&&d(b,l,"force")):(e||(o[c]=!0),q&&o[_indeterminate]&&d(b,_indeterminate,!1)),h(b,q,c,e)}o[n]&&f(b,_cursor,!0)&&p.find("."+j).css(_cursor,"default"),p[_add](v||f(b,c)||""),p.attr("role")&&!r&&p.attr("aria-"+(s?n:l),"true"),p[_remove](u||f(b,t)||"")}function d(a,b,c){var d=a[0],e=a.parent(),i=b==l,k=b==_indeterminate,o=b==n,p=k?_determinate:i?m:"enabled",q=f(a,p+g(d[_type])),r=f(a,b+g(d[_type]));!1!==d[b]&&((k||!c||"force"==c)&&(d[b]=!1),h(a,i,p,c)),!d[n]&&f(a,_cursor,!0)&&e.find("."+j).css(_cursor,"pointer"),e[_remove](r||f(a,b)||""),e.attr("role")&&!k&&e.attr("aria-"+(o?n:l),"false"),e[_add](q||f(a,p)||"")}function e(b,c){b.data(i)&&(b.parent().html(b.attr("style",b.data(i).s||"")),c&&b[_callback](c),b.off(".i").unwrap(),a(_label+'[for="'+b[0].id+'"]').add(b.closest(_label)).off(".i"))}function f(a,b,c){return a.data(i)?a.data(i).o[b+(c?"":"Class")]:void 0}function g(a){return a.charAt(0).toUpperCase()+a.slice(1)}function h(a,b,c,d){d||(b&&a[_callback]("ifToggled"),a[_callback]("ifChanged")[_callback]("if"+g(c)))}var i="iCheck",j=i+"-helper",k="radio",l="checked",m="un"+l,n="disabled";_determinate="determinate",_indeterminate="in"+_determinate,_update="update",_type="type",_click="click",_touch="touchbegin.i touchend.i",_add="addClass",_remove="removeClass",_callback="trigger",_label="label",_cursor="cursor",_mobile=/ipad|iphone|ipod|android|blackberry|windows phone|opera mini|silk/i.test(navigator.userAgent),a.fn[i]=function(f,g){var h='input[type="checkbox"], input[type="'+k+'"]',m=a(),o=function(b){b.each(function(){var b=a(this);m=m.add(b.is(h)?b:b.find(h))})};if(/^(check|uncheck|toggle|indeterminate|determinate|disable|enable|update|destroy)$/i.test(f))return f=f.toLowerCase(),o(this),m.each(function(){var c=a(this);"destroy"==f?e(c,"ifDestroyed"):b(c,!0,f),a.isFunction(g)&&g()});if("object"!=typeof f&&f)return this;var p=a.extend({checkedClass:l,disabledClass:n,indeterminateClass:_indeterminate,labelHover:!0},f),q=p.handle,r=p.hoverClass||"hover",s=p.focusClass||"focus",t=p.activeClass||"active",u=!!p.labelHover,v=p.labelHoverClass||"hover",w=0|(""+p.increaseArea).replace("%","");return("checkbox"==q||q==k)&&(h='input[type="'+q+'"]'),-50>w&&(w=-50),o(this),m.each(function(){var f=a(this);e(f);var g=this,h=g.id,m=-w+"%",o=100+2*w+"%",o={position:"absolute",top:m,left:m,display:"block",width:o,height:o,margin:0,padding:0,background:"#fff",border:0,opacity:0},m=_mobile?{position:"absolute",visibility:"hidden"}:w?o:{position:"absolute",opacity:0},q="checkbox"==g[_type]?p.checkboxClass||"icheckbox":p.radioClass||"i"+k,x=a(_label+'[for="'+h+'"]').add(f.closest(_label)),y=!!p.aria,z=i+"-"+Math.random().toString(36).substr(2,6),A='<div class="'+q+'" '+(y?'role="'+g[_type]+'" ':"");y&&x.each(function(){A+='aria-labelledby="',this.id?A+=this.id:(this.id=z,A+=z),A+='"'}),A=f.wrap(A+"/>")[_callback]("ifCreated").parent().append(p.insert),o=a('<ins class="'+j+'"/>').css(o).appendTo(A),f.data(i,{o:p,s:f.attr("style")}).css(m),p.inheritClass&&A[_add](g.className||""),p.inheritID&&h&&A.attr("id",i+"-"+h),"static"==A.css("position")&&A.css("position","relative"),b(f,!0,_update),x.length&&x.on(_click+".i mouseover.i mouseout.i "+_touch,function(c){var d=c[_type],e=a(this);if(!g[n]){if(d==_click){if(a(c.target).is("a"))return;b(f,!1,!0)}else u&&(/ut|nd/.test(d)?(A[_remove](r),e[_remove](v)):(A[_add](r),e[_add](v)));if(!_mobile)return!1;c.stopPropagation()}}),f.on(_click+".i focus.i blur.i keyup.i keydown.i keypress.i",function(a){var b=a[_type];return a=a.keyCode,b==_click?!1:"keydown"==b&&32==a?(g[_type]==k&&g[l]||(g[l]?d(f,l):c(f,l)),!1):void("keyup"==b&&g[_type]==k?!g[l]&&c(f,l):/us|ur/.test(b)&&A["blur"==b?_remove:_add](s))}),o.on(_click+" mousedown mouseup mouseover mouseout "+_touch,function(a){var c=a[_type],d=/wn|up/.test(c)?t:r;if(!g[n]){if(c==_click?b(f,!1,!0):(/wn|er|in/.test(c)?A[_add](d):A[_remove](d+" "+t),x.length&&u&&d==r&&x[/ut|nd/.test(c)?_remove:_add](v)),!_mobile)return!1;a.stopPropagation()}})})}}(window.jQuery||window.Zepto),!function(){function a(){}function b(a){return f.retinaImageSuffix+a}function c(a,c){if(this.path=a||"","undefined"!=typeof c&&null!==c)this.at_2x_path=c,this.perform_check=!1;else{if(void 0!==document.createElement){var d=document.createElement("a");d.href=this.path,d.pathname=d.pathname.replace(g,b),this.at_2x_path=d.href}else{var e=this.path.split("?");e[0]=e[0].replace(g,b),this.at_2x_path=e.join("?")}this.perform_check=!0}}function d(a){this.el=a,this.path=new c(this.el.getAttribute("src"),this.el.getAttribute("data-at2x"));var b=this;this.path.check_2x_variant(function(a){a&&b.swap()})}var e="undefined"==typeof exports?window:exports,f={retinaImageSuffix:"@2x",check_mime_type:!0,force_original_dimensions:!0};e.Retina=a,a.configure=function(a){null===a&&(a={});for(var b in a)a.hasOwnProperty(b)&&(f[b]=a[b])},a.init=function(a){null===a&&(a=e);var b=a.onload||function(){};
a.onload=function(){var a,c,e=document.getElementsByTagName("img"),f=[];for(a=0;a<e.length;a+=1)c=e[a],c.getAttributeNode("data-no-retina")||f.push(new d(c));b()}},a.isRetina=function(){var a="(-webkit-min-device-pixel-ratio: 1.5), (min--moz-device-pixel-ratio: 1.5), (-o-min-device-pixel-ratio: 3/2), (min-resolution: 1.5dppx)";return e.devicePixelRatio>1?!0:e.matchMedia&&e.matchMedia(a).matches?!0:!1};var g=/\.\w+$/;e.RetinaImagePath=c,c.confirmed_paths=[],c.prototype.is_external=function(){return!(!this.path.match(/^https?\:/i)||this.path.match("//"+document.domain))},c.prototype.check_2x_variant=function(a){var b,d=this;return this.is_external()?a(!1):this.perform_check||"undefined"==typeof this.at_2x_path||null===this.at_2x_path?this.at_2x_path in c.confirmed_paths?a(!0):(b=new XMLHttpRequest,b.open("HEAD",this.at_2x_path),b.onreadystatechange=function(){if(4!==b.readyState)return a(!1);if(b.status>=200&&b.status<=399){if(f.check_mime_type){var e=b.getResponseHeader("Content-Type");if(null===e||!e.match(/^image/i))return a(!1)}return c.confirmed_paths.push(d.at_2x_path),a(!0)}return a(!1)},void b.send()):a(!0)},e.RetinaImage=d,d.prototype.swap=function(a){function b(){c.el.complete?(f.force_original_dimensions&&(c.el.setAttribute("width",c.el.offsetWidth),c.el.setAttribute("height",c.el.offsetHeight)),c.el.setAttribute("src",a)):setTimeout(b,5)}"undefined"==typeof a&&(a=this.path.at_2x_path);var c=this;b()},a.isRetina()&&a.init(e)}();var saveAs=saveAs||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(a){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var b=a.document,c=function(){return a.URL||a.webkitURL||a},d=b.createElementNS("http://www.w3.org/1999/xhtml","a"),e=!a.externalHost&&"download"in d,f=function(c){var d=b.createEvent("MouseEvents");d.initMouseEvent("click",!0,!1,a,0,0,0,0,0,!1,!1,!1,!1,0,null),c.dispatchEvent(d)},g=a.webkitRequestFileSystem,h=a.requestFileSystem||g||a.mozRequestFileSystem,i=function(b){(a.setImmediate||a.setTimeout)(function(){throw b},0)},j="application/octet-stream",k=0,l=[],m=function(){for(var a=l.length;a--;){var b=l[a];"string"==typeof b?c().revokeObjectURL(b):b.remove()}l.length=0},n=function(a,b,c){b=[].concat(b);for(var d=b.length;d--;){var e=a["on"+b[d]];if("function"==typeof e)try{e.call(a,c||a)}catch(f){i(f)}}},o=function(b,i){var m,o,p,q=this,r=b.type,s=!1,t=function(){var a=c().createObjectURL(b);return l.push(a),a},u=function(){n(q,"writestart progress write writeend".split(" "))},v=function(){(s||!m)&&(m=t(b)),o?o.location.href=m:window.open(m,"_blank"),q.readyState=q.DONE,u()},w=function(a){return function(){return q.readyState!==q.DONE?a.apply(this,arguments):void 0}},x={create:!0,exclusive:!1};return q.readyState=q.INIT,i||(i="download"),e?(m=t(b),d.href=m,d.download=i,f(d),q.readyState=q.DONE,void u()):(a.chrome&&r&&r!==j&&(p=b.slice||b.webkitSlice,b=p.call(b,0,b.size,j),s=!0),g&&"download"!==i&&(i+=".download"),(r===j||g)&&(o=a),h?(k+=b.size,void h(a.TEMPORARY,k,w(function(a){a.root.getDirectory("saved",x,w(function(a){var c=function(){a.getFile(i,x,w(function(a){a.createWriter(w(function(c){c.onwriteend=function(b){o.location.href=a.toURL(),l.push(a),q.readyState=q.DONE,n(q,"writeend",b)},c.onerror=function(){var a=c.error;a.code!==a.ABORT_ERR&&v()},"writestart progress write abort".split(" ").forEach(function(a){c["on"+a]=q["on"+a]}),c.write(b),q.abort=function(){c.abort(),q.readyState=q.DONE},q.readyState=q.WRITING}),v)}),v)};a.getFile(i,{create:!1},w(function(a){a.remove(),c()}),w(function(a){a.code===a.NOT_FOUND_ERR?c():v()}))}),v)}),v)):void v())},p=o.prototype,q=function(a,b){return new o(a,b)};return p.abort=function(){var a=this;a.readyState=a.DONE,n(a,"abort")},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,a.addEventListener("unload",m,!1),q.unload=function(){m(),a.removeEventListener("unload",m,!1)},q}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&null!==module?module.exports=saveAs:"undefined"!=typeof define&&null!==define&&null!=define.amd&&define([],function(){return saveAs}),function(a){var b=function(a){var b=function(a,b,c){return function(){c.$apply(function(){b.resolve(a.result)})}},c=function(a,b,c){return function(){c.$apply(function(){b.reject(a.result)})}},d=function(a,b){return function(a){b.$broadcast("fileProgress",{total:a.total,loaded:a.loaded})}},e=function(a,e){var f=new FileReader;return f.onload=b(f,a,e),f.onerror=c(f,a,e),f.onprogress=d(f,e),f},f=function(b,c){var d=a.defer(),f=e(d,c);return f.readAsDataURL(b),d.promise};return{readAsDataUrl:f}};a.factory("fileReader",["$q","$log",b])}(angular.module("redPandaApp")),angular.module("redPandaApp").directive("downloadReport",function(){return{restrict:"A",scope:{isDownloadCreator:"=",saveas:"="},link:function(a){a.$watch("isDownloadCreator",function(b){if(1==b)if(navigator.userAgent.search("Safari")>=0&&navigator.userAgent.search("Chrome")<0)alert("Download functions have been temporarily disabled in Safari due to an browser issue.  Waiting for issue resolution from Apple.  Please switch to Firefox or Chrome for use of the download function."),a.isDownloadCreator=!1;else{var c=new Blob([angular.element("#exportable").html()],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8"});saveAs(c,a.saveas),a.isDownloadCreator=!1}})}}}),function(a){"use strict";var b=function(a,b){this.init("simplecolorpicker",a,b)};b.prototype={constructor:b,init:function(b,c,d){var e=this;if(e.type=b,e.$select=a(c),e.$select.hide(),e.options=a.extend({},a.fn.simplecolorpicker.defaults,d),e.$colorList=null,e.options.picker===!0){var f=e.$select.find("> option:selected").text();e.$icon=a('<span class="simplecolorpicker icon" title="'+f+'" style="background-color: '+e.$select.val()+';" role="button" tabindex="0"></span>').insertAfter(e.$select),e.$icon.on("click."+e.type,a.proxy(e.showPicker,e)),e.$picker=a('<span class="simplecolorpicker picker '+e.options.theme+'"></span>').appendTo(document.body),e.$colorList=e.$picker,a(document).on("mousedown."+e.type,a.proxy(e.hidePicker,e)),e.$picker.on("mousedown."+e.type,a.proxy(e.mousedown,e))}else e.$inline=a('<span class="simplecolorpicker inline '+e.options.theme+'"></span>').insertAfter(e.$select),e.$colorList=e.$inline;e.$select.find("> option").each(function(){var b=a(this),c=b.val(),d=b.is(":selected"),f=b.is(":disabled"),g="";d===!0&&(g=" data-selected");var h="";f===!0&&(h=" data-disabled");var i="";f===!1&&(i=' title="'+b.text()+'"');var j="";f===!1&&(j=' role="button" tabindex="0"');var k=a('<span class="color"'+i+' style="background-color: '+c+';" data-color="'+c+'"'+g+h+j+"></span>");e.$colorList.append(k),k.on("click."+e.type,a.proxy(e.colorSpanClicked,e));var l=b.next();l.is("optgroup")===!0&&e.$colorList.append('<span class="vr"></span>')})},selectColor:function(b){var c=this,d=c.$colorList.find("> span.color").filter(function(){return a(this).data("color").toLowerCase()===b.toLowerCase()});d.length>0?c.selectColorSpan(d):console.error("The given color '"+b+"' could not be found")},showPicker:function(){var a=this.$icon.offset();this.$picker.css({left:a.left-15,top:a.top+this.$icon.outerHeight()}),this.$picker.show(this.options.pickerDelay)},hidePicker:function(){this.$picker.hide(this.options.pickerDelay)},selectColorSpan:function(a){var b=a.data("color"),c=a.prop("title");a.siblings().removeAttr("data-selected"),a.attr("data-selected",""),this.options.picker===!0&&(this.$icon.css("background-color",b),this.$icon.prop("title",c),this.hidePicker()),this.$select.val(b)},colorSpanClicked:function(b){a(b.target).is("[data-disabled]")===!1&&(this.selectColorSpan(a(b.target)),this.$select.trigger("change"))},mousedown:function(a){a.stopPropagation(),a.preventDefault()},destroy:function(){this.options.picker===!0&&(this.$icon.off("."+this.type),this.$icon.remove(),a(document).off("."+this.type)),this.$colorList.off("."+this.type),this.$colorList.remove(),this.$select.removeData(this.type),this.$select.show()}},a.fn.simplecolorpicker=function(c){var d=a.makeArray(arguments);return d.shift(),this.each(function(){var e=a(this),f=e.data("simplecolorpicker"),g="object"==typeof c&&c;void 0===f&&e.data("simplecolorpicker",f=new b(this,g)),"string"==typeof c&&f[c].apply(f,d)})},a.fn.simplecolorpicker.defaults={theme:"",picker:!1,pickerDelay:0}}(jQuery),angular.module("redPandaApp").controller("tableController",["$scope","$timeout","$window","$rootScope",function(a,b,c,d){a.empData=[],a.ngGridTableOptions=a.tableOptions,null==a.ngGridTableOptions.listData&&(a.ngGridTableOptions.listData=[]),a.$watch("ngGridTableOptions.listData",function(b){null!=b&&(d.searchData&&(a.ngGridTableOptions.filterOptions.filterText=d.searchData),a.getTableData(a.ngGridTableOptions.pageOptions.pageSize,a.ngGridTableOptions.pageOptions.currentPage,a.ngGridTableOptions.filterOptions.filterText))},!0),a.rebuildTable=function(){a.tableData.$gridServices.DomUtilityService.RebuildGrid(a.tableData.$gridScope,a.tableData.ngGrid)},a.tableSettings=function(b,c,d){var e=b.slice((c-1)*d,c*d);a.fromshowing=(c-1)*d+1,a.toshowing=c*d,a.empData=e,a.totalServerItems=b.length,a.$$phase||(a.$apply(),a.rebuildTable())},a.getTableData=function(b,c,d){setTimeout(function(){var e;if(d){largeLoad=a.ngGridTableOptions.listData;var f=d.toLowerCase();e=largeLoad.filter(function(a){return-1!=JSON.stringify(a).toLowerCase().indexOf(f)}),a.tableSettings(e,c,b)}else a.tableSettings(a.ngGridTableOptions.listData,c,b)},100)},a.$watch("ngGridTableOptions.pageOptions",function(b,d){b!==d&&(b.pageSize!=d.pageSize&&(a.ngGridTableOptions.pageOptions.currentPage=1),c.scrollTo(0,0),a.getTableData(a.ngGridTableOptions.pageOptions.pageSize,a.ngGridTableOptions.pageOptions.currentPage,a.ngGridTableOptions.filterOptions.filterText))},!0),a.$watch("shiftNav",function(b,c){b!=c&&a.rebuildTable()},!0),a.$watch("ngGridTableOptions.filterOptions",function(b,c){b!=c&&(a.ngGridTableOptions.pageOptions.currentPage=1,d.searchData=a.ngGridTableOptions.filterOptions.filterText,a.getTableData(a.ngGridTableOptions.pageOptions.pageSize,a.ngGridTableOptions.pageOptions.currentPage,a.ngGridTableOptions.filterOptions.filterText))},!0),a.tableData={data:"empData",rowHeight:a.ngGridTableOptions.rowHeight?a.ngGridTableOptions.rowHeight:57,multiSelect:!1,enableRowSelection:!0,enableSorting:!0,showFooter:!1,enableColumnResize:!0,filterOptions:a.ngGridTableOptions.filterOptions,enablePaging:!0,selectedItems:a.selectedData,totalServerItems:"totalServerItems",sortInfo:a.ngGridTableOptions.sortInfo,useExternalSorting:a.ngGridTableOptions.useExternalSorting,pagingOptions:a.ngGridTableOptions.pageOptions,rowTemplate:a.ngGridTableOptions.rowTemplate,columnDefs:a.ngGridTableOptions.columnDefs};var e=function(b,c){a.inValue=!1,null!=a.ngGridTableOptions.listData&&("value"==b&&(a.inValue=!0),a.ngGridTableOptions.listData.sort(function(d,e){var f,g;if("isContractor"==b&&null==d[b]&&(d[b]=!1),"boolean"!=typeof d[b]&&(null!=d[b]?f="number"!=typeof d[b]?a.inValue?parseFloat(d[b]):d[b].toLowerCase():d[b]:(null==d[b]||"undefined"==typeof d[b])&&(f=""),null!=e[b]?g="number"!=typeof d[b]?a.inValue?parseFloat(e[b]):e[b].toLowerCase():e[b]:(null==e[b]||"undefined"==typeof e[b])&&(g="")),"asc"==c){if("boolean"==typeof d[b])return d[b]?-1:1;if(f>g)return 1;if(g>f)return-1}else{if("boolean"==typeof d[b])return d[b]?1:-1;if(f>g)return-1;if(g>f)return 1}}))};a.$watch("ngGridTableOptions.sortInfo",function(a,b){(""!=a.fields[0]||""!=b.fields[0])&&e(a.fields[0],a.directions[0])},!0),a.$on("ngGridEventSorted",function(){null!=a.isJsonFormattingNeeded&&a.isJsonFormattingNeeded&&a.formatJSONforDownload()})}]),angular.module("redPandaApp").controller("mapController",["$scope","$cookieStore",function(a){a.$watch("needMapCall.callMap",function(b){null!=b&&1==b&&(a.geocoding(),a.needMapCall.callMap=!1)},!0),a.geocoding=function(){var b=new google.maps.Geocoder;if(null!=a.mapOptions){a.street=null!=a.mapOptions.data[a.addressKeys[0]]?a.mapOptions.data[a.addressKeys[0]]:"",a.city=null!=a.mapOptions.data[a.addressKeys[1]]?a.mapOptions.data[a.addressKeys[1]]:"",a.zip=null!=a.mapOptions.data[a.addressKeys[3]]?a.mapOptions.data[a.addressKeys[3]]:"",a.state=null!=a.mapOptions.data[a.addressKeys[2]]?"object"==typeof a.mapOptions.data[a.addressKeys[2]]?a.mapOptions.data[a.addressKeys[2]].name:a.mapOptions.data[a.addressKeys[2]]:"",a.country=null!=a.mapOptions.data[a.addressKeys[4]]?"object"==typeof a.mapOptions.data[a.addressKeys[4]]?a.mapOptions.data[a.addressKeys[4]].name:a.mapOptions.data[a.addressKeys[4]]:"";var c=a.country+","+a.state+","+a.zip+","+a.city+","+a.street;b.geocode({address:c,region:a.country},function(b,c){var d=[];if(c==google.maps.GeocoderStatus.OK){var e=b[0].geometry.location;for(k in e)e.hasOwnProperty(k)&&d.push(e[k]);a.map={center:{latitude:d[0],longitude:d[1]},zoom:11},a.marker={center:{latitude:d[0],longitude:d[1]}},a.$$phase||(a.$apply(),a.mapOptions.data.addressLat=d[0],a.mapOptions.data.addressLong=d[1])}})}},a.map={center:{latitude:40,longitude:-74.5},zoom:2},a.marker={center:{latitude:40,longitude:-74.5}}}]),angular.module("redPandaApp").controller("HomePageController",["$scope","$location","$http","$window","$rootScope","$cookieStore",function(a,b,c,d,e,f){f.put("enableApplication",!0),e.showApplication=f.get("enableApplication")}]),angular.module("redPandaApp").controller("employeeController",["$scope","$rootScope","$location","$http","$filter","$cookieStore","$timeout","$window","CurrentTimeStamp",function(a,b,c,d,e,f,g,h,i){b.manage=!0,b.selectedMenu="Employee",a.totalServerItems=0,a.maxSize=3,a.isDowloadClicked=!1,a.orderByField="",a.reverseSort=!0,a.previousSortIndex="",a.formattedEmpList=[],a.selectedData=[],b.calledFromCustomerDetail=!1,b.calledFromContractDetail=!1,a.enableEmpButtons=!0,b.calledFromEmployeeDetail?b.calledFromEmployeeDetail=!1:b.searchData=!1,a.isJsonFormattingNeeded=!0,b.closeAlert(),a.sortInfo={fields:["","","","","","","",""],directions:[""]},a.filterOptions={filterText:"",useExternalFilter:!1},a.pagingOptions={pageSizes:[1,10,25,50,100],pageSize:10,currentPage:1},a.tableOptions={listData:null,rowHeight:60,rowTemplate:'<div ng-dblclick="navigateToDetail(row)" ng-style="{ \'cursor\': row.cursor }" ng-repeat="col in renderedColumns" ng-class="col.colIndex()" class="ngCell {{col.cellClass}}"><div class="ngVerticalBar" ng-style="{height: rowHeight}" ng-class="{ ngVerticalBarVisible: !$last }">&nbsp;</div><div ng-cell></div></div>',columnDefs:[{field:"employeeNumber",displayName:"ID"},{field:"",displayName:"",sortable:!1,cellTemplate:'<div class = "ngCellText"><span ng-if="row.entity.thumbUrl == null" class ="default-image"></span><span ng-if="row.entity.thumbUrl !=null"><img ng-src="{{row.entity.thumbUrl}}" class="img-circle"/></span></div>'},{field:"firstName",displayName:"First"},{field:"lastName",displayName:"Last"},{field:"job",displayName:"Job"},{field:"departmentName",displayName:"Department"},{field:"managerName",displayName:"Manager",width:"150px"},{field:"isContractor",displayName:"Type",cellTemplate:'<div class ="ngCellText cell-container"><label class="label label-success" ng-show="!row.entity.isContractor">Employee</label><label ng-show="row.entity.isContractor" class="label label-info">Contractor</label></div>'},{field:"isInactive",displayName:"Status",cellTemplate:'<div class="ngCellText cell-container"><label ng-show="row.entity[col.field]" class="label label-important">Terminated</label><label ng-show="!row.entity[col.field]" class="label label-success">Active</label></div>'},{field:"",displayName:"",sortable:!1,cellTemplate:'<div class="ngCellText employee-Button-container"><button class="btn" style="margin-right:5px;" ng-class="{\'label-success\':row.entity.commentsExist,\'label-grey\':!row.entity.commentsExist}"><i class="fa fa-comment"></i></button><button class="btn" ng-class="{\'label-info\':row.entity.attachmentsExist,\'label-grey\':!row.entity.attachmentsExist}"> <i class="fa fa-folder-open"></i> </button></div>'}],useExternalSorting:!0,filterOptions:a.filterOptions,pageOptions:a.pagingOptions,sortInfo:a.sortInfo,selectedItems:a.selectedData},a.navigateToDetail=function(a){null!=a?f.put("detailId",a.entity.id):f.put("detailId","create"),b.selectedEmpType=f.get("detailId"),b.closeAlert(),c.path("/EmployeeDetail")},a.DeleteEmployee=function(){a.tableOptions.selectedItems.length>0?(b.closeAlert(),null==a.tableOptions.selectedItems[0].firstName&&(a.tableOptions.selectedItems[0].firstName=""),null==a.tableOptions.selectedItems[0].lastName&&(a.tableOptions.selectedItems[0].lastName=""),b.showModal("/api/delete/contact/"+a.tableOptions.selectedItems[0].id,"Confirm Delete","Are you sure you would like to delete "+a.tableOptions.selectedItems[0].firstName+" "+a.tableOptions.selectedItems[0].lastName+" ? This action can not be undone.","Cancel","Confirm"),a.$watch("isPostSuccess",function(c,d){null!=c&&c!=d&&(b.isPostSuccess?(b.localCache.isEmpAPINeeded=!0,j(),a.tableOptions.selectedItems.length=0):b.addAlert("Failed to delete. ","danger","Error"),b.isPostSuccess=null)})):b.addAlert("Please select an Employee.","warning","Warning")},a.formatJSONforDownload=function(){if(null!=a.employeeList){var b=a.employeeList.length;a.formattedEmpList=[];for(var c=0;b>c;c++)a.formattedEmpList[c]=angular.copy(a.employeeList[c]),a.formattedEmpList[c].isContractor?a.formattedEmpList[c].isContractor&&(emptype="Contractor"):emptype="Employee",inactive=a.formattedEmpList[c].inactive?"Terminated":"Active",a.formattedEmpList[c].type=emptype,a.formattedEmpList[c].inactive=inactive}},a.truncateurl=function(){for(var b=0;b<a.employeeList.length;b++)if(null!=a.employeeList[b].thumbUrl&&""!=a.employeeList[b].thumbUrl){var c=a.employeeList[b].thumbUrl.split("/");if(8==c.length){for(var d="/",e=5;e<c.length;e++)d+=c[e],e!=c.length-1&&(d+="/");a.employeeList[b].thumbUrl=d}}},a.storeManagerNames=function(){a.managers=[],angular.forEach(a.employeeList,function(b){if(!b.deleted&&!b.isInactive)if(null!=b.firstName&&null!=b.lastName){var c=b.firstName+" "+b.lastName;a.managers.push({name:c,id:b.id})}else if(null!=b.lastName){var c=b.lastName;a.managers.push({name:c,id:b.id})}}),b.managerList=a.managers},a.downloadTable=function(){a.isDowloadClicked=!0},a.enableButtons=function(){g(function(){a.enableEmpButtons=!1},500)};var j=function(){null==b.localCache.empList?(console.log("In request call"),d.get("/api/employeeList").success(function(c){a.employeeList=c.data,b.localCache.empList=a.employeeList,a.truncateurl(),a.storeManagerNames(),a.tableOptions.listData=a.employeeList,b.getTime=i.postTimeStamp(),a.enableButtons()}).error(function(){console.log("No data found for employee list"),a.enableButtons()})):(console.log("In else part"),null!=b.localCache.empList&&1==b.localCache.isEmpAPINeeded?(console.log("In timestamp"),d.get("/api/employeeList?timestamp="+b.getTime+"&deleted=true").success(function(c){if(b.getTime=i.postTimeStamp(),"create"==b.selectedEmpType){console.log("In create");for(var d=0;d<c.data.length;d++)b.localCache.empList.push(c.data[d]),a.employeeList=b.localCache.empList}else for(var e=0;e<c.data.length;e++)for(var d=0;d<b.localCache.empList.length;d++)b.localCache.empList[d].id==c.data[e].id&&(c.data[e].deleted?(b.localCache.empList.splice(d,1),a.employeeList=b.localCache.empList):(b.localCache.empList[d]=c.data[e],a.employeeList=b.localCache.empList));b.selectedEmpType=null,a.truncateurl(),a.storeManagerNames(),a.tableOptions.listData=b.localCache.empList,a.enableButtons()}).error(function(c,d){304==d&&(a.employeeList=b.localCache.empList,a.tableOptions.listData=a.employeeList)}),b.localCache.isEmpAPINeeded=!1,a.enableButtons()):(a.employeeList=b.localCache.empList,a.tableOptions.listData=a.employeeList,a.enableButtons()))};j()}]),angular.module("redPandaApp").controller("customerController",["$scope","$rootScope","$location","$http","$filter","$modal","$cookieStore","$timeout","CurrentTimeStamp",function(a,b,c,d,e,f,g,h,i){b.manage=!0,b.selectedMenu="Customer",a.totalServerItems=0,a.maxSize=3,a.isDowloadClicked=!1,a.orderByField="",a.reverseSort=!0,a.selectedData=[],a.displayWarning=!1,a.alerts=[],$(".simplecolorpicker").hide(),a.previousSortIndex="",a.sortInfo={fields:["","","","","","",""],directions:[""]},a.formattedCustomerList=[],a.isJsonFormattingNeeded=!0,b.closeAlert(),b.calledFromEmployeeDetail=!1,b.calledFromContractDetail=!1,a.enableCustButtons=!0,b.calledFromCustomerDetail?b.calledFromCustomerDetail=!1:b.searchData=!1,a.filterOptions={filterText:"",useExternalFilter:!1},a.pagingOptions={pageSizes:[1,10,25,50,100],pageSize:10,currentPage:1},a.navigateToDetail=function(a){b.fromCustomer=!1,null!=a?g.put("detailId",a.entity.id):g.put("detailId","create"),b.selectedEmpType=g.get("detailId"),c.path("/CustomerDetail")},a.formatJSONforDownload=function(){null!=a.customerList&&(a.formattedCustomerList=angular.copy(a.customerList))},a.enableCustomerButtons=function(){h(function(){a.enableCustButtons=!1},500)},a.tableOptions={listData:null,selectedItems:a.selectedData,rowTemplate:'<div ng-dblclick="navigateToDetail(row)" ng-style="{ \'cursor\': row.cursor }" ng-repeat="col in renderedColumns" ng-class="col.colIndex()" class="ngCell {{col.cellClass}}"><div class="ngVerticalBar" ng-style="{height: rowHeight}" ng-class="{ ngVerticalBarVisible: !$last }">&nbsp;</div><div ng-cell></div></div>',useExternalSorting:!0,rowHeight:50,sortInfo:a.sortInfo,filterOptions:a.filterOptions,pageOptions:a.pagingOptions,columnDefs:[{field:"customerId",displayName:"ID",width:"20%"},{field:"customerName",displayName:"Name",width:"20%"},{field:"customerAddress",displayName:"Address",width:"40%"},{field:"",displayName:"",width:"18%",sortable:!1,cellTemplate:'<div class="customer-icons-container ngCellText text-center"><button class="btn" ng-class="{\'label-success\':row.entity.commentsExist,\'label-grey\':!row.entity.commentsExist}" style="margin-right:5px;"><i class="fa fa-comment"></i></button><button class="btn" ng-class="{\'label-info\':row.entity.attachmentsExist,\'label-grey\':!row.entity.attachmentsExist}"> <i class="fa fa-folder-open"></i> </button></div>'}]};var j=function(){null==b.localCache.customerList?d.get("/api/customerList").success(function(c){b.getTime=i.postTimeStamp(),a.customerList=c.data,b.localCache.customerList=a.customerList,a.tableOptions.listData=a.customerList,a.enableCustomerButtons()}).error(function(){console.log("No data found for customer list"),a.enableCustomerButtons()}):(console.log("In else part"),1==b.localCache.isCustomerAPINeeded?(console.log("In timestamp"),d.get("/api/customerList?timestamp="+b.getTime+"&deleted=true").success(function(c){if(b.getTime=i.postTimeStamp(),"create"==b.selectedEmpType){console.log("In create");for(var d=0;d<c.data.length;d++)b.localCache.customerList.push(c.data[d]),a.customerList=b.localCache.customerList}else for(var e=0;e<c.data.length;e++)for(var d=0;d<b.localCache.customerList.length;d++)b.localCache.customerList[d].id==c.data[e].id&&(c.data[e].deleted?(b.localCache.customerList.splice(d,1),a.customerList=b.localCache.customerList):(b.localCache.customerList[d]=c.data[e],a.customerList=b.localCache.customerList));b.selectedEmpType=null,a.tableOptions.listData=b.localCache.customerList,a.enableCustomerButtons()}).error(function(c,d){304==d&&(a.customerList=b.localCache.customerList,a.tableOptions.listData=a.customerList)}),b.localCache.isEmpAPINeeded=!1):(a.customerList=b.localCache.customerList,a.tableOptions.listData=a.customerList,a.enableCustomerButtons()))};j(),a.generateReport=function(){a.isDowloadClicked=!0},a.confirmDelete=function(){if(a.selectedData.length>0){a.closeAlert(),a.displayWarning=!1;var c=(a.selectedData[0].customerId,a.selectedData[0].id),d=a.selectedData[0].customerName;b.showModal("/api/delete/customer/"+c+"?timestamp="+i.postTimeStamp(),"Confirm Delete","Are you sure you would like to delete "+d+"? This action can not be undone.","Cancel","Confirm"),a.$watch("isPostSuccess",function(c,d){null!=c&&c!=d&&(b.isPostSuccess?(b.localCache.isCustomerAPINeeded=!0,j(),b.localCache.isFindCustomerAPINeeded=!0,a.selectedData.length=0):a.addAlert("Failed to delete. ","danger","Error"),b.isPostSuccess=null)})}else a.addAlert("Please select a customer.","warning","Warning")},a.addAlert=function(b,c,d){a.alerts=[],a.alerts.push({message:b,type:c,header:d})},a.closeAlert=function(){a.alerts=[]}}]),angular.module("redPandaApp").controller("ContractController",["$scope","$rootScope","$location","$http","$filter","$modal","$cookieStore","$timeout","CurrentTimeStamp","FilterDeleted","USDateFormat",function(a,b,c,d,e,f,g,h,i,j,k){b.manage=!0,b.selectedMenu="Contract",a.totalServerItems=0,a.maxSize=3,a.isDowloadClicked=!1,a.orderByField="",a.reverseSort=!0,a.selectedData=[],a.previousSortIndex="",a.formattedContractList=[],b.closeAlert(),g.remove("contractId");var l=[];$(".daterangepicker").hide(),b.calledFromEmployeeDetail=!1,b.calledFromCustomerDetail=!1,a.enableContButtons=!0,b.calledFromContractDetail?b.calledFromContractDetail=!1:b.searchData=!1,a.isJsonFormattingNeeded=!0,a.sortInfo={fields:["","","","",""],directions:[""]},a.filterOptions={filterText:"",useExternalFilter:!1},a.pagingOptions={pageSizes:[1,10,25,50,100],pageSize:10,currentPage:1},a.navigateToDetail=function(a){b.fromCustomer=!1,null!=a?g.put("detailId",a.entity.id):g.put("detailId","create"),b.selectedContractItem=g.get("detailId"),b.closeAlert(),c.path("/ContractDetail")},a.formatJSONforDownload=function(){null!=a.ContractList&&(a.formattedContractList=angular.copy(a.tableOptions.listData))},a.setCurrency=function(b){return null!=b?null!=b.currency?(angular.forEach(a.currencies,function(a){b.currency==a.code&&(b.currency=null!=a.symbol&&""!=a.symbol?a.symbol:a.code)}),b.currency):"$":void 0},a.tableOptions={listData:null,selectedItems:a.selectedData,rowTemplate:'<div ng-dblclick="navigateToDetail(row)" ng-style="{ \'cursor\': row.cursor }" ng-repeat="col in renderedColumns" ng-class="col.colIndex()" class="ngCell {{col.cellClass}}"><div class="ngVerticalBar" ng-style="{height: rowHeight}" ng-class="{ ngVerticalBarVisible: !$last }">&nbsp;</div><div ng-cell></div></div>',useExternalSorting:!0,rowHeight:50,sortInfo:a.sortInfo,filterOptions:a.filterOptions,pageOptions:a.pagingOptions,columnDefs:[{field:"customerName",displayName:"Customer",width:"15%"},{field:"poNumber",displayName:"PO",width:"12%"},{field:"title",displayName:"Description",width:"20%"},{field:"",displayName:"Duration",width:"18%",sortable:!1,cellTemplate:'<div class = "ngCellText"  style="height:50px"><span ng-bind = "row.entity.startDate"></span>-<span ng-bind = "row.entity.endDate"></span></div>'},{field:"value",displayName:"Value",cellTemplate:'<div class = "ngCellText" style="display:inline-block;width:75%;text-align:right;height:50px;line-height:40px;"> <span ng-bind="setCurrency(row.entity)"></span><span ng-bind = "row.entity.value"></span> </div>',sortable:!0,width:"10%"},{field:"managerName",displayName:"Manager",width:"10%"},{field:"",displayName:"",sortable:!1,width:"13%",cellTemplate:'<div class="ngCellText contract-icons-container"><button class="btn" ng-class="{\'label-success\':row.entity.commentsExist,\'label-grey\':!row.entity.commentsExist}" style="margin-right:5px;"><i class="fa fa-comment"></i></button><button class="btn" ng-class="{\'label-info\':row.entity.attachmentsExist,\'label-grey\':!row.entity.attachmentsExist}"> <i class="fa fa-folder-open"></i> </button></div>'}]},a.convertDatetoUSFormat=function(){for(var b=0;b<a.ContractList.length;b++)null!=a.ContractList[b].startDate&&(a.ContractList[b].startDate=k.convert(a.ContractList[b].startDate,!0)),null!=a.ContractList[b].endDate&&(a.ContractList[b].endDate=k.convert(a.ContractList[b].endDate,!0))},a.enableContractbuttons=function(){h(function(){a.enableContButtons=!1},500)};var m=function(){null==b.localCache.ContractList?(d.get("/api/contractList").success(function(c){a.ContractList=c.data,b.localCache.ContractList=a.ContractList,a.convertDatetoUSFormat(),l=j.filter(a.ContractList),angular.forEach(l,function(a){null!=a.value&&(a.value=Number(a.value).toFixed(2))}),a.tableOptions.listData=l,b.getTime=i.postTimeStamp(),a.enableContractbuttons()}).error(function(){console.log("No data found for the contract list"),a.enableContractbuttons()}),a.tableOptions.listData=l,b.localCache.ContractList=a.ContractList):(console.log("In else part"),1==b.localCache.isContractAPINeeded?(console.log("In timestamp"),d.get("/api/contractList?timestamp="+b.getTime+"&deleted=true").success(function(c){if(b.getTime=i.postTimeStamp(),"create"==b.selectedContractItem){console.log("In create");for(var d=0;d<c.data.length;d++)b.localCache.ContractList.push(c.data[d]),a.ContractList=b.localCache.ContractList}else for(var e=0;e<c.data.length;e++)for(var d=0;d<b.localCache.ContractList.length;d++)b.localCache.ContractList[d].id==c.data[e].id&&(c.data[e].deleted?(b.localCache.ContractList.splice(d,1),a.ContractList=b.localCache.ContractList):(b.localCache.ContractList[d]=c.data[e],a.ContractList=b.localCache.ContractList));b.selectedContractItem=null,b.localCache.ContractList=a.ContractList,a.convertDatetoUSFormat(),l=j.filter(a.ContractList),angular.forEach(l,function(a){null!=a.value&&(a.value=Number(a.value).toFixed(2))}),a.tableOptions.listData=l,a.enableContractbuttons()}).error(function(c,d){304==d&&(a.ContractList=b.localCache.ContractList,a.tableOptions.listData=a.ContractList),a.enableContractbuttons()}),b.localCache.isContractAPINeeded=!1):(a.ContractList=b.localCache.ContractList,a.tableOptions.listData=a.ContractList,a.enableContractbuttons()))};null==b.localCache.currencies?d.get("/api/listData/currencies").success(function(c){a.currencies=c.data,b.localCache.currencies=a.currencies,m()}).error(function(){console.log("No data found for the contract currencies")}):(a.currencies=b.localCache.currencies,m()),a.downloadTable=function(){a.isDowloadClicked=!0},a.confirmDelete=function(){a.selectedData.length>0?(a.closeAlert(),b.showModal("/api/delete/contract/"+a.selectedData[0].id+"?timestamp="+i.postTimeStamp(),"Confirm Delete","Are you sure you would like to delete "+a.selectedData[0].title+"? This action can not be undone.","Cancel","Confirm"),a.$watch("isPostSuccess",function(c,d){null!=c&&c!=d&&(b.isPostSuccess?(b.localCache.isContractAPINeeded=!0,m(),a.selectedData.length=0):b.addAlert("Failed to delete. ","danger","Error"),b.isPostSuccess=null)})):b.addAlert("Please select a Contract.","warning","Warning")}}]),angular.module("redPandaApp").controller("contractDetailController",["$scope","$rootScope","$modal","$http","$location","$cookieStore","CurrentTimeStamp","IsoDateFormat","USDateFormat","$window","$timeout","UserComments",function(a,b,c,d,e,f,g,h,i,j,k,l){j.scrollTo(0,0),b.manage=!0,b.selectedMenu="Contract",a.ClonedcontractDetail={},a.ClonedcontractDetail.data={},a.UploadDocumentsOptionVisible=!0,a.attachmentsContainerVisible=!1,a.displayUpload=!0,a.disableDelete=!1,a.isError=!1,a.isUpdateError=!1,b.calledFromContractDetail=!0,a.activitiesTableData=[],a.invoicemethods=[{value:"activity",description:"T&M - Activity Pricing"},{value:"person",description:"T&M - Person Pricing"},{value:"fixed",description:"Fixed Fee"}],a.personHourlyRate=[],a.activeHourlyRate=[],a.mileStone=[],a.peopleMangers=[],a.ActivitiesStartDate=[],a.ActivitiesEndDate=[],b.managerName=[],b.selectedManager=[],b.alerts=[],a.nickNameList=[],b.ClonedSelectedManager=[],a.peopleMangerscheckbox=[],a.customerContractObj={id:"",title:"",poNumber:"",startDate:"",endDate:"",value:"",currency:"",customerId:"",customerName:"",commentsExist:!1,attachmentsExist:!1,deleted:!1,managerName:""},a.cookContractId="";a.customerID=f.get("detailId");var m,n="";a.employeeName=[],a.fixedFeeAmount=[],a.fixedFeeCurrency=[],a.activityDuration=[],a.rateCurrency=[],a.clonedPeopleData=[],a.clonedActivityData=[],a.commentText="",b.deleteCustomerContract=!1,a.disabledSave=!1,a.detailComments={},"create"==f.get("contractId")?(f.put("detailId","create"),a.cookContractId=f.get("contractId"),f.remove("contractId")):null!=f.get("contractId")?(m=f.get("detailId"),a.cookContractId=f.get("contractId"),f.put("detailId",a.cookContractId),f.remove("contractId")):a.cookContractId="",a.getEmployeeId=function(b,c){angular.forEach(a.nickNames,function(d){b.entity.employeeName==d.name&&(a.peopleMangers[c].employeeId=d.id)
})},a.$watch("currencySymbol",function(b,c){if(console.log(b),null!=b&&b!=c&&b!=c){for(var d=0;d<a.activitiesTableData.length;d++)a.activitiesTableData[d].feeCur=a.currencySymbol,a.activitiesTableData[d].rateCur=a.currencySymbol;for(var d=0;d<a.peopleMangers.length;d++)a.peopleMangers[d].rateCur=a.currencySymbol}}),null==f.get("detailId")&&e.path("/Contract");var o='<div class="ngHeaderSortColumn {{col.headerClass}}" ng-style="{\'cursor\': col.cursor}" ng-class="{ \'ngSorted\': !noSortVisible }"><div ng-click="col.sort($event)" ng-class="\'colt\' + col.index" class="ngHeaderText" style="text-align:center;">{{col.displayName}} <button class="btn btn-default btn-sm" ng-click="addRow(peopleMangers,\'people\');"><i class="fa fa-plus"></i></button></div><div class="ngSortButtonDown" ng-show="col.showSortButtonDown()"></div><div class="ngSortButtonUp" ng-show="col.showSortButtonUp()"></div><div class="ngSortPriority">{{col.sortPriority}}</div><div ng-class="{ ngPinnedIcon: col.pinned, ngUnPinnedIcon: !col.pinned }" ng-click="togglePin(col)" ng-show="col.pinnable"></div></div><div ng-show="col.resizable" class="ngHeaderGrip" ng-click="col.gripClick($event)" ng-mousedown="col.gripOnMouseDown($event)"></div>',p='<div class="ngHeaderSortColumn {{col.headerClass}}" ng-style="{\'cursor\': col.cursor}" ng-class="{ \'ngSorted\': !noSortVisible }"><div ng-click="col.sort($event)" ng-class="\'colt\' + col.index" class="ngHeaderText" style="text-align:center;">{{col.displayName}} <button class="btn btn-default btn-sm" ng-click="addRow(activitiesTableData,\'activity\')"><i class="fa fa-plus"></i></button></div><div class="ngSortButtonDown" ng-show="col.showSortButtonDown()"></div><div class="ngSortButtonUp" ng-show="col.showSortButtonUp()"></div><div class="ngSortPriority">{{col.sortPriority}}</div><div ng-class="{ ngPinnedIcon: col.pinned, ngUnPinnedIcon: !col.pinned }" ng-click="togglePin(col)" ng-show="col.pinnable"></div></div><div ng-show="col.resizable" class="ngHeaderGrip" ng-click="col.gripClick($event)" ng-mousedown="col.gripOnMouseDown($event)"></div>';a.activitiesTableOptions={data:"activitiesTableData",multiSelect:!1,enableSorting:!1,tabIndex:0,noTabInterference:!1,rowHeight:40,headerRowHeight:40,columnDefs:[{field:"title",displayName:"Activity",width:"20%",cellTemplate:'<div class="ngCellText text-center"><span ng-show ="row.rowIndex === 0"><input type="text" class="form-control inputtext" placeholder ="description" ng-model="row.entity.title" /></span><span ng-show ="row.rowIndex > 0"><input type="text" class="form-control inputtext"  ng-model="row.entity.title" /></span></div>'},{field:"",displayName:"Duration",width:"25%",cellTemplate:'<div class="ngCellText cell-container"><p class="input-group from-date mini-input"><span class="input-group-addon"><i class="fa fa-calendar"></i></span><input  class="form-control"  type="text" style="background-color: white;cursor: pointer;width: 190px;" value = "{{activityDuration[row.rowIndex]}}" id ="start_{{row.rowIndex}}" ng-keyup ="clearActivityDate(row.rowIndex)"  ng-focus="initiateDatePicker(row,row.rowIndex)" /></p></div>'},{field:"isBillable",displayName:"Billable",width:"10%",cellTemplate:'<div class="ngCellText cell-container" style="padding: 12px 0px 0px 20px !important;"><input type="checkbox" ng-model="row.entity.isBillable" /></div>'},{field:"rateAmt",displayName:"Hourly Rate",width:"19%",cellTemplate:'<div class="ngCellText cell-container"><div class="input-group"><span class="input-group-addon" ng-bind ="row.entity.rateCur"></span><input type="text" hourly-Rate  placeholder="Rate"  class="form-control inputtext right_justify" ng-model="row.entity.rateAmt" ng-disabled="contractDetail.data.type != invoicemethods[0].value"/></div></div>'},{field:"feeAmt",displayName:"Fixed Fee",width:"18%",cellTemplate:'<div class="ngCellText cell-container"><div class="input-group"><span class="input-group-addon" ng-bind ="row.entity.feeCur"></span><input type="text" hourly-Rate placeholder="Fixed Fee" class="form-control inputtext right_justify" ng-model="row.entity.feeAmt" ng-disabled="contractDetail.data.type != invoicemethods[2].value"/></div></div>'},{field:"",displayName:"",width:"8%",headerCellTemplate:p,cellTemplate:'<div class="ngCellText button-container-align text-center"><button class="btn btn-default btn-sm" ng-click="deleteActivity(row,row.rowIndex,activitiesTableData)"><i class="fa fa-times"></i></button></div>'}]},a.peopleTableOptions={data:"peopleMangers",multiSelect:!1,enableSorting:!1,rowHeight:40,headerRowHeight:40,tabIndex:0,noTabInterference:!1,columnDefs:[{field:"employeeName",displayName:"Name",width:"38%",cellTemplate:'<div class="ngCellText text-center"><div ng-show="row.entity.employeeName" style ="text-align:left;text-indent:0px;">{{row.entity.employeeName}}</div><select ng-hide="row.entity.employeeName"  ng-options="value.name as value.name  for value in nickNames" ng-change = "getEmployeeId(row,row.rowIndex)" ng-model ="row.entity.employeeName" class ="form-control inputAddon" > <option value="">-- Select --</option></select></div>'},{field:"manager",displayName:"Manager",width:"19%",cellTemplate:'<div class="ngCellText text-center" style="padding: 12px 0px 0px 20px !important;text-align:left;text-indent:0px;"><input ng-model="peopleMangerscheckbox[row.rowIndex]" ng-click ="deselectOthers(row.rowIndex)" type="checkbox"></div>'},{field:"rateAmt",displayName:"Hourly Rate",width:"35%",cellTemplate:'<div class="ngCellText text-center"><div class="input-group"><span class="input-group-addon" ng-bind ="row.entity.rateCur"></span><input type="text" class="form-control mini-input right_justify" hourly-Rate  placeholder="Rate" ng-model="row.entity.rateAmt" ng-disabled="contractDetail.data.type != invoicemethods[1].value"/></div></div>'},{field:"",displayName:"",width:"8%",headerCellTemplate:o,cellTemplate:'<div class="ngCellText button-container-align text-center"><button class="btn btn-default btn-sm" ng-click="deleteSelectedRow(row.rowIndex,peopleMangers)"><i class="fa fa-times"></i></button></div>'}]},a.initiateDatePicker=function(b,c){null!=a.activitiesTableData[c].start?(b.entity.start=a.activitiesTableData[c].start,a.startrange=b.entity.start):(a.startrange=moment().format("MM/DD/YY"),b.entity.start=a.startrange,a.activitiesTableData[c].start=b.entity.start),null!=a.activitiesTableData[c].end?(b.entity.end=a.activitiesTableData[c].end,a.endrange=b.entity.end):(a.endrange=moment(moment().month()+1+"/"+(moment().date()+1)+"/"+moment().year()).format("MM/DD/YY"),b.entity.end=a.endrange,a.activitiesTableData[c].end=a.endrange);var d="#start_"+c;$(d).daterangepicker({format:"MM/DD/YY",opens:"left",startDate:a.startrange,endDate:a.endrange},function(){var e=$(d).val(),f=e.split("-")[0],g=e.split("-")[1];a.activitiesTableData[c].start=f,a.activitiesTableData[c].end=g,b.entity.start=f,b.entity.end=g})},a.convertDateActivities=function(){for(var b=0;b<a.contractDetail.data.activityData.length;b++){var c="";null!=a.contractDetail.data.activityData[b].start&&(c+=i.convert(a.contractDetail.data.activityData[b].start,!0),a.contractDetail.data.activityData[b].start=i.convert(a.contractDetail.data.activityData[b].start,!0)),null!=a.contractDetail.data.activityData[b].end&&(c+="-"+i.convert(a.contractDetail.data.activityData[b].end,!0),a.contractDetail.data.activityData[b].end=i.convert(a.contractDetail.data.activityData[b].end,!0)),a.activityDuration[b]=c}},a.setDollar=function(a){return null==a&&(a="USD"),a},a.deleteSelectedRow=function(a,b){b.splice(a,1)},a.enableContDetailButtons=function(){k(function(){a.enableContDetailButtons=!1},500)},a.deleteActivity=function(c,d,e){b.deleteIndex=d;var f="";null!=c.entity.activityId&&(f=c.entity.activityId),null!=c.entity.id&&(f=c.entity.id),""!=f?(b.showModal("/api/delete/activity/"+f+"?timestamp="+g.postTimeStamp(),"Confirm Delete","Are you sure you would like to delete ? This action can not be undone.","Cancel","Confirm"),a.$watch("isPostSuccess",function(a,c){null!=a&&a!=c&&(b.isPostSuccess?e.splice(b.deleteIndex,1):b.addAlert("Delete Failed.","danger"),b.isPostSuccess=null)})):e.splice(b.deleteIndex,1)},a.$watch("shiftNav",function(b,c){b!=c&&(a.tableRebuild(a.peopleTableOptions),a.tableRebuild(a.activitiesTableOptions))},!0),a.tableRebuild=function(a){a.$gridServices.DomUtilityService.RebuildGrid(a.$gridScope,a.ngGrid)},a.addRow=function(b,c){var d;"people"==c?(b.push({rateCur:a.currencySymbol,rateAmt:"0.00",isBlocked:!1}),d=a.peopleTableOptions):(b.push({title:"",isBillable:!1,isFixedFee:!1,rateAmt:"0.00",feeAmt:"0.00",feeCur:a.currencySymbol,rateCur:a.currencySymbol}),d=a.activitiesTableOptions)},a.deselectOthers=function(b){for(var c=0;c<a.peopleMangers.length;c++)a.peopleMangerscheckbox[c]=!1;a.peopleMangerscheckbox[b]=!0,a.contractDetail.data.managerName=a.peopleMangers[b].employeeName},a.convertToUSDateFormat=function(){var b="";null!=a.contractDetail.data.startDate?(a.startDateRange=i.convert(a.contractDetail.data.startDate,!0),b+=i.convert(a.contractDetail.data.startDate,!0)):(a.startDateRange=moment().format("MM/DD/YY"),a.contractDetail.data.startDate=h.convert(a.startDateRange)),null!=a.contractDetail.data.endDate?(a.endDateRange=i.convert(a.contractDetail.data.endDate,!0),b+="-"+i.convert(a.contractDetail.data.endDate,!0)):(a.endDateRange=moment(moment().month()+1+"/"+(moment().date()+1)+"/"+moment().year()).format("MM/DD/YY"),a.contractDetail.data.endDate=h.convert(a.endDateRange)),$("#dateRange").val(b),$("#dateRange").daterangepicker({format:"MM/DD/YY",opens:"left",startDate:a.startDateRange,endDate:a.endDateRange},function(){var b=$("#dateRange").val(),c=b.split("-")[0],d=b.split("-")[1];a.contractDetail.data.startDate=h.convert(c),a.contractDetail.data.endDate=h.convert(d)})},a.getCurrencySymbol=function(){null!=a.currencies&&angular.forEach(a.currencies,function(b){a.contractDetail.data.currency==b.code&&(a.contractDetail.data.currency=b.code,a.currencySymbol=null!=b.symbol&&""!=b.symbol?b.symbol:b.code,a.currencyCode=b.code)})},a.initializeCurrencies=function(){null!=a.contractDetail&&null!=a.contractDetail.data&&(null==a.contractDetail.data.currency?(a.contractDetail.data.currency="USD",a.currencySymbol="$",a.currencyCode="USD"):null!=a.currencies&&angular.forEach(a.currencies,function(b){a.contractDetail.data.currency==b.code&&(a.contractDetail.data.currency=b.code,a.currencySymbol=null!=b.symbol&&""!=b.symbol?b.symbol:b.code,a.currencyCode=b.code)}))},null==b.localCache.currencies?d.get("/api/listData/currencies").success(function(c){a.currencies=c.data,b.localCache.currencies=a.currencies,a.initializeCurrencies()}).error(function(){console.log("No data found for currencies list")}):(a.currencies=b.localCache.currencies,a.initializeCurrencies());var q=function(){null!=a.contractDetail.data.managerId&&(console.log(a.contractDetail.data.managerName,a.contractDetail.data.managerId),""!=a.contractDetail.data.managerId&&angular.forEach(a.nickNames,function(b){a.contractDetail.data.managerId==b.id&&(a.contractDetail.data.managerName=b.name)}))},r=function(){null==b.localCache.managers?d.get("/api/employeeList").success(function(c){a.employeeList=c.data,a.managers=[],angular.forEach(a.employeeList,function(b){if(!b.deleted&&!b.isInactive)if(null!=b.firstName&&null!=b.lastName){var c=b.firstName+" "+b.lastName;a.managers.push({name:c,id:b.id})}else if(null!=b.lastName){var c=b.lastName;a.managers.push({name:c,id:b.id})}}),a.managerList=a.managers,b.localCache.managers=a.managerList,b.peopleTableData=a.managerList,a.nickNames=a.managers,"create"!=f.get("detailId")&&q()}).error(function(){b.addAlert("Manager List is not available","danger")}):(a.managerList=b.localCache.managers,b.peopleTableData=a.managerList,a.nickNames=b.localCache.managers,"create"!=f.get("detailId")&&q())};"create"==f.get("detailId")?(a.contractDetail={success:!0,total:1,data:{title:"",type:"",comments:[]}},a.isNew=!0,a.initializeCurrencies(),null==a.contractDetail.data.assignedData&&(a.contractDetail.data.assignedData=[]),null==a.contractDetail.data.activityData&&(a.contractDetail.data.activityData=[]),angular.copy(a.contractDetail,a.ClonedcontractDetail,!0),a.convertToUSDateFormat(),a.contractDetail.data.activityData.push({title:"",isBillable:!1,isFixedFee:!1,rateAmt:"0.00",feeAmt:"0.00",feeCur:a.currencySymbol,rateCur:a.currencySymbol}),a.contractDetail.data.assignedData.push({rateCur:a.currencySymbol,rateAmt:"0.00",employeeName:""}),a.ClonedcontractDetail.data.assignedData.push({rateCur:a.currencySymbol,rateAmt:"0.00",employeeName:""}),a.currencyCode="USD",a.activitiesTableData=a.contractDetail.data.activityData,a.peopleMangers=a.contractDetail.data.assignedData,a.detailComments=a.contractDetail.data,a.contractDetail.data.type=a.invoicemethods[2].value,r(),b.fromCustomer&&(a.contractDetail.data.customerName=b.customerName,a.contractDetail.data.customerId=b.currentCustomerId,b.calledFromContractDetail=!1),a.enableContDetailButtons()):null!=f.get("detailId")&&d.get("/api/contractDetail/"+f.get("detailId")).success(function(c){if(a.contractDetail=c,a.isError=!1,a.disableDelete=!1,a.disabledSave=!1,null!=a.contractDetail.data.value&&(a.contractDetail.data.value=a.contractDetail.data.value.toFixed(2)),null!=a.contractDetail.data.budgetedHours&&(a.contractDetail.data.budgetedHours=a.contractDetail.data.budgetedHours.toFixed(2)),null==a.contractDetail.data.assignedData&&(a.contractDetail.data.assignedData=[]),null==a.contractDetail.data.activityData&&(a.contractDetail.data.activityData=[]),r(),a.contractDetail.data.comments=l.formatInputData(a.contractDetail.data.comments),a.detailComments=a.contractDetail.data,angular.copy(a.contractDetail,a.ClonedcontractDetail,!0),null!=a.ClonedcontractDetail.data.assignedData&&0===a.ClonedcontractDetail.data.assignedData.length&&a.ClonedcontractDetail.data.assignedData.push({employeeName:""}),a.convertToUSDateFormat(),null!=a.contractDetail.data.activityData&&a.convertDateActivities(),null!=a.contractDetail.data.managerName&&(a.managerName[0]=a.contractDetail.data.managerName,a.peopleMangerscheckbox[0]=!0),null==a.contractDetail.data.type&&(a.contractDetail.data.type=a.invoicemethods[2].value),a.initializeCurrencies(),b.fromCustomer&&(a.contractDetail.data.customerName=b.customerName,a.contractDetail.data.customerId=b.currentCustomerId,b.calledFromContractDetail=!1),null!=a.contractDetail.data.type&&"fixed"==a.contractDetail.data.type)for(var d=0;d<a.contractDetail.data.activityData.length;d++)a.fixedFeeAmount[d]=a.contractDetail.data.activityData[d].rateAmt,a.contractDetail.data.activityData[d].rateAmt="",a.fixedFeeCurrency[d]=a.contractDetail.data.activityData[d].rateCur,a.contractDetail.data.activityData[d].rateCur="";for(var d=0;d<a.contractDetail.data.assignedData.length;d++)a.contractDetail.data.assignedData[d].rateAmt=a.contractDetail.data.assignedData[d].rateAmt.toFixed(2);null!=a.contractDetail.data.type&&(("activity"==a.contractDetail.data.type||"fixed"==a.contractDetail.data.type)&&0==a.contractDetail.data.activityData.length&&a.contractDetail.data.activityData.push({title:"",isBillable:!1,isFixedFee:!1,rateAmt:"0.00",feeAmt:"0.00",feeCur:a.currencySymbol,rateCur:a.currencySymbol}),"person"==a.contractDetail.data.type&&0==a.contractDetail.data.assignedData.length&&a.contractDetail.data.assignedData.push({rateCur:a.currencySymbol,rateAmt:0})),angular.forEach(a.contractDetail.data.activityData,function(a){null!=a.rateAmt&&(a.rateAmt=Number(a.rateAmt).toFixed(2)),null!=a.feeAmt&&(a.feeAmt=Number(a.feeAmt).toFixed(2))}),angular.forEach(a.contractDetail.data.assignedData,function(a){null!=a.rateAmt&&(a.rateAmt=Number(a.rateAmt).toFixed(2))}),null!=a.contractDetail.data.managerName&&null!=a.contractDetail.data.assignedData&&(0==a.contractDetail.data.assignedData.length&&(a.contractDetail.data.assignedData=[{employeeName:""}]),a.contractDetail.data.assignedData[0].employeeName=a.contractDetail.data.managerName),a.activitiesTableData=a.contractDetail.data.activityData,a.peopleMangers=a.contractDetail.data.assignedData,a.enableContDetailButtons()}).error(function(){a.isError=!0,a.disabledSave=!0,"/ContractDetail"==e.path()&&b.addAlert("No contract details available.","danger"),a.enableContDetailButtons()}),null==b.localCache.customers||b.localCache.isFindCustomerAPINeeded?d.get("/api/customerList").success(function(c){a.customerList=c.data,b.localCache.customers=a.customerList,b.localCache.isFindCustomerAPINeeded=!1}).error(function(){b.addAlert("Customer List is not available","danger")}):a.customerList=b.localCache.customers,a.setPeopleData=function(){if(1==a.peopleMangers.length)a.peopleMangers[0].employeeName=a.contractDetail.data.managerName,a.peopleMangerscheckbox[0]=!0;else{for(var b=!1,c=0;c<a.peopleMangers.length;c++)a.peopleMangerscheckbox[c]=!1,a.peopleMangers[c].employeeName==a.contractDetail.data.managerName&&(a.peopleMangerscheckbox[c]=!0,b=!0);if(!b){var d="";angular.forEach(a.nickNames,function(b){a.contractDetail.data.managerName==b.name&&(d=b.id)}),a.peopleMangers.push({employeeName:"",rateAmt:"0.00",employeeId:d,rateCur:a.currencySymbol}),a.peopleMangers[a.peopleMangers.length-1].employeeName=a.contractDetail.data.managerName,a.peopleMangerscheckbox[a.peopleMangers.length-1]=!0}}},a.setCurrencySymbol=function(b){null!=b?(a.currencySymbol=null!=b.symbol&&""!=b.symbol?b.symbol:b.code,a.currencyCode=b.code,a.contractDetail.data.currency=b.code):(a.currencySymbol="$",a.contractDetail.data.currency="USD",a.currencyCode="USD");for(var c=0;c<a.activitiesTableData.length;c++)a.activitiesTableData[c].rateCur=a.contractDetail.data.currency,a.fixedFeeCurrency[c]=a.contractDetail.data.currency},a.hidecurrencyDropdown=function(){$(".currencyDropdown").removeClass("open")},a.formatPostData=function(){angular.forEach(a.customerList,function(b){b.customerName==a.contractDetail.data.customerName&&(a.contractDetail.data.customerId=b.id)}),angular.forEach(a.managerList,function(b){b.name==a.contractDetail.data.managerName&&(a.contractDetail.data.managerId=b.id)}),null==a.contractDetail.data.value?null!=a.contractDetail.data.currency&&delete a.contractDetail.data.currency:a.contractDetail.data.value=parseFloat(a.contractDetail.data.value),null!=a.contractDetail.data.budgetedHours&&(a.contractDetail.data.budgetedHours=parseFloat(a.contractDetail.data.budgetedHours)),a.contractDetail.data.comments=l.filterPostData(a.contractDetail.data.comments),console.log("Format comments data",a.contractDetail.data.comments)};var s=function(){a.filterPeopleList=[],a.filterActivityList=[];for(var b=0;b<a.peopleMangers.length;b++)(""!=a.peopleMangers[b].rateAmt||null!=a.peopleMangers[b].rateAmt)&&(a.peopleMangers[b].rateAmt=parseFloat(a.peopleMangers[b].rateAmt));angular.forEach(a.peopleMangers,function(b){""!=b.employeeName&&null!=b.employeeName&&angular.forEach(a.nickNames,function(a){b.employeeName==a.name&&(b.employeeId=a.id)})});for(var b=0;b<a.peopleMangers.length;b++)null!=a.peopleMangers[b].employeeId&&""!=a.peopleMangers[b].employeeId&&a.filterPeopleList.push(a.peopleMangers[b]);for(var b=0;b<a.activitiesTableData.length;b++)null!=a.activitiesTableData[b].title&&""!=a.activitiesTableData[b].title&&(console.log("Date value in the post"),console.log($("#start_"+b).val()),$("#start_"+b).val()?(a.activitiesTableData[b].start=$("#start_"+b).val().split("-")[0],a.activitiesTableData[b].end=$("#start_"+b).val().split("-")[1],a.activitiesTableData[b].start=h.convert(a.activitiesTableData[b].start),a.activitiesTableData[b].end=h.convert(a.activitiesTableData[b].end),console.log("After"),console.log(a.activitiesTableData[b].start,a.activitiesTableData[b].end)):(delete a.activitiesTableData[b].start,delete a.activitiesTableData[b].end),a.filterActivityList.push(a.activitiesTableData[b]));angular.forEach(a.filterPeopleList,function(b){b.rateCur=a.currencyCode,("fixed"==a.contractDetail.data.type||"activity"==a.contractDetail.data.type)&&(delete b.rateCur,b.rateAmt=0)}),angular.forEach(a.filterActivityList,function(b){b.rateCur=a.currencyCode,b.feeCur=a.currencyCode,b.feeAmt=parseFloat(b.feeAmt),b.rateAmt=parseFloat(b.rateAmt),b.isFixedFee=!1,"fixed"==a.contractDetail.data.type&&(b.isFixedFee=!0,delete b.rateCur,b.rateAmt=0),"activity"==a.contractDetail.data.type&&(delete b.feeCur,b.feeAmt=0),"person"==a.contractDetail.data.type&&(delete b.feeCur,b.feeAmt=0,delete b.rateCur,b.rateAmt=0)})};a.backtocontract=function(){return a.isError||a.isUpdateError?(b.localCache.isContractAPINeeded=!1,b.closeAlert(),void(a.cookContractId?(f.put("detailId",a.customerID),e.path("/CustomerDetail")):e.path("/Contract"))):(b.localCache.isContractAPINeeded=!1,b.closeAlert(),void(a.cookContractId?(f.put("detailId",a.customerID),e.path("/CustomerDetail")):e.path("/Contract")))};var t=function(b){return a.customerContractObj.id=b.id,a.customerContractObj.title=b.title,a.customerContractObj.poNumber=b.poNumber,null!=b.value&&(b.value=Number(b.value).toFixed(2)),null!=b.startDate&&""!=b.startDate&&(a.customerContractObj.startDate=i.convert(b.startDate,!0)),null!=b.endDate&&""!=b.endDate&&(a.customerContractObj.endDate=i.convert(b.endDate,!0)),a.customerContractObj.value=b.value,a.customerContractObj.customerId=b.customerId,a.customerContractObj.customerName=b.customerName,a.customerContractObj.commentsExist=!1,a.customerContractObj.attachmentsExist=!1,a.customerContractObj.deleted=!1,a.customerContractObj.currency=b.currency,a.customerContractObj.managerName=b.managerName,a.customerContractObj};a.clearDate=function(){$("#dateRange").val(""),$("#dateRange").daterangepicker({format:"MM/DD/YY",opens:"left"},function(){var b=$("#dateRange").val(),c=b.split("-")[0],d=b.split("-")[1];a.contractDetail.data.startDate=h.convert(c),a.contractDetail.data.endDate=h.convert(d)})},a.clearActivityDate=function(b){$("#start_"+b).val(""),$("#start_"+b).daterangepicker({format:"MM/DD/YY",opens:"left"},function(){var c=$("#start_"+b).val(),d=c.split("-")[0],e=c.split("-")[1];a.activitiesTableData[b].start=h.convert(d),a.activitiesTableData[b].end=h.convert(e),row.entity.start=h.convert(d),row.entity.end=h.convert(e)})},a.reformatData=function(){for(var b=0;b<a.activitiesTableData.length;b++)a.activitiesTableData[b].rateCur=a.currencySymbol,a.activitiesTableData[b].feeCur=a.currencySymbol,$("#start_"+b).val()&&(a.activitiesTableData[b].start=i.convert($("#start_"+b).val().split("-")[0],!0),a.activitiesTableData[b].end=i.convert($("#start_"+b).val().split("-")[1],!0));for(var b=0;b<a.peopleMangers.length;b++)a.peopleMangers[b].rateCur=a.currencySymbol;$("#dateRange").val()&&(a.contractDetail.data.startDate=h.convert($("#dateRange").val().split("-")[0]),a.contractDetail.data.endDate=h.convert($("#dateRange").val().split("-")[1])),console.log("After Reformat"),console.log(a.activitiesTableData),console.log(a.peopleMangers),console.log(a.contractDetail.data.startDate),console.log(a.contractDetail.data.endDate)},a.savecontractData=function(){if(""==a.contractDetail.data.title||null==a.contractDetail.data.title)return b.addAlert("You must enter a description for the contract to be saved.","danger"),void(a.isUpdateError=!0);if(a.inSave=!0,null!=a.contractDetail.data.value&&0==a.contractDetail.data.value&&null!=a.contractDetail.data.currency&&delete a.contractDetail.data.currency,console.log($("#dateRange").val()),""==$("#dateRange").val()&&(delete a.contractDetail.data.endDate,delete a.contractDetail.data.startDate),s(),a.needToSave=!1,angular.forEach(a.contractDetail.data,function(b,c){if("managerName"!=c){if("assignedData"==c&&null!=a.contractDetail.data.assignedData)for(var d=0;d<a.contractDetail.data.assignedData.length;d++)null!=a.contractDetail.data.assignedData[d].employeeName&&delete a.contractDetail.data.assignedData[d].employeeName,null!=a.ClonedcontractDetail.data.assignedData&&"object"==typeof a.ClonedcontractDetail.data.assignedData[d]&&null!=a.ClonedcontractDetail.data.assignedData[d].employeeName&&delete a.ClonedcontractDetail.data.assignedData[d].employeeName;console.log(c),console.log(b,a.ClonedcontractDetail.data[c]),angular.equals(b,a.ClonedcontractDetail.data[c])||(a.needToSave=!0)}}),a.needToSave){b.closeAlert(),a.formatPostData(),"NaN-NaN-NaN"==a.contractDetail.data.startDate&&delete a.contractDetail.data.startDate,"NaN-NaN-NaN"==a.contractDetail.data.endDate&&delete a.contractDetail.data.endDate;var c=a.contractDetail.data,h=g.postTimeStamp();a.disabledSave=!0,a.contractDetail.data.activityData=a.filterActivityList,a.contractDetail.data.assignedData=a.filterPeopleList,d({method:"post",url:"/api/contractDetail/update?timestamp="+h,data:c,headers:{"content-type":"application/json"}}).success(function(c){"/ContractDetail"==e.path()&&b.addAlert("Updated successfully","success"),a.contractDetail=c,b.localCache.isContractAPINeeded=!0,angular.copy(a.contractDetail,a.ClonedcontractDetail,!0),"create"==f.get("detailId")&&(void 0==c.data.id||f.put("detailId",c.data.id)),a.inSave=!1,a.isError=!1,n=k(function(){if(a.cookContractId){if(f.put("detailId",a.customerID),"create"==a.cookContractId){var c={};c=t(a.contractDetail.data),null==b.cutomerContractCopy.data.contractList&&(b.cutomerContractCopy.data.contractList=[]),null==b.cutomerContractCopy.data.contractIds&&(b.cutomerContractCopy.data.contractIds=[]),b.cutomerContractCopy.data.contractList.push(c),b.cutomerContractCopy.data.contractIds.push(c.id)}else{var c={};c=t(a.contractDetail.data),b.cutomerContractCopy.data.contractList[b.rowIndex]=c,b.cutomerContractCopy.data.contractIds[b.rowIndex]=c.id}e.path("/CustomerDetail")}else e.path("/Contract")},1e3)}).error(function(){"/ContractDetail"==e.path()&&b.addAlert("Update failed","danger"),a.disabledSave=!0,a.isUpdateError=!0,a.reformatData()})}else a.reformatData()},a.confirmDelete=function(){b.showModal("/api/delete/contract/"+f.get("detailId")+"?timestamp="+g.postTimeStamp(),"Confirm Delete","Are you sure you would like to delete "+a.contractDetail.data.title+"? This action can not be undone.","Cancel","Confirm"),a.$watch("isPostSuccess",function(c,d){null!=c&&c!=d&&(b.isPostSuccess?a.cookContractId?(f.put("detailId",a.customerID),b.deleteCustomerContract=!0,e.path("/CustomerDetail")):(b.localCache.isContractAPINeeded=!0,e.path("/Contract")):b.addAlert("Delete Failed.","danger"),b.isPostSuccess=null)})},a.showUploadContainer=function(){a.UploadDocumentsOptionVisible=!1,a.attachmentsContainerVisible=!0},a.hideUploadContainer=function(){a.UploadDocumentsOptionVisible=!0,a.attachmentsContainerVisible=!1},a.inSave=!1,a.$watch("contractDetail",function(b,c){a.inSave||b!=c&&(angular.equals(a.ClonedcontractDetail,a.contractDetail)||(a.disabledSave=!1))},!0),a.stackedProgress=function(){a.stacked=[];var b=0,c=0,d=0;valArray=[b,c,d];for(var e=["success","warning","danger"],f=0;f<e.length;f++)a.stacked.push({value:valArray[f],type:e[f]})},a.stackedProgress(),a.$on("$destroy",function(){k.cancel(n)})}]),angular.module("redPandaApp").controller("employeeDetailController",["$scope","$rootScope","$modal","$http","$location","$cookieStore","$filter","$window","CurrentTimeStamp","$timeout","fileReader","USDateFormat","IsoDateFormat","UserComments",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){h.scrollTo(0,0),b.manage=!0,b.selectedMenu="Employee",a.ClonedEmployeeDetail={},b.calledFromEmployeeDetail=!0,a.timeOff=[],a.UploadDocumentsOptionVisible=!0,a.attachmentsContainerVisible=!1,a.minDate=a.minDate?null:new Date,a.alerts=[],a.showEmptyContactDetail=!1,a.defaultContactType="",a.isError=!1,a.needFormat=!0,a.mapOptions={},a.needMapCall={callMap:!1},a.enableEmpDetailButtons=!0,a.inCreateMode=!1,a.addressKeys=["addressStreet","addressCity","addressStateCode","addressPostZip","addressCountryISO"],a.contactTypeValue=[],a.contactTypeDetails=[];var o="";if(a.isHireDateSetinServer=!1,a.isTermDateSetinServer=!1,a.isUpdateError=!1,a.commentText="",a.commentLocalStoreage=[],a.isFilterEnabled=!0,a.detailComments={},a.createModeImage="",a.disableFilter=function(){a.isFilterEnabled=!1},$("#hireDate").on("keydown",function(b){return 13==b.which?(a.isempstartEmpty=""==$("#hireDate").val()?!0:!1,b.stopPropagation(),b.preventDefault(),!1):void 0}).datepicker({dateFormat:"mm-dd-y",onSelect:function(){var b=$(this).datepicker("getDate");b&&b.setDate(b.getDate()+1),a.disabledSave=!1,$("#endDate").datepicker("option","minDate",b)}}),$("#endDate").on("keydown",function(b){return 13==b.which?(a.isempendEmpty=""==$("#endDate").val()?!0:!1,b.stopPropagation(),b.preventDefault(),!1):void 0}).datepicker({dateFormat:"mm-dd-y",onSelect:function(){var b=$(this).datepicker("getDate");b&&b.setDate(b.getDate()-1),a.disabledSave=!1,$("#hireDate").datepicker("option","maxDate",b||0)}}),a.isEnterKey=function(b,c){13==b.keyCode&&(c?($("#endDate").focus(),a.isempstartEmpty&&$("#hireDate").val("")):($("#hireDate").focus(),a.isempendEmpty&&$("#endDate").val("")))},a.EnableDetailButtons=function(){j(function(){a.enableEmpDetailButtons=!1},500)},null!=b.managerList?a.ManagerList=b.managerList:d.get("/api/employeeList").success(function(c){a.employeeList=c.data,a.managers=[],angular.forEach(a.employeeList,function(b){if(!b.deleted&&!b.isInactive)if(null!=b.firstName&&null!=b.lastName){var c=b.firstName+" "+b.lastName;a.managers.push({name:c,id:b.id})}else if(null!=b.lastName){var c=b.lastName;a.managers.push({name:c,id:b.id})}}),b.managerList=a.managers,a.ManagerList=b.managerList}).error(function(){console.log("Manager list not available")}),null==f.get("detailId")&&e.path("/Employee"),a.truncateurl=function(){if(null!=a.EmployeeDetail.data.photoUrl&&""!=a.EmployeeDetail.data.photoUrl){var b=a.EmployeeDetail.data.photoUrl.split("/");if(8==b.length){for(var c="/",d=5;d<b.length;d++)c+=b[d],d!=b.length-1&&(c+="/");a.EmployeeDetail.data.photoUrl=c}}},a.formatMapData=function(){null!=a.EmployeeDetail&&null!=a.EmployeeDetail.data.addressCountryISO&&null!=a.countries&&angular.forEach(a.countries,function(b){b.code==a.EmployeeDetail.data.addressCountryISO&&(a.EmployeeDetail.data.addressCountryISO=b)}),null!=a.EmployeeDetail&&null!=a.EmployeeDetail.data.addressStateCode&&null!=a.states&&angular.forEach(a.states,function(b){b.code==a.EmployeeDetail.data.addressStateCode&&(a.EmployeeDetail.data.addressStateCode=b)}),null!=a.EmployeeDetail&&(null!=a.EmployeeDetail.data.hireDate&&""!=a.EmployeeDetail.data.hireDate?(a.isHireDateSetinServer=!0,a.EmployeeDetail.data.hireDate=l.convert(a.EmployeeDetail.data.hireDate),a.tempStartDate=a.EmployeeDetail.data.hireDate):a.tempStartDate="",null!=a.EmployeeDetail.data.termDate&&""!=a.EmployeeDetail.data.termDate?(a.isTermDateSetinServer=!0,a.EmployeeDetail.data.termDate=l.convert(a.EmployeeDetail.data.termDate),a.tempEndDate=a.EmployeeDetail.data.termDate):a.tempEndDate="")},a.formatInputData=function(){if(null!=a.EmployeeDetail&&null!=a.EmployeeDetail.data.contactNumbers)for(var b=(a.EmployeeDetail.data.contactNumbers.length,0);b<a.EmployeeDetail.data.contactNumbers.length;b++)a.contactTypeDetails[b]=a.EmployeeDetail.data.contactNumbers[b].details,a.contactTypeValue[b]=a.EmployeeDetail.data.contactNumbers[b].type},a.formatCostamt=function(){""!=a.EmployeeDetail.data.otCostAmt&&null!=a.EmployeeDetail.data.otCostAmt&&(a.EmployeeDetail.data.otCostAmt=Number(a.EmployeeDetail.data.otCostAmt).toFixed(2))},a.formatStdamt=function(){""!=a.EmployeeDetail.data.stdCostAmt&&null!=a.EmployeeDetail.data.stdCostAmt&&(a.EmployeeDetail.data.stdCostAmt=Number(a.EmployeeDetail.data.stdCostAmt).toFixed(2))},null==b.localCache.states?d.get("/api/listData/states").success(function(c){a.states=c.data,b.localCache.states=a.states,a.formatInputData(),a.formatMapData()}).error(function(){console.log("No data found for states"),a.state_namesJson={success:!0,total:1,data:[{name:"Alabama",code:"AL"},{name:"Alaska",code:"AK"},{name:"Arizona",code:"AZ"},{name:"Arkansas",code:"AR"},{name:"California",code:"CA"},{name:"Colorado",code:"CO"},{name:"Connecticut",code:"CT"},{name:"Delaware",code:"DE"},{name:"District of Columbia",code:"DC"},{name:"Florida",code:"FL"},{name:"Georgia",code:"GA"},{name:"Hawaii",code:"HI"},{name:"Idaho",code:"ID"},{name:"Illinois",code:"IL"},{name:"Indiana",code:"IN"},{name:"Iowa",code:"IA"},{name:"Kansa",code:"KS"},{name:"Kentucky",code:"KY"},{name:"Lousiana",code:"LA"},{name:"Maine",code:"ME"},{name:"Maryland",code:"MD"},{name:"Massachusetts",code:"MA"},{name:"Michigan",code:"MI"},{name:"Minnesota",code:"MN"},{name:"Mississippi",code:"MS"},{name:"Missouri",code:"MO"},{name:"Montana",code:"MT"},{name:"Nebraska",code:"NE"},{name:"Nevada",code:"NV"},{name:"New Hampshire",code:"NH"},{name:"New Jersey",code:"NJ"},{name:"New Mexico",code:"NM"},{name:"New York",code:"NY"},{name:"North Carolina",code:"NC"},{name:"North Dakota",code:"ND"},{name:"Ohio",code:"OH"},{name:"Oklahoma",code:"OK"},{name:"Oregon",code:"OR"},{name:"Pennsylvania",code:"PA"},{name:"Rhode Island",code:"RI"},{name:"South Carolina",code:"SC"},{name:"South Dakota",code:"SD"},{name:"Tennessee",code:"TN"},{name:"Texas",code:"TX"},{name:"Utah",code:"UT"},{name:"Vermont",code:"VT"},{name:"Virginia",code:"VA"},{name:"Washington",code:"WA"},{name:"West Virginia",code:"WV"},{name:"Wisconsin",code:"WI"},{name:"Wyoming",code:"WY"}]},a.states=a.state_namesJson.data,b.localCache.states=a.states,a.formatInputData()
}):(a.states=b.localCache.states,a.formatInputData(),a.formatMapData()),null==b.localCache.countries?d.get("/api/listData/countries").success(function(c){a.countries=c.data,b.localCache.countries=a.countries,a.formatInputData(),a.formatMapData()}).error(function(){console.log("No data found for countries"),a.countriesJson={success:!0,total:1,data:[{name:"Ascension Island",code:"AC"},{name:"Andorra",code:"AD"},{name:"United Arab Emirates",code:"AE"},{name:"Afghanistan",code:"AF"},{name:"Antigua And Barbuda",code:"AG"},{name:"Anguilla",code:"AI"},{name:"Albania",code:"AL"},{name:"Armenia",code:"AM"},{name:"Angola",code:"AO"},{name:"Antarctica",code:"AQ"},{name:"Argentina",code:"AR"},{name:"American Samoa",code:"AS"},{name:"Austria",code:"AT"},{name:"Australia",code:"AU"},{name:"Aruba",code:"AW"},{name:"Azerbaijan",code:"AZ"},{name:"Bosnia & Herzegovina",code:"BA"},{name:"Barbados",code:"BB"},{name:"Bangladesh",code:"BD"},{name:"Belgium",code:"BE"},{name:"Burkina Faso",code:"BF"},{name:"Bulgaria",code:"BG"},{name:"Bahrain",code:"BH"},{name:"Burundi",code:"BI"},{name:"Benin",code:"BJ"},{name:"Bermuda",code:"BM"},{name:"Brunei Darussalam",code:"BN"},{name:"Bolivia, Plurinational State Of",code:"BO"},{name:"Afghanistan",code:"AF"},{name:"Antigua And Barbuda",code:"AG"},{name:"Anguilla",code:"AI"},{name:"Albania",code:"AL"},{name:"Armenia",code:"AM"},{name:"Angola",code:"AO"},{name:"Antarctica",code:"AQ"},{name:"Argentina",code:"AR"},{name:"American Samoa",code:"AS"},{name:"Austria",code:"AT"},{name:"Australia",code:"AU"},{name:"Aruba",code:"AW"},{name:"Azerbaijan",code:"AZ"},{name:"Bosnia & Herzegovina",code:"BA"},{name:"Barbados",code:"BB"},{name:"Bangladesh",code:"BD"},{name:"Belgium",code:"BE"},{name:"Burkina Faso",code:"BF"},{name:"Bulgaria",code:"BG"},{name:"Bahrain",code:"BH"},{name:"Burundi",code:"BI"},{name:"Benin",code:"BJ"},{name:"Bermuda",code:"BM"},{name:"Brunei Darussalam",code:"BN"},{name:"Bolivia, Plurinational State Of",code:"BO"},{name:"Bonaire, Saint Eustatius And Saba",code:"BQ"},{name:"Brazil",code:"BR"},{name:"Bahamas",code:"BS"},{name:"Bhutan",code:"BT"},{name:"Bouvet Island",code:"BV"},{name:"Botswana",code:"BW"},{name:"Belarus",code:"BY"},{name:"Belize",code:"BZ"},{name:"Canada",code:"CA"},{name:"Cocos (Keeling) Islands",code:"CC"},{name:"Democratic Republic Of Congo",code:"CD"},{name:"Central African Republic",code:"CF"},{name:"Republic Of Congo",code:"CG"},{name:"Switzerland",code:"CH"},{name:"Cote d'Ivoire",code:"CI"},{name:"Cook Islands",code:"CK"},{name:"Chile",code:"CL"},{name:"Cameroon",code:"CM"},{name:"China",code:"CN"},{name:"Colombia",code:"CO"},{name:"Clipperton Island",code:"CP"},{name:"Costa Rica",code:"CR"},{name:"Cuba",code:"CU"},{name:"Cape Verde",code:"CV"},{name:"Curacao",code:"CW"},{name:"Christmas Island",code:"CX"},{name:"Cyprus",code:"CY"},{name:"Czech Republic",code:"CZ"},{name:"Germany",code:"DE"},{name:"Diego Garcia",code:"DG"},{name:"Djibouti",code:"DJ"},{name:"Denmark",code:"DK"},{name:"Dominica",code:"DM"},{name:"Dominican Republic",code:"DO"},{name:"Algeria",code:"DZ"},{name:"Ceuta, Mulilla",code:"EA"},{name:"Ecuador",code:"EC"},{name:"Estonia",code:"EE"},{name:"Egypt",code:"EG"},{name:"Western Sahara",code:"EH"},{name:"Eritrea",code:"ER"},{name:"Spain",code:"ES"},{name:"Ethiopia",code:"ET"},{name:"European Union",code:"EU"},{name:"Finland",code:"FI"},{name:"Fiji",code:"FJ"},{name:"Falkland Islands",code:"FK"},{name:"Micronesia, Federated States Of",code:"FM"},{name:"Faroe Islands",code:"FO"},{name:"France",code:"FR"},{name:"France, Metropolitan",code:"FX"},{name:"Gabon",code:"GA"},{name:"United Kingdom",code:"GB"},{name:"Grenada",code:"GD"},{name:"Georgia",code:"GE"},{name:"French Guiana",code:"GF"},{name:"Guernsey",code:"GG"},{name:"Ghana",code:"GH"},{name:"Gibraltar",code:"GI"},{name:"Greenland",code:"GL"},{name:"Gambia",code:"GM"},{name:"Great Britain",code:"GB"},{name:"Guinea",code:"GN"},{name:"Guadeloupe",code:"GP"},{name:"Equatorial Guinea",code:"GQ"},{name:"Greece",code:"GR"},{name:"South Georgia And The South Sandwich Islands",code:"GS"},{name:"Guatemala",code:"GT"},{name:"Guam",code:"GU"},{name:"Guinea-bissau",code:"GW"},{name:"Guyana",code:"GY"},{name:"Hong Kong",code:"HK"},{name:"Heard Island And McDonald Islands",code:"HM"},{name:"Honduras",code:"HN"},{name:"Croatia",code:"HR"},{name:"Haiti",code:"HT"},{name:"Hungary",code:"HU"},{name:"Canary Islands",code:"IC"},{name:"Indonesia",code:"ID"},{name:"Ireland",code:"IE"},{name:"Israel",code:"IL"},{name:"Isle Of Man",code:"IM"},{name:"India",code:"IN"},{name:"British Indian Ocean Territory",code:"IO"},{name:"Iraq",code:"IQ"},{name:"Iran, Islamic Republic Of",code:"IR"},{name:"Iceland",code:"IS"},{name:"Italy",code:"IT"},{name:"Jersey",code:"JE"},{name:"Jamaica",code:"JM"},{name:"Jordan",code:"JO"},{name:"Japan",code:"JP"},{name:"Kenya",code:"KE"},{name:"Kyrgyzstan",code:"KG"},{name:"Cambodia",code:"KH"},{name:"Kiribati",code:"KI"},{name:"Comoros",code:"KM"},{name:"Saint Kitts And Nevis",code:"KN"},{name:"Korea, Democratic People's Republic Of",code:"KP"},{name:"Korea, Republic Of",code:"KR"},{name:"Kuwait",code:"KW"},{name:"Cayman Islands",code:"KY"},{name:"Kazakhstan",code:"KZ"},{name:"Lao People's Democratic Republic",code:"LA"},{name:"Lebanon",code:"LB"},{name:"Saint Lucia",code:"LC"},{name:"Liechtenstein",code:"LI"},{name:"Sri Lanka",code:"LK"},{name:"Liberia",code:"LR"},{name:"Lesotho",code:"LS"},{name:"Lithuania",code:"LT"},{name:"Luxembourg",code:"LU"},{name:"Latvia",code:"LV"},{name:"Libya",code:"LY"},{name:"Morocco",code:"MA"},{name:"Monaco",code:"MC"},{name:"Moldova",code:"MD"},{name:"Montenegro",code:"ME"},{name:"Saint Martin",code:"MF"},{name:"Madagascar",code:"MG"},{name:"Marshall Islands",code:"MH"},{name:"Macedonia, The Former Yugoslav Republic Of",code:"MK"},{name:"Mali",code:"ML"},{name:"Myanmar",code:"MM"},{name:"Mongolia",code:"MN"},{name:"Macao",code:"MO"},{name:"Northern Mariana Islands",code:"MP"},{name:"Martinique",code:"MQ"},{name:"Mauritania",code:"MR"},{name:"Montserrat",code:"MS"},{name:"Malta",code:"MT"},{name:"Mauritius",code:"MU"},{name:"Maldives",code:"MV"},{name:"Malawi",code:"MW"},{name:"Mexico",code:"MX"},{name:"Malaysia",code:"MY"},{name:"Mozambique",code:"MZ"},{name:"Namibia",code:"NA"},{name:"New Caledonia",code:"NC"},{name:"Niger",code:"NE"},{name:"Norfolk Island",code:"NF"},{name:"Nigeria",code:"NG"},{name:"Nicaragua",code:"NI"},{name:"Netherlands",code:"NL"},{name:"Norway",code:"NO"},{name:"Nepal",code:"NP"},{name:"Nauru",code:"NR"},{name:"Niue",code:"NU"},{name:"New Zealand",code:"NZ"},{name:"Oman",code:"OM"},{name:"Panama",code:"PA"},{name:"Peru",code:"PE"},{name:"French Polynesia",code:"PF"},{name:"Papua New Guinea",code:"PG"},{name:"Philippines",code:"PH"},{name:"Pakistan",code:"PK"},{name:"Poland",code:"PL"},{name:"Saint Pierre And Miquelon",code:"PM"},{name:"Pitcairn",code:"PN"},{name:"Puerto Rico",code:"PR"},{name:"Palestinian Territory, Occupied",code:"PS"},{name:"Portugal",code:"PT"},{name:"Palau",code:"PW"},{name:"Paraguay",code:"PY"},{name:"Qatar",code:"QA"},{name:"Reunion",code:"RE"},{name:"Romania",code:"RO"},{name:"Serbia",code:"RS"},{name:"Russian Federation",code:"RU"},{name:"Rwanda",code:"RW"},{name:"Saudi Arabia",code:"SA"},{name:"Solomon Islands",code:"SB"},{name:"Seychelles",code:"SC"},{name:"Sudan",code:"SD"},{name:"Sweden",code:"SE"},{name:"Singapore",code:"SG"},{name:"Saint Helena, Ascension And Tristan Da Cunha",code:"SH"},{name:"Slovenia",code:"SI"},{name:"Svalbard And Jan Mayen",code:"SJ"},{name:"Slovakia",code:"SK"},{name:"Sierra Leone",code:"SL"},{name:"San Marino",code:"SM"},{name:"Senegal",code:"SN"},{name:"Somalia",code:"SO"},{name:"Suriname",code:"SR"},{name:"South Sudan",code:"SS"},{name:"So Tom and Pr_ncipe",code:"ST"},{name:"USSR",code:"SU"},{name:"El Salvador",code:"SV"},{name:"Sint Maarten",code:"SX"},{name:"Syrian Arab Republic",code:"SY"},{name:"Swaziland",code:"SZ"},{name:"Tristan de Cunha",code:"TA"},{name:"Turks And Caicos Islands",code:"TC"},{name:"Chad",code:"TD"},{name:"French Southern Territories",code:"TF"},{name:"Togo",code:"TG"},{name:"Thailand",code:"TH"},{name:"Tajikistan",code:"TJ"},{name:"Tokelau",code:"TK"},{name:"East Timor",code:"TL"},{name:"Turkmenistan",code:"TM"},{name:"Tunisia",code:"TN"},{name:"Tonga",code:"TO"},{name:"Turkey",code:"TR"},{name:"Trinidad And Tobago",code:"TT"},{name:"Tuvalu",code:"TV"},{name:"Taiwan, Province Of China",code:"TW"},{name:"Tanzania, United Republic Of",code:"TZ"},{name:"Ukraine",code:"UA"},{name:"Uganda",code:"UG"},{name:"United Kingdom",code:"GB"},{name:"United States Minor Outlying Islands",code:"UM"},{name:"United States",code:"US"},{name:"Uruguay",code:"UY"},{name:"Uzbekistan",code:"UZ"},{name:"Vatican City State",code:"VA"},{name:"Saint Vincent And The Grenadines",code:"VC"},{name:"Venezuela, Bolivarian Republic Of",code:"VE"},{name:"Virgin Islands (British)",code:"VG"},{name:"Virgin Islands (US)",code:"VI"},{name:"Viet Nam",code:"VN"},{name:"Vanuatu",code:"VU"},{name:"Wallis And Futuna",code:"WF"},{name:"Samoa",code:"WS"},{name:"Yemen",code:"YE"},{name:"Mayotte",code:"YT"},{name:"South Africa",code:"ZA"},{name:"Zambia",code:"ZM"},{name:"Zimbabwe",code:"ZW"}]},a.countries=a.countriesJson.data,b.localCache.countries=a.countries,a.formatInputData()}):(a.countries=b.localCache.countries,a.formatInputData(),a.formatMapData()),a.successCalls=function(){console.log(a.EmployeeDetail),a.truncateurl(),a.mapOptions=a.EmployeeDetail,a.needMapCall.callMap=!0,(null==a.EmployeeDetail.data.contactNumbers||0===a.EmployeeDetail.data.contactNumbers.length)&&(a.EmployeeDetail.data.contactNumbers=[]),(null==a.EmployeeDetail.data.timeOff||0==a.EmployeeDetail.data.timeOff.length)&&(a.EmployeeDetail.data.timeOff=[{type:"Vacation",allowance:0,taken:0},{type:"Sick",allowance:0,taken:0}]);for(var b=0;b<a.EmployeeDetail.data.timeOff.length;b++)a.timeOff.push({type:a.EmployeeDetail.data.timeOff[b].type,allowance:a.EmployeeDetail.data.timeOff[b].allowance,taken:a.EmployeeDetail.data.timeOff[b].taken,balance:a.EmployeeDetail.data.timeOff[b].allowance-a.EmployeeDetail.data.timeOff[b].taken});a.formatCostamt(),a.formatStdamt(),a.formatInputData(),a.EmployeeDetail.data.stdCostCur="USD",a.EmployeeDetail.data.otCostCur="USD",a.EmployeeDetail.data.comments=n.formatInputData(a.EmployeeDetail.data.comments),a.detailComments=a.EmployeeDetail.data,a.formatMapData(),angular.copy(a.EmployeeDetail,a.ClonedEmployeeDetail,!0),0===a.EmployeeDetail.data.contactNumbers.length&&(a.EmployeeDetail.data.contactNumbers=[],a.EmployeeDetail.data.contactNumbers.push({}),a.contactTypeValue[0]="email",a.contactTypeDetails[0]=""),a.isError=!1},"create"==f.get("detailId")){a.EmployeeDetail={success:!0,total:0,data:{employeeNumber:"",firstName:"",lastName:"",fullName:"",nickName:"",isPartTime:!1,isContractor:!1,departmentId:"",job:"",comments:[],timeOff:[]}},a.showEmptyContactDetail=!0,(null==a.EmployeeDetail.data.contactNumbers||0===a.EmployeeDetail.data.contactNumbers.length)&&(a.EmployeeDetail.data.contactNumbers=[],a.EmployeeDetail.data.contactNumbers.push({}),a.contactTypeValue[0]="email",a.contactTypeDetails[0]=""),(null==a.EmployeeDetail.data.timeOff||0==a.EmployeeDetail.data.timeOff.length)&&(a.EmployeeDetail.data.timeOff=[{type:"Vacation",allowance:0,taken:0},{type:"Sick",allowance:0,taken:0}]);for(var p=0;p<a.EmployeeDetail.data.timeOff.length;p++)a.timeOff.push({type:a.EmployeeDetail.data.timeOff[p].type,allowance:a.EmployeeDetail.data.timeOff[p].allowance,taken:a.EmployeeDetail.data.timeOff[p].taken,balance:a.EmployeeDetail.data.timeOff[p].allowance-a.EmployeeDetail.data.timeOff[p].taken});a.mapOptions=a.EmployeeDetail,angular.copy(a.EmployeeDetail,a.ClonedEmployeeDetail,!0),a.inCreateMode=!0,a.detailComments=a.EmployeeDetail.data,a.EnableDetailButtons()}else b.empDetailCache.id!=f.get("detailId")?null!=f.get("detailId")&&d.get("/api/employeeDetail/"+f.get("detailId")).success(function(c){a.EmployeeDetail=c,b.empDetailCache.id=c.data.id,a.rootscopeobj={},angular.copy(a.EmployeeDetail,a.rootscopeobj,!0),b.empDetailCache.data=a.rootscopeobj,b.empgetTime=i.postTimeStamp(),a.successCalls(),a.EnableDetailButtons()}).error(function(){a.addAlert("Employee Detail not available.","danger"),a.isError=!0,a.EnableDetailButtons()}):b.empDetailCache.id==f.get("detailId")&&d.get("/api/employeeDetail/"+f.get("detailId")+"?timestamp="+b.empgetTime).success(function(c){a.EmployeeDetail=c,a.rootscopeobj={},angular.copy(a.EmployeeDetail,a.rootscopeobj,!0),b.empDetailCache.data=a.rootscopeobj,a.successCalls(),a.EnableDetailButtons()}).error(function(c,d){304==d&&(a.localcacheValue={},a.localcacheValuefordetail={},a.localcacheValue=b.empDetailCache.data,angular.copy(a.localcacheValue,a.localcacheValuefordetail,!0),a.EmployeeDetail=a.localcacheValuefordetail,a.successCalls()),a.EnableDetailButtons()});null==b.localCache.department?d.get("/api/find/department").success(function(c){a.departments=c.data,b.localCache.department=a.departments}).error(function(){console.log("No data found for department")}):a.departments=b.localCache.department,null==b.localCache.jobs?d.get("/api/listData/jobs").success(function(c){a.jobs=c.data,b.localCache.jobs=a.jobs}).error(function(){console.log("No data found for the jobs")}):a.jobs=b.localCache.jobs,null==b.localCache.contactNumTypes?d.get("/api/listData/contactNumberTypes").success(function(c){a.contactNumberTypes=c.data,b.localCache.contactNumTypes=a.contactNumberTypes}).error(function(){console.log("No data found for contact number types")}):a.contactNumberTypes=b.localCache.contactNumTypes,a.empTimeOffGridOptions={data:"timeOff",enableColumnResize:!0,columnDefs:[{field:"type",displayName:"",width:"20%"},{field:"",displayName:"Allowance",cellTemplate:'<label class="allowance-text right-justify" ng-bind="row.entity.allowance"></label>',width:"20%"},{field:"taken",displayName:"Taken",cellTemplate:'<label class="taken-text right-justify" ng-bind="row.entity.taken"></label>',width:"20%"},{field:"balance",displayName:"Balance",cellTemplate:'<label class="balance-text right-justify" ng-bind="row.entity.balance"></label>',width:"20%"},{dispalyName:"",cellTemplate:'<a href= "javascript:void(0);">details</a>',width:"18%"}]},a.saveContactNumbers=function(){for(var b=!1,c=0;c<a.contactTypeDetails.length;c++)if(""!=a.contactTypeValue[c]&&null!=a.contactTypeValue[c]&&""!=a.contactTypeDetails[c]&&null!=a.contactTypeDetails[c]&&"email"==a.contactTypeValue[c].toLowerCase()){var d=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(!d.test(a.contactTypeDetails[c])){b=!0;break}}if(!b){a.EmployeeDetail.data.contactNumbers=[];for(var e=-1,f=-1,g=-1,h=-1,c=0;c<a.contactTypeDetails.length;c++)""!=a.contactTypeDetails[c]&&""!=a.contactTypeValue[c]&&null!=a.contactTypeValue[c]&&null!=a.contactTypeDetails[c]&&("email"==a.contactTypeValue[c].toLowerCase()&&(e++,a.EmployeeDetail.data.contactNumbers.push({details:a.contactTypeDetails[c],seq:e,type:a.contactTypeValue[c]})),"phone"==a.contactTypeValue[c].toLowerCase()&&(f++,a.EmployeeDetail.data.contactNumbers.push({details:a.contactTypeDetails[c],seq:f,type:a.contactTypeValue[c]})),"skype"==a.contactTypeValue[c].toLowerCase()&&(h++,a.EmployeeDetail.data.contactNumbers.push({details:a.contactTypeDetails[c],seq:h,type:a.contactTypeValue[c]})),"linkedin"==a.contactTypeValue[c].toLowerCase()&&(g++,a.EmployeeDetail.data.contactNumbers.push({details:a.contactTypeDetails[c],seq:g,type:a.contactTypeValue[c]})))}return b},a.deleteEmployeeContactInfo=function(b){a.contactTypeDetails.splice(b,1),a.contactTypeValue.splice(b,1),a.EmployeeDetail.data.contactNumbers.splice(b,1),0==a.EmployeeDetail.data.contactNumbers.length&&(a.EmployeeDetail.data.contactNumbers.push({}),a.contactTypeDetails[0]="",a.contactTypeValue[0]="Phone")},a.addEmployeeContactInfo=function(){var b=a.EmployeeDetail.data.contactNumbers.length;a.EmployeeDetail.data.contactNumbers.push({}),a.contactTypeDetails[b]="",a.contactTypeValue[b]=a.contactNumberTypes[0]},a.addAlert=function(b,c){a.alerts=[],a.alerts.push({message:b,type:c}),h.scrollTo(0,0)},a.closeAlert=function(){a.alerts=[]},a.Validatetypeahead=function(b,c,d,e,f){if(null==d)return-1==b.indexOf(c)?(a.addAlert(e,f),!1):(a.closeAlert(),!0);var g=!1;return angular.forEach(b,function(a){a[d]==c&&(g=!0)}),g?(a.closeAlert(),!0):(a.addAlert(e,f),!1)},a.assignNames=function(){var b=[];switch(b=a.EmployeeDetail.data.nickName.split(" "),b.length){case 1:a.EmployeeDetail.data.lastName=a.EmployeeDetail.data.nickName;break;case 2:a.EmployeeDetail.data.lastName=b[1],a.EmployeeDetail.data.firstName=b[0];break;case 3:a.EmployeeDetail.data.lastName=b[2],a.EmployeeDetail.data.firstName=b[0];break;default:a.EmployeeDetail.data.lastName=b[b.length-1],a.EmployeeDetail.data.firstName=b[0]}},a.isImageuploaded=!1,a.getFile=function(){k.readAsDataUrl(a.file,a).then(function(b){a.imageSrc=b,$(".PersonImage").width()>120&&(a.containImg=!0),a.imageUpload(),a.disabledSave=!1})},a.backtoEmp=function(){return a.isError||a.isUpdateError?(b.localCache.isEmpAPINeeded=!1,b.closeAlert(),void e.path("/Employee")):(b.localCache.isEmpAPINeeded=!1,b.closeAlert(),void e.path("/Employee"))},a.formatPostData=function(){null!=a.EmployeeDetail.data.otCostAmt&&""!=a.EmployeeDetail.data.otCostAmt?a.EmployeeDetail.data.otCostAmt=parseFloat(a.EmployeeDetail.data.otCostAmt):null!=a.EmployeeDetail.data.otCostCur&&delete a.EmployeeDetail.data.otCostCur,null!=a.EmployeeDetail.data.stdCostAmt&&""!=a.EmployeeDetail.data.stdCostAmt?a.EmployeeDetail.data.stdCostAmt=parseFloat(a.EmployeeDetail.data.stdCostAmt):null!=a.EmployeeDetail.data.stdCostCur&&delete a.EmployeeDetail.data.stdCostCur,a.EmployeeDetail.data.fullName=a.EmployeeDetail.data.nickName,null!=a.EmployeeDetail.data.addressStateCode&&(a.EmployeeDetail.data.addressStateCode=a.EmployeeDetail.data.addressStateCode.code),null!=a.EmployeeDetail.data.addressCountryISO&&(a.EmployeeDetail.data.addressCountryISO=a.EmployeeDetail.data.addressCountryISO.code),""!=a.EmployeeDetail.data.hireDate||a.isHireDateSetinServer?""==a.EmployeeDetail.data.hireDate&&a.isHireDateSetinServer&&(a.EmployeeDetail.data.hireDate=""):delete a.EmployeeDetail.data.hireDate,""!=a.EmployeeDetail.data.termDate||a.isTermDateSetinServer?""==a.EmployeeDetail.data.termDate&&a.isTermDateSetinServer&&(a.EmployeeDetail.data.termDate=""):delete a.EmployeeDetail.data.termDate,angular.forEach(a.ManagerList,function(b){b.id==a.EmployeeDetail.data.managerId&&(a.EmployeeDetail.data.managerName=b.name)}),a.EmployeeDetail.data.comments=n.filterPostData(a.EmployeeDetail.data.comments),console.log("Format Comments",a.EmployeeDetail.data.comments)},a.imageUpload=function(){var c=new FormData;c.append("file",a.file),"create"!=f.get("detailId")&&c.append("contactId",f.get("detailId")),d.post("/api/upload/photo",c,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(c){console.log("Image Updated Successfully"),a.isImageuploaded=!1,console.log(c),a.EmployeeDetail.data.photoId=c.data.resourceId,a.EmployeeDetail.data.thumbUrl=c.data.thumbUrl,a.EmployeeDetail.data.photoUrl=c.data.contentUrl,b.localCache.isEmpAPINeeded=!0}).error(function(c,d){console.log("Imaged Update Failed"),a.addAlert("Image update failed","danger"),a.isImageuploaded=!1,a.inSave=!1,413==d&&(null!=a.addAlert&&a.addAlert("Image update failed:Image file exceeds maximum area.Please choose a file under 1MB.","danger"),b.addAlert("Image update failed:Image file exceeds maximum area.Please choose a file under 1MB.","danger"))})},a.checkDateisChanged=function(){""!=$("#hireDate").val()?a.EmployeeDetail.data.hireDate=m.convert($("#hireDate").val()):null!=a.EmployeeDetail.data.hireDate&&(a.EmployeeDetail.data.hireDate=$("#hireDate").val()),""!=$("#endDate").val()?a.EmployeeDetail.data.termDate=m.convert($("#endDate").val()):null!=a.EmployeeDetail.data.termDate&&(a.EmployeeDetail.data.termDate=$("#endDate").val())},a.dateChanged=!1,a.isDateChanged=function(){$("#hireDate").val()!=a.tempStartDate?a.dateChanged=!0:$("#endDate").val()!=a.tempEndDate&&(a.dateChanged=!0)},a.saveEmpdata=function(){console.log(a.EmployeeDetail),a.inSave=!0;if(a.saveContactNumbers())return a.addAlert("Enter valid email address.","danger"),a.inSave=!1,a.needFormat=!1,void(a.isUpdateError=!0);if(a.tempEmployeeDetail={},angular.copy(a.EmployeeDetail,a.tempEmployeeDetail,!0),null==a.tempEmployeeDetail.data.otCostAmt&&delete a.tempEmployeeDetail.data.otCostCur,a.needToSave=!1,angular.forEach(a.tempEmployeeDetail.data,function(b,c){angular.equals(b,a.ClonedEmployeeDetail.data[c])||(a.needToSave=!0)}),console.log(a.needToSave),a.needToSave||null!=a.EmployeeDetail.data.contactNumbers&&0==a.EmployeeDetail.data.contactNumbers.length&&(a.EmployeeDetail.data.contactNumbers.push({}),a.contactTypeValue[0]="email",a.contactTypeDetails[0]=""),a.isDateChanged(),a.dateChanged&&(a.needToSave=!0),a.closeAlert(),a.needToSave){if(""==a.EmployeeDetail.data.nickName)return a.addAlert("Enter Employee Name.","danger"),a.inSave=!1,a.needFormat=!1,void(a.isUpdateError=!0);if(a.assignNames(),a.closeAlert(),angular.forEach(a.departments,function(b){b.id==a.EmployeeDetail.data.departmentId&&(a.EmployeeDetail.data.departmentName=b.name)}),""!=a.EmployeeDetail.data.addressCountryISO&&null!=a.EmployeeDetail.data.addressCountryISO&&0==a.Validatetypeahead(a.countries,a.EmployeeDetail.data.addressCountryISO.name,"name","Enter a valid Country Code","danger"))return a.inSave=!1,void(a.isUpdateError=!0);if(""!=a.EmployeeDetail.data.addressStateCode&&null!=a.EmployeeDetail.data.addressStateCode&&0==a.Validatetypeahead(a.states,a.EmployeeDetail.data.addressStateCode.name,"name","Enter a valid State Code","danger"))return a.inSave=!1,void(a.isUpdateError=!0);a.needMapCall.callMap=!0,a.checkDateisChanged(),a.formatPostData(),"NaN-NaN-NaN"==a.EmployeeDetail.data.hireDate&&delete a.EmployeeDetail.data.hireDate,"NaN-NaN-NaN"==a.EmployeeDetail.data.termDate&&delete a.EmployeeDetail.data.termDate;var c=a.EmployeeDetail.data,f=i.postTimeStamp();d({method:"post",url:"/api/employeeDetail/update?timestamp="+f,data:c,headers:{"content-type":"application/json"}}).success(function(c){a.addAlert("Updated successfully","success"),a.EmployeeDetail=c,a.rootscopeobj={},angular.copy(a.EmployeeDetail,a.rootscopeobj,!0),b.empDetailCache.data=a.rootscopeobj,a.formatCostamt(),a.formatStdamt(),a.formatInputData(),a.formatMapData(),a.isImageuploaded=!1,a.inSave=!1,b.localCache.isEmpAPINeeded=!0,angular.copy(a.EmployeeDetail,a.ClonedEmployeeDetail,!0),a.inCreateMode=!1,a.disabledSave=!0,a.isError=!1,a.isUpdateError=!1,o=j(function(){e.path("/Employee")},1e3)}).error(function(){a.addAlert("Update failed","danger"),a.isImageuploaded=!1,a.inSave=!1,a.isUpdateError=!0,b.localCache.isEmpAPINeeded=!1,null!=a.EmployeeDetail.data.contactNumbers&&0==a.EmployeeDetail.data.contactNumbers.length&&(a.EmployeeDetail.data.contactNumbers.push({}),a.contactTypeValue[0]="email",a.contactTypeDetails[0]="")})}},a.confirmDelete=function(){b.showModal("/api/delete/contact/"+f.get("detailId"),"Confirm Delete","Are you sure you would like to delete "+a.EmployeeDetail.data.nickName+"? This action can not be undone.","Cancel","Confirm"),a.$watch("isPostSuccess",function(c,d){null!=c&&c!=d&&(b.isPostSuccess?(b.localCache.isEmpAPINeeded=!0,e.path("/Employee")):a.addAlert("Delete Failed.","danger"),b.isPostSuccess=null)})},a.showUploadContainer=function(){a.UploadDocumentsOptionVisible=!1,a.attachmentsContainerVisible=!0},a.hideUploadContainer=function(){a.UploadDocumentsOptionVisible=!0,a.attachmentsContainerVisible=!1},a.inSave=!1,a.$watch("EmployeeDetail",function(b,c){a.inSave||b!=c&&(angular.equals(a.ClonedEmployeeDetail,a.EmployeeDetail)||(a.disabledSave=!1))},!0),a.$watch("employeeNewContact.info",function(b,c){if(!a.inSave&&b!=c){if(""==b||null==b)return;a.disabledSave=!1}},!0),a.$on("$destroy",function(){j.cancel(o)})}]),angular.module("redPandaApp").controller("customerDetailController",["$scope","$rootScope","$modal","$http","$location","$cookieStore","$filter","$anchorScroll","CurrentTimeStamp","$timeout","FilterDeleted","USDateFormat","UserComments","$window",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){n.scrollTo(0,0),b.manage=!0,b.selectedMenu="Customer",a.companycollapseTable=!1,a.ClonedCustomerDetail={},b.copyCustomerDetails={},a.alerts=[],a.mapOptions={},a.lastUpdated=g("date")((new Date).getTime(),"yyyy-MM-dd"),a.UploadDocumentsOptionVisible=!0,a.attachmentsContainerVisible=!1,a.displayUpload=!0,a.customerHeading="",a.disableDelete=!1,a.newCustomer=!0,a.noDataAvailable=!1,a.enableCustDetButtons=!0,a.needMapCall={callMap:!1},a.addressKeys=["addressStreet","addressCity","addressStateCode","addressPostZip","addressISOCountry"],a.isError=!1,a.isUpdateError=!1,a.contractTableData=[],a.contactTableData=[],a.currentPath=e.path();var o=[],p="";a.commentText="",b.calledFromCustomerDetail=!0,b.currentCustomerId="",a.detailComments={},$('select[name="colorpicker"]').simplecolorpicker({picker:!0}),null==f.get("detailId")&&e.path("/Customer");var q='<div class="ngHeaderSortColumn {{col.headerClass}}" ng-style="{\'cursor\': col.cursor}" ng-class="{ \'ngSorted\': !noSortVisible }"><div ng-click="col.sort($event)" ng-class="\'colt\' + col.index" class="ngHeaderText" style="text-align:center;">{{col.displayName}} <button ng-click="navigateToContractDetail()" class="btn btn-default btn-sm"><i class="fa fa-plus"></i></button></div><div class="ngSortButtonDown" ng-show="col.showSortButtonDown()"></div><div class="ngSortButtonUp" ng-show="col.showSortButtonUp()"></div><div class="ngSortPriority">{{col.sortPriority}}</div><div ng-class="{ ngPinnedIcon: col.pinned, ngUnPinnedIcon: !col.pinned }" ng-click="togglePin(col)" ng-show="col.pinnable"></div></div><div ng-show="col.resizable" class="ngHeaderGrip" ng-click="col.gripClick($event)" ng-mousedown="col.gripOnMouseDown($event)"></div>',r='<div class="ngHeaderSortColumn {{col.headerClass}}" ng-style="{\'cursor\': col.cursor}" ng-class="{ \'ngSorted\': !noSortVisible }"><div ng-click="col.sort($event)" ng-class="\'colt\' + col.index" class="ngHeaderText" style="text-align:center;">{{col.displayName}} <button ng-click="openContactInfo()" class="btn btn-default btn-sm"><i class="fa fa-plus"></i></button></div><div class="ngSortButtonDown" ng-show="col.showSortButtonDown()"></div><div class="ngSortButtonUp" ng-show="col.showSortButtonUp()"></div><div class="ngSortPriority">{{col.sortPriority}}</div><div ng-class="{ ngPinnedIcon: col.pinned, ngUnPinnedIcon: !col.pinned }" ng-click="togglePin(col)" ng-show="col.pinnable"></div></div><div ng-show="col.resizable" class="ngHeaderGrip" ng-click="col.gripClick($event)" ng-mousedown="col.gripOnMouseDown($event)"></div>';a.formatInputData=function(){null!=a.CustomerDetail&&null!=a.CustomerDetail.data.addressISOCountry&&null!=a.countries&&angular.forEach(a.countries,function(b){b.code==a.CustomerDetail.data.addressISOCountry&&(a.CustomerDetail.data.addressISOCountry=b)}),null!=a.CustomerDetail&&null!=a.CustomerDetail.data.addressStateCode&&null!=a.states&&angular.forEach(a.states,function(b){b.code==a.CustomerDetail.data.addressStateCode&&(a.CustomerDetail.data.addressStateCode=b)})},a.enableCustDetailButtons=function(){j(function(){a.enableCustDetButtons=!1},500)},null==b.localCache.countries?d.get("/api/listData/countries").success(function(c){a.countries=c.data,b.localCache.countries=a.countries,a.formatInputData()}).error(function(){console.log("No data found for countries")}):(a.countries=b.localCache.countries,a.formatInputData()),null==b.localCache.states?d.get("/api/listData/states").success(function(c){a.states=c.data,b.localCache.states=a.states,a.formatInputData()}).error(function(){console.log("No data found for states")}):(a.states=b.localCache.states,a.formatInputData()),a.setCurrency=function(b){return null!=b?null!=b.currency?(angular.forEach(a.currencies,function(c){b.currency==c.code&&(null!=c.symbol&&""!=c.symbol?(b.currency=c.code,a.symbol=c.symbol):(b.currency=c.code,a.symbol=c.code))}),a.symbol):"$":void 0},a.contactTableoptions={data:"contactTableData",multiSelect:!1,headerRowHeight:40,rowHeight:45,rowTemplate:'<div ng-dblclick="openContactInfo(row,row.rowIndex)" ng-style="{ \'cursor\': row.cursor }" ng-repeat="col in renderedColumns" ng-class="col.colIndex()" class="ngCell {{col.cellClass}}"><div class="ngVerticalBar" ng-style="{height: rowHeight}" ng-class="{ ngVerticalBarVisible: !$last }">&nbsp;</div><div ng-cell></div></div>',columnDefs:[{field:"name",width:"82%",displayName:"Contacts"},{field:"",displayName:"",sortable:!1,width:"18%",cellTemplate:'<div class="ngCellText custDetail-contract-ButContaniner"><button class="btn btn-default btn-sm" ng-click="deleteContactList(row,row.rowIndex)" ><i class="fa fa-times"></i></button></div>',headerCellTemplate:r}]},a.contractTableoptions={data:"contractTableData",multiSelect:!1,enableSorting:!1,rowHeight:45,headerRowHeight:40,rowTemplate:'<div ng-dblclick="navigateToContractDetail(row,row.rowIndex)" ng-style="{ \'cursor\': row.cursor }" ng-repeat="col in renderedColumns" ng-class="col.colIndex()" class="ngCell {{col.cellClass}}"><div class="ngVerticalBar" ng-style="{height: rowHeight}" ng-class="{ ngVerticalBarVisible: !$last }">&nbsp;</div><div ng-cell></div></div>',columnDefs:[{field:"poNumber",displayName:"PO",width:"10%"},{field:"title",displayName:"Description",width:"18%"},{field:"",displayName:"Dates",width:"20%",cellTemplate:'<div class = "ngCellText" style ="height:44px;"><span ng-bind = "row.entity.startDate"></span>-<span ng-bind = "row.entity.endDate"></span></div>'},{field:"value",displayName:"Value",cellTemplate:'<div class = "ngCellText" style ="height:44px; line-height:33px; text-align:right;width:75%;display:inline-block;text-overflow:clip !important;"><span ng-bind="setCurrency(row.entity)"></span><span  ng-bind = "row.entity.value"></span> </div>',sortable:!0,width:"10%"},{field:"managerName",displayName:"Contract Manager",width:"19%"},{field:"",displayName:"",sortable:!1,width:"15%",cellTemplate:'<div class="ngCellText custDetail-contract-ButContaniner commentsButton"><button class="btn" style="margin-right:5px" ng-class="{\'label-success\':row.entity.commentsExist,\'label-grey\':!row.entity.commentsExist}"><i class="fa fa-comment"></i></button><button class="btn" ng-class="{\'label-info\':row.entity.attachmentsExist,\'label-grey\':!row.entity.attachmentsExist}"> <i class="fa fa-folder-open"></i> </button></div>'},{field:"",displayName:"",sortable:!1,width:"8%",cellTemplate:'<div class="ngCellText custDetail-contract-ButContaniner"><button class="btn btn-default btn-sm" ng-click="deleteContractList(row, row.rowIndex)" ><i class="fa fa-times"></i></button></div>',headerCellTemplate:q}]},a.deleteContractList=function(c,d){b.indexvalue=d;var e=c.entity;a.closeAlert(),b.showModal("/api/delete/contract/"+e.id+"?timestamp="+i.postTimeStamp(),"Confirm Delete","Are you sure you would like to delete "+e.title+"? This action can not be undone.","Cancel","Confirm"),a.$watch("isPostSuccess",function(c,d){null!=c&&c!=d&&(b.isPostSuccess?(a.CustomerDetail.data.contractList.splice(b.indexvalue,1),a.contractTableData=a.CustomerDetail.data.contractList):b.addAlert("Failed to delete. ","danger","Error"),b.isPostSuccess=null)})},a.$watch("shiftNav",function(b,c){b!=c&&(a.tableRebuild(a.contactTableoptions),a.tableRebuild(a.contractTableoptions))},!0),a.tableRebuild=function(a){a.$gridServices.DomUtilityService.RebuildGrid(a.$gridScope,a.ngGrid)},a.deleteContactList=function(c,d){var e=c.entity;b.indexValue=d,b.showModal("/api/delete/contact/"+e.id+"?timestamp="+i.postTimeStamp(),"Confirm Delete","Are you sure you would like to delete "+e.name+" ? This action can not be undone.","Cancel","Confirm"),a.$watch("isPostSuccess",function(c,d){null!=c&&c!=d&&(b.isPostSuccess?(a.CustomerDetail.data.contactList.splice(b.indexValue,1),a.contactTableData=a.CustomerDetail.data.contactList):console.log("Failed to delete"),b.isPostSuccess=null)
})},a.navigateToContractDetail=function(c,d){b.cutomerContractCopy={},angular.copy(a.CustomerDetail,b.cutomerContractCopy,!0),b.fromCustomer=!0,b.customerName=a.CustomerDetail.data.customerName,null!=c?(b.currentCustomerId=a.CustomerDetail.data.id,f.put("contractId",c.entity.id),b.rowIndex=d):("create"!=f.get("detailId")&&(b.currentCustomerId=a.CustomerDetail.data.id),f.put("contractId","create")),e.path("/ContractDetail")},a.customerDetailAPI=function(){if("create"==f.get("detailId")){if(a.newCustomer=!0,a.CustomerDetail={success:!0,total:1,data:{customerName:"",contactList:[],contactIds:[],contractList:[],contractIds:[],comments:[],color:"#009999"}},a.detailComments=a.CustomerDetail.data,b.fromCustomer){angular.copy(b.cutomerContractCopy,a.CustomerDetail,!0),b.fromCustomer=!1,a.ClonedCustomerDetail.data={},a.ClonedCustomerDetail.data.customerName=a.CustomerDetail.data.customerName;var c=[];angular.forEach(a.CustomerDetail.data.contractList,function(a){a.deleted||c.push(a)}),a.CustomerDetail.data.contractList=c,a.contractTableData=a.CustomerDetail.data.contractList,1==b.deleteCustomerContract&&a.CustomerDetail.data.contractList.splice(b.rowIndex,1),a.CustomerDetail.data.contactList=k.filter(a.CustomerDetail.data.contactList),a.contactTableData=a.CustomerDetail.data.contactList,a.disabledSave=!1}a.disableDelete=!0,a.showEmptyContactDetail=!0,a.mapOptions=a.CustomerDetail,a.detailComments=a.CustomerDetail.data,a.enableCustDetailButtons()}else if(a.newCustomer=!1,a.showEmptyContactDetail=!0,null!=f.get("detailId"))if(b.fromCustomer){a.CustomerDetail={},a.CustomerDetail=b.cutomerContractCopy,a.ClonedCustomerDetail.data={},a.ClonedCustomerDetail.data.customerName=a.CustomerDetail.data.customerName,a.mapOptions=a.CustomerDetail,a.needMapCall.callMap=!0,a.customerHeading=a.CustomerDetail.data.customerName,a.isError=!1,a.formatInputData(),a.newCustomer=!1,b.customerName=a.CustomerDetail.data.customerName,$('select[name="colorpicker"]').simplecolorpicker("selectColor",a.CustomerDetail.data.color),a.CustomerDetail.data.contactList=k.filter(a.CustomerDetail.data.contactList),a.contactTableData=a.CustomerDetail.data.contactList,1==b.deleteCustomerContract&&a.CustomerDetail.data.contractList.splice(b.rowIndex,1);var c=[];angular.forEach(a.CustomerDetail.data.contractList,function(a){a.deleted||c.push(a)}),a.detailComments=a.CustomerDetail.data,a.CustomerDetail.data.contractList=c,a.contractTableData=a.CustomerDetail.data.contractList,b.fromCustomer=!1,a.disabledSave=!1,a.enableCustDetailButtons()}else d.get("/api/customerDetail/"+f.get("detailId")).success(function(c){a.CustomerDetail=c,a.mapOptions=a.CustomerDetail,a.needMapCall.callMap=!0,a.customerHeading=c.data.customerName,a.isError=!1,$('select[name="colorpicker"]').simplecolorpicker("selectColor",a.CustomerDetail.data.color),angular.forEach(a.CustomerDetail.data.contractList,function(a){null!=a.value&&(a.value=Number(a.value).toFixed(2)),null!=a.endDate&&(a.endDate=l.convert(a.endDate,!0)),null!=a.startDate&&(a.startDate=l.convert(a.startDate,!0))}),a.CustomerDetail.data.contactList=k.filter(a.CustomerDetail.data.contactList),a.contactTableData=a.CustomerDetail.data.contactList;var d=[];angular.forEach(a.CustomerDetail.data.contractList,function(a){a.deleted||d.push(a)}),a.CustomerDetail.data.contractList=d,a.contractTableData=a.CustomerDetail.data.contractList,a.tableRebuild(a.contactTableoptions),a.formatInputData(),a.CustomerDetail.data.comments=m.formatInputData(a.CustomerDetail.data.comments),a.detailComments=a.CustomerDetail.data,angular.copy(a.CustomerDetail,a.ClonedCustomerDetail,!0),console.log(a.CustomerDetail),console.log(a.ClonedCustomerDetail),a.newCustomer=!1,b.customerName=a.CustomerDetail.data.customerName,b.fromCustomer=!1,a.enableCustDetailButtons()}).error(function(){a.isError=!0,a.addAlert("No customer details available.","danger"),a.enableCustDetailButtons()}),a.disableDelete=!1,a.disabledSave=!0},null==b.localCache.currencies?d.get("/api/listData/currencies").success(function(c){a.currencies=c.data,b.localCache.currencies=a.currencies,a.customerDetailAPI()}).error(function(){console.log("No data found for currencies")}):(a.currencies=b.localCache.currencies,a.customerDetailAPI()),a.addAlert=function(b,c){a.alerts=[],a.alerts.push({message:b,type:c}),h()},a.closeAlert=function(){a.alerts=[]},a.Validatetypeahead=function(b,c,d,e,f){if(null==d)return-1==b.indexOf(c)?(a.addAlert(e,f),!1):(a.closeAlert(),!0);var g=!1;return angular.forEach(b,function(a){a[d]==c&&(g=!0)}),g?(a.closeAlert(),!0):(a.addAlert(e,f),!1)},a.backtoCustomer=function(){return a.isError||a.isUpdateError?(b.localCache.isCustomerAPINeeded=!1,b.closeAlert(),void e.path("/Customer")):(b.localCache.isCustomerAPINeeded=!1,b.closeAlert(),void e.path("/Customer"))},a.saveCustomerData=function(){if(""==a.CustomerDetail.data.customerName)return a.addAlert("Enter Customer Name.","danger"),void(a.isUpdateError=!0);if(a.inSave=!0,console.log(angular.equals(a.ClonedCustomerDetail,a.CustomerDetail)),console.log("Customer cloned data",a.ClonedCustomerDetail),console.log("Customer data",a.CustomerDetail),!angular.equals(a.ClonedCustomerDetail,a.CustomerDetail)){if(a.closeAlert(),b.localCache.isCustomerAPINeeded=!0,""!=a.CustomerDetail.data.addressISOCountry&&null!=a.CustomerDetail.data.addressISOCountry&&0==a.Validatetypeahead(a.countries,a.CustomerDetail.data.addressISOCountry.name,"name","Enter a valid Country Code","danger"))return a.inSave=!1,void(a.isUpdateError=!0);if(""!=a.CustomerDetail.data.addressStateCode&&null!=a.CustomerDetail.data.addressStateCode&&0==a.Validatetypeahead(a.states,a.CustomerDetail.data.addressStateCode.name,"name","Enter a valid State Code","danger"))return a.inSave=!1,void(a.isUpdateError=!0);a.needMapCall.callMap=!0,a.CustomerDetail.data.contactIds=[],angular.forEach(a.CustomerDetail.data.contactList,function(b){a.CustomerDetail.data.contactIds.push(b.id)}),a.CustomerDetail.data.contractIds=[],angular.forEach(a.CustomerDetail.data.contractList,function(b){a.CustomerDetail.data.contractIds.push(b.id)}),null!=a.CustomerDetail.data.addressStateCode&&(a.CustomerDetail.data.addressStateCode=a.CustomerDetail.data.addressStateCode.code),null!=a.CustomerDetail.data.addressISOCountry&&(a.CustomerDetail.data.addressISOCountry=a.CustomerDetail.data.addressISOCountry.code),console.log(a.CustomerDetail.data),null!=a.CustomerDetail.data.comments&&(a.CustomerDetail.data.comments=m.filterPostData(a.CustomerDetail.data.comments));var c=a.CustomerDetail.data,g=i.postTimeStamp();a.disabledSave=!0,d({method:"post",url:"/api/customerDetail/update?timestamp="+g,data:c,headers:{"content-type":"application/json"}}).success(function(c){a.addAlert("Updated successfully","success"),a.CustomerDetail=c,b.localCache.isCustomerAPINeeded=!0,b.localCache.isFindCustomerAPINeeded=!0,a.isError=!1,a.formatInputData(),angular.copy(a.CustomerDetail,a.ClonedCustomerDetail,!0),"create"==f.get("detailId")&&(f.put("detailId",c.data.id),a.newCustomer=!1),a.inSave=!1,p=j(function(){e.path("/Customer")},1e3)}).error(function(){a.addAlert("Update failed","danger"),b.localCache.isCustomerAPINeeded=!1,b.localCache.isFindCustomerAPINeeded=!1,a.inSave=!1,a.isUpdateError=!0})}},a.confirmDelete=function(){var c=a.CustomerDetail.data.customerName;b.showModal("/api/delete/customer/"+f.get("detailId")+"?timestamp="+i.postTimeStamp(),"Confirm Delete","Are you sure you would like to delete "+c+"? This action can not be undone.","Cancel","Confirm"),a.$watch("isPostSuccess",function(c,d){null!=c&&c!=d&&(b.isPostSuccess?(b.localCache.isCustomerAPINeeded=!0,b.localCache.isFindCustomerAPINeeded=!0,e.path("/Customer")):a.addAlert("Delete Failed.","danger"),b.isPostSuccess=null)})},a.showUploadContainer=function(){a.UploadDocumentsOptionVisible=!1,a.attachmentsContainerVisible=!0},a.hideUploadContainer=function(){a.UploadDocumentsOptionVisible=!0,a.attachmentsContainerVisible=!1},a.inSave=!1,a.$watch("CustomerDetail",function(b,c){a.inSave||b!=c&&(angular.equals(a.ClonedCustomerDetail,a.CustomerDetail)||(a.disabledSave=!1))},!0),a.openContactInfo=function(d,e){b.contactRowIndex=e,angular.copy(a.CustomerDetail,b.copyCustomerDetails,!0),null!=d?f.put("contactID",d.entity.id):f.put("contactID","create"),b.modalInstance=c.open({templateUrl:"views/ContactPopUp.html"}),b.modalInstance.result.then(function(c){"create"==f.get("contactID")?(null==a.CustomerDetail.data.contactIds&&(a.CustomerDetail.data.contactIds=[]),null==a.CustomerDetail.data.contactList&&(a.CustomerDetail.data.contactList=[]),a.CustomerDetail.data.contactList.push(c),o=k.filter(a.CustomerDetail.data.contactList),a.contactTableData=a.CustomerDetail.data.contactList):(a.CustomerDetail.data.contactList[b.contactRowIndex]=c,a.CustomerDetail.data.contactList=k.filter(a.CustomerDetail.data.contactList),a.contactTableData=a.CustomerDetail.data.contactList),a.contactTableoptions.$gridServices.DomUtilityService.RebuildGrid(a.contactTableoptions.$gridScope,a.contactTableoptions.ngGrid),b.modalInstance=null},function(){b.modalInstance=null,console.log(b.modalInstance)})},a.$on("$destroy",function(){null!=a.modalInstance&&b.modalInstance.close(),j.cancel(p)})}]),angular.module("redPandaApp").controller("ContactModalController",["$scope","$rootScope","$route","$http","CurrentTimeStamp","$cookieStore","fileReader",function(a,b,c,d,e,f,g){a.noContactSelected=!1,a.invalidEmail=!1,a.debugMode=!0,a.invalidEmail=!1,a.isImageuploaded=!1,a.isRequired=!1,a.mapOptions={},a.clonedContactObj={},a.needMapCall={callMap:!1},a.addressKeys=["addressStreet","addressCity","addressStateCode","addressPostZip","addressCountryISO"],a.contactNumbers=[{contactInfo:"",info:""}],a.custContactList={},b.customerContacts=[],a.contactTypeValue=[],a.contactTypeDetails=[],a.isInfoRequired=[],a.custContactList={},a.contactalerts=[],a.contactObj={id:"",type:"",companyName:"",firstName:"",lastName:"",name:"",address:"",jobTitle:"",deleted:""},a.addAlert=function(b,c,d){a.contactalerts=[],a.contactalerts.push({message:b,type:c,header:d}),$window.scrollTo(0,0)},a.closeAlert=function(){a.contactalerts=[]};var h=function(){(null==a.contactDetail.data.contactNumbers||0===a.contactDetail.data.contactNumbers.length)&&(a.contactDetail.data.contactNumbers=[],console.log("..."));for(var b=0;b<a.contactDetail.data.contactNumbers.length;b++)a.contactTypeDetails[b]=a.contactDetail.data.contactNumbers[b].details,a.contactTypeValue[b]=a.contactDetail.data.contactNumbers[b].type};a.formatTableData=function(){0===a.contactDetail.data.contactNumbers.length&&(a.contactDetail.data.contactNumbers=[],a.contactDetail.data.contactNumbers.push({}),a.contactTypeValue[0]="email",a.contactTypeDetails[0]="")},a.formatInputData=function(){null!=a.contactDetail&&null!=a.contactDetail.data.addressCountryISO&&null!=a.countries&&angular.forEach(a.countries,function(b){b.code==a.contactDetail.data.addressCountryISO&&(a.contactDetail.data.addressCountryISO=b.name)}),null!=a.contactDetail&&null!=a.contactDetail.data.addressStateCode&&null!=a.states&&angular.forEach(a.states,function(b){b.code==a.contactDetail.data.addressStateCode&&(a.contactDetail.data.addressStateCode=b.name)})},"create"==f.get("contactID")?(a.contactDetail={success:!0,total:1,data:{}},a.contactNumbers=null,a.mapOptions=a.contactDetail,a.newContact=!0,(null==a.contactDetail.data.contactNumbers||0===a.contactDetail.data.contactNumbers.length)&&(a.contactDetail.data.contactNumbers=[],a.contactDetail.data.contactNumbers.push({}),a.contactTypeValue[0]="email",a.contactTypeDetails[0]=""),angular.copy(a.contactDetail,a.clonedContactObj,!0)):d.get("/api/contactDetail/"+f.get("contactID")).success(function(b){a.contactDetail=b,a.needMapCall.callMap=!0,a.mapOptions=a.contactDetail,h(),a.formatInputData(),angular.copy(a.contactDetail,a.clonedContactObj,!0),console.log(a.clonedContactObj.data.contactNumbers),a.formatTableData()}).error(function(){console.log("No data found for contact detail")}),null==b.localCache.states?d.get("/api/listData/states").success(function(c){a.states=c.data,b.localCache.states=a.states,a.formatInputData()}).error(function(){console.log("No data found for state")}):(a.states=b.localCache.states,a.formatInputData()),null==b.localCache.countries?d.get("/api/listData/countries").success(function(c){a.countries=c.data,b.localCache.countries=a.countries,a.formatInputData()}).error(function(){console.log("No data found countries")}):(a.countries=b.localCache.countries,a.formatInputData());var i='<div class="ngHeaderSortColumn {{col.headerClass}}" ng-style="{\'cursor\': col.cursor}" ng-class="{ \'ngSorted\': !noSortVisible }"><div ng-click="col.sort($event)" ng-class="\'colt\' + col.index" class="ngHeaderText">{{col.displayName}} <button class="btn btn-default btn-sm" ng-click="addRow(contactNumbers)"><i class="fa fa-plus"></i></button></div><div class="ngSortButtonDown" ng-show="col.showSortButtonDown()"></div><div class="ngSortButtonUp" ng-show="col.showSortButtonUp()"></div><div class="ngSortPriority">{{col.sortPriority}}</div><div ng-class="{ ngPinnedIcon: col.pinned, ngUnPinnedIcon: !col.pinned }" ng-click="togglePin(col)" ng-show="col.pinnable"></div></div><div ng-show="col.resizable" class="ngHeaderGrip" ng-click="col.gripClick($event)" ng-mousedown="col.gripOnMouseDown($event)"></div>';a.customerContactTableOption={data:"contactNumbers",multiSelect:!1,enableSorting:!1,rowHeight:40,headerRowHeight:40,columnDefs:[{field:"contactType",displayName:"Type",width:"38%",cellTemplate:'<div class="ngCellText" style="display: inline-flex;width: 100%;"><select  ng-options="contact as contact for contact in contactNumberTypes" ng-model ="defaultContactType.type" class="form-control"></select></div>'},{field:"info",displayName:"Info",width:"50%",cellTemplate:'<div class="ngCellText" style="display: inline-flex;width: 100%;"><input type="text" ng-model="contractDetail.data.startDate" class="form-control"/><p ng-show ="invalidEmail" class="text-danger">Invalid email.</p> </div>'},{field:"",displayName:"",width:"10%",headerCellTemplate:i,cellTemplate:'<div class="ngCellText"><button class="btn btn-default btn-sm" ng-click="deleteSelectedRow(row.rowIndex,contactNumbers)"><i class="fa fa-times"></i></button></div>'}]},a.isValidContactInfo=!1,a.contactNewContact={info:""},a.defaultContactType={},a.deleteEmployeeContactInfo=function(b){a.contactDetail.data.contactNumbers.splice(b,1),a.contactTypeDetails.splice(b,1),a.contactTypeValue.splice(b,1),0==a.contactDetail.data.contactNumbers.length&&(a.contactDetail.data.contactNumbers.push({}),a.contactTypeDetails[0]="",a.contactTypeValue[0]="Phone")},a.addEmployeeContactInfo=function(){var b=a.contactDetail.data.contactNumbers.length;a.contactDetail.data.contactNumbers.push({}),a.contactTypeDetails[b]="",a.contactTypeValue[b]=a.contactNumberTypes[0]};a.getClass=function(b){return a.red.checked&&-1!=b.func.indexOf("red")},null==b.localCache.contactNumTypes?d.get("/api/listData/contactNumberTypes").success(function(c){a.contactNumberTypes=c.data,b.localCache.contactNumTypes=a.contactNumberTypes,a.defaultContactType.type=a.contactNumberTypes[0]}).error(function(){console.log("No data found for contact number types")}):(a.contactNumberTypes=b.localCache.contactNumTypes,a.defaultContactType.type=a.contactNumberTypes[0]),a.validateName=function(){return""==a.contactDetail.data.nickname||null==a.contactDetail.data.nickname?void(a.isRequired=!0):void(a.isRequired=!1)},a.isImageuploaded=!1,a.getFile=function(b){a.file=b,g.readAsDataUrl(a.file,a).then(function(b){a.imageSrc=b,a.UploadImage(),a.disabledSave=!1,a.isImageuploaded=!0})};var j=function(b){return a.contactObj.id=b.id,a.contactObj.type=b.type,a.contactObj.companyName=b.companyName,a.contactObj.firstName=b.firstName,a.contactObj.lastName=b.lastName,a.contactObj.name=b.nickname,a.contactObj.address=b.addressCity,a.contactObj.jobTitle=a.custContactList.jobTitle,a.contactObj.deleted=!1,a.contactObj};a.isInfoRequired=[],a.saveContactNumbers=function(){for(var b=!1,c=0;c<a.contactTypeDetails.length;c++)a.isInfoRequired[c]=!1;for(var c=0;c<a.contactTypeDetails.length;c++)if(""!=a.contactTypeValue[c]&&null!=a.contactTypeValue[c]&&""!=a.contactTypeDetails[c]&&null!=a.contactTypeDetails[c]&&"email"==a.contactTypeValue[c].toLowerCase()){var d=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(!d.test(a.contactTypeDetails[c])){b=!0,a.isInfoRequired[c]=!0;break}a.isInfoRequired[c]=!1}if(!b){a.contactDetail.data.contactNumbers=[];for(var e=-1,f=-1,g=-1,h=-1,c=0;c<a.contactTypeDetails.length;c++)""!=a.contactTypeDetails[c]&&""!=a.contactTypeValue[c]&&null!=a.contactTypeValue[c]&&null!=a.contactTypeDetails[c]&&("email"==a.contactTypeValue[c].toLowerCase()&&(e++,a.contactDetail.data.contactNumbers.push({details:a.contactTypeDetails[c],seq:e,type:a.contactTypeValue[c]})),"phone"==a.contactTypeValue[c].toLowerCase()&&(f++,a.contactDetail.data.contactNumbers.push({details:a.contactTypeDetails[c],seq:f,type:a.contactTypeValue[c]})),"skype"==a.contactTypeValue[c].toLowerCase()&&(h++,a.contactDetail.data.contactNumbers.push({details:a.contactTypeDetails[c],seq:h,type:a.contactTypeValue[c]})),"linkedin"==a.contactTypeValue[c].toLowerCase()&&(g++,a.contactDetail.data.contactNumbers.push({details:a.contactTypeDetails[c],seq:g,type:a.contactTypeValue[c]})))}return b},a.UploadImage=function(){var b=new FormData;b.append("file",a.file),"create"!=f.get("contactID")&&b.append("contactId",f.get("contactID")),d.post("/api/upload/photo",b,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(b){console.log(b),a.contactDetail.data.photoId=b.data.resourceId,a.contactDetail.data.photoUrl=b.data.contentUrl,a.contactDetail.data.thumbUrl=b.data.thumbUrl,a.isImageuploaded=!1}).error(function(b,c){a.isImageuploaded=!1,413==c&&console.log("Image update failed:Image file exceeds maximum area.Please choose a file under 1MB.","danger")})},a.ok=function(){a.needToSave=!1;var c={};if(!a.saveContactNumbers()){if(angular.copy(a.contactDetail,c,!0),angular.forEach(c.data,function(b,c){angular.equals(b,a.clonedContactObj.data[c])||(a.needToSave=!0)}),console.log(a.needToSave),a.isImageuploaded&&!a.needToSave&&(a.needToSave=!0),!a.needToSave)return void a.cancel();if(""==a.contactDetail.data.nickname||null==a.contactDetail.data.nickname)return void(a.isRequired=!0);if(null!=a.contactDetail.data.addressStateCode){var g=a.contactDetail.data.addressStateCode;console.log(g),"object"==typeof g?a.contactDetail.data.addressStateCode=g.code:null!=a.states&&angular.forEach(a.states,function(b){b.name==a.contactDetail.data.addressStateCode&&(a.contactDetail.data.addressStateCode=b.code)})}if(null!=a.contactDetail.data.addressCountryISO){var h=a.contactDetail.data.addressCountryISO;"object"==typeof h?(a.contactDetail.data.addressCountryISO=h.code,a.contactDetail.data.addressCountryName=h.name):null!=a.countries&&angular.forEach(a.countries,function(b){b.name==a.contactDetail.data.addressCountryISO&&(a.contactDetail.data.addressCountryISO=b.code,a.contactDetail.data.addressCountryName=b.name)})}var i=!1,k=!1;return a.inValidCountryCode=!1,a.inValidStateCode=!1,""==a.contactDetail.data.addressStateCode||null==a.contactDetail.data.addressStateCode||(angular.forEach(a.states,function(b){b.code==a.contactDetail.data.addressStateCode&&(i=!0)}),i)?""==a.contactDetail.data.addressCountryISO||null==a.contactDetail.data.addressCountryISO||(angular.forEach(a.countries,function(b){b.code==a.contactDetail.data.addressCountryISO&&(k=!0)}),k)?void(void 0==a.contactDetail||d({method:"post",url:"/api/contactDetail/update?timestamp="+e.postTimeStamp(),data:a.contactDetail.data,headers:{"content-type":"application/json"}}).success(function(c){a.custContactList=c.data,a.newContact=!1,b.modalInstance.close("create"==f.get("contactID")?j(a.custContactList):j(a.custContactList))}).error(function(){console.log("Failed")})):void(a.inValidCountryCode=!0):void(a.inValidStateCode=!0)}},a.cancel=function(){b.modalInstance.dismiss("cancel")}}]),angular.module("redPandaApp").controller("modalcontroller",["$scope","$rootScope",function(a,b){a.ok=function(){b.dialogModal.close()},a.cancel=function(){b.dialogModal.dismiss("dismiss")}}]),angular.module("redPandaApp").controller("commentsController",["$scope","$rootScope","UserComments",function(a,b,c){a.$watch("detailComments.comments",function(b){null!=b&&(a.detailComments.comments=a.detailComments.comments)},!0),a.saveCommentMessage=function(){if(""!==a.commentText){var d=new Date,e=d.toISOString(),f=a.commentText;a.commentText="",null==a.detailComments.comments&&(a.detailComments.comments=[]);var g=0,h=a.detailComments.comments.length;g=0===h?0:h,a.detailComments.comments.push({seqNo:g,postedBy:{thumbUrl:b.defaultUserImage,name:b.currentUserName,id:b.currentUserId},postedOn:e,replyTo:0,docRef:0,text:f}),angular.forEach(a.detailComments.comments,function(a){null!=a.postedOn&&(a.tempTime=c.convertCommentDate(a.postedOn))})}}}]),angular.module("redPandaApp").controller("LoginController",["$scope","$location","$http","$window","$rootScope","$cookieStore",function(a,b,c,d,e,f){a.alerts=[],a.userName="",d.scrollTo(0,0),f.put("enableApplication",!1),e.showApplication=f.get("enableApplication"),a.forgetPassword=function(){b.path("/ResetPassword")},a.signUp=function(){b.path("/Registration")},a.addAlert=function(b,c){a.alerts=[],a.alerts.push({message:b,type:c}),d.scrollTo(0,0)},a.closeAlert=function(){a.alerts=[]},a.constructQueryParameters=function(){var b="";return null!=a.userId&&""!=a.userId&&(b+="userID="+a.userId),null!=a.password&&""!=a.password&&(b+="&password="+a.password),b},a.loginUser=function(b){if(a.postData="",null==b){if(console.log("inside login"),null==a.userId||""==a.userId)return void a.addAlert("Please Enter a user name or email","danger");if(a.closeAlert(),null==a.password||""==a.password)return void a.addAlert("Please Enter a  Password","danger");a.closeAlert();var c=a.constructQueryParameters();a.sendGetRequest(null,c)}else{var c=a.constructQueryParameters();a.sendGetRequest(b,c)}},a.sendGetRequest=function(g,h){null!=g?(console.log("/api/login?provider="+g+"&"+h),d.open(""==h?"/api/login?provider="+g:"/api/login?provider="+g+"&"+h)):(console.log("/api/login?"+h),c({method:"get",url:"/api/login?"+h}).success(function(c){f.put("currentUserId",c.data.contactId),e.currentUserId=f.get("currentUserId"),f.put("currentUserName",c.data.userName),e.currentUserName=f.get("currentUserName"),f.put("defaultUserImage",c.data.themeIconUrl),e.defaultUserImage=f.get("defaultUserImage"),console.log("Success"),1==c.success?b.path("/Home"):a.addAlert("Login Error.There was an error with the credential supplied,please try again","danger")}).error(function(){console.log("Error"),a.addAlert("Login Error.There was an error with the credential supplied,please try again","danger")}))}}]),angular.module("redPandaApp").controller("LoginRegistrationController",["$scope","$location","$timeout","$http","$window","$rootScope",function(a,b,c,d,e){a.alerts=[],a.regName="",a.regEmail="",a.termsConditions=!1,a.isMobile=!1,e.scrollTo(0,0),a.forgetPassword=function(){b.path("/ResetPassword")},a.login=function(){b.path("/login")},a.addAlert=function(b,c){console.log("inside alert"),a.alerts=[],a.alerts.push({message:b,type:c}),e.scrollTo(0,0)},a.closeAlert=function(){a.alerts=[]},a.validateEmail=function(){var b=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a.regEmail)?!1:(a.addAlert("Please Enter a Valid Email Id","danger"),!0)},a.constructQueryParameters=function(b,c){var d="";return null!=a.regName&&""!=a.regName&&(d+="name="+a.regName),null!=a.regEmail&&""!=a.regEmail&&(d+="&email="+a.regEmail),null!=a.regCompName&&""!=a.regCompName&&(d+="&companyName="+a.regCompName),null!=a.regPreUrl&&""!=a.regPreUrl&&(d+="&url="+a.regPreUrl),null!=a.isMobile&&""!=a.isMobile&&(d+="&isMobile="+a.isMobile),b&&(null!=c.city&&(d+="&city="+c.city),null!=c.region&&(d+="&region="+c.region),null!=c.country&&(d+="&countryISO="+c.country),null!=c.loc&&(d+="&lat="+c.loc.split(",")[0],d+="&long="+c.loc.split(",")[1])),d},a.userInformation=function(b,c){d({method:"get",url:"http://ipinfo.io/json"}).success(function(d){var e=d,f=a.constructQueryParameters(!0,e);b?a.sendPostRequest(c,f):a.sendPostRequest(null,f)}).error(function(){var d=a.constructQueryParameters(!1);b?a.sendPostRequest(c,d):a.sendPostRequest(null,d)})},a.sendPostRequest=function(f,g){f?(console.log("/api/register?provider="+f+"&"+g),e.open(""==g?"/api/register?provider="+f:"/api/register?provider="+f+"&"+g)):(console.log("/api/register?"+g),d({method:"get",url:"/api/register?"+g}).success(function(d){console.log("Success"),1==d.success?(console.log("Alert"),a.addAlert("You have successfully registered with redPanda. An email with your credentials has been sent to the address provided. Please ensure that mails from www.redPandaApp.com are not being filtered to your junk folder.","success"),c(function(){b.path("/login")},5e3)):a.addAlert("Login Error.There was an error with the credential supplied,please try again","danger")}).error(function(){console.log("Error"),a.addAlert("Login Error.There was an error with the credential supplied,please try again","danger")}))},a.createAccount=function(b){if(null==b){if(null==a.regName||""==a.regName)return void a.addAlert("Please Enter a Name","danger");if(a.closeAlert(),null==a.regEmail||""==a.regEmail)return void a.addAlert("Please Enter a Email Id","danger");if(a.validateEmail())return;if(!a.termsConditions)return void a.addAlert("Please agree to Terms of Use","danger");a.closeAlert(),a.userInformation(!1,null)}else a.closeAlert(),a.userInformation(!0,b)}}]),angular.module("redPandaApp").controller("ResetPasswordController",["$scope","$location","$timeout","$http","$window","$rootScope",function(a,b,c,d,e){a.alerts=[],a.userEmail="",e.scrollTo(0,0),a.signUp=function(){b.path("/Registration")},a.login=function(){b.path("/login")},a.addAlert=function(b,c){console.log("Add alerts"),a.alerts=[],a.alerts.push({message:b,type:c}),e.scrollTo(0,0)},a.closeAlert=function(){a.alerts=[]},a.validateEmail=function(){var b=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a.userEmail)?!1:(a.addAlert("Please Enter a Valid Email Id","danger"),!0)},a.resetPassword=function(){return a.postData="",null==a.userEmail||""==a.userEmail?void a.addAlert("Please Enter Valid email","danger"):void(null!=a.userEmail&&""!=a.userEmail&&a.validateEmail()||(a.closeAlert(),d({method:"get",url:"/api/login/password?email="+a.userEmail}).success(function(d){console.log("Success"),1==d.success?(console.log("In password reset"),a.addAlert("Your password has been successfully reset and a mail has been sent with your new credentials. Please ensure that mails from www.redPandaApp.com are not being filtered to your junk folder.","success"),c(function(){b.path("/login")},5e3)):a.addAlert("Login Error.There was an error with the credential supplied,please try again","danger")}).error(function(){console.log("Error"),a.addAlert("Login Error.There was an error with the credential supplied,please try again","danger")})))}}]);